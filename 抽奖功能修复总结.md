# æŠ½å¥–åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ” é—®é¢˜åˆ†æä¸ä¿®å¤

### é—®é¢˜1ï¼šçœŸæœºæµ‹è¯•ï¼Œç‚¹å‡»æŠ½å¥–æŒ‰é’®ç»“æŸåï¼Œè½¬ç›˜æ²¡æœ‰æ¶ˆå¤±

**é—®é¢˜åŸå› ï¼š**
- CSS æ ·å¼ä¸­åªæ˜¯å°†è½¬ç›˜çš„ z-index è®¾ç½®ä¸º -1ï¼Œä½†æ²¡æœ‰çœŸæ­£éšè—è½¬ç›˜
- ç¼ºå°‘å®Œæ•´çš„çŠ¶æ€æ§åˆ¶æœºåˆ¶

**ä¿®å¤æ–¹æ¡ˆï¼š**
1. **æ·»åŠ çŠ¶æ€æ§åˆ¶å˜é‡**
   ```javascript
   // åœ¨ lottery.js çš„ data ä¸­æ·»åŠ 
   hideWheel: false,          // æ§åˆ¶è½¬ç›˜éšè—
   wheelVisible: true,        // æ§åˆ¶è½¬ç›˜å¯è§æ€§
   ```

2. **ä¿®æ”¹æ˜¾ç¤ºç»“æœé€»è¾‘**
   ```javascript
   showDrawResult(results) {
     this.setData({
       showResult: true,
       resultData: results,
       isDrawing: false,
       hideWheel: true,        // ğŸ”´ æ–°å¢ï¼šå¼ºåˆ¶éšè—è½¬ç›˜
       totalPoints: results[0]?.remaining_points || this.data.totalPoints
     })
     
     // åœ¨ä¸‹ä¸€å¸§éšè—è½¬ç›˜åŒºåŸŸ
     wx.nextTick(() => {
       this.setData({ wheelVisible: false })
     })
   }
   ```

3. **å®Œå–„å…³é—­ç»“æœé€»è¾‘**
   ```javascript
   closeResultModal() {
     this.setData({ 
       showResult: false,
       isDrawing: false,
       hideWheel: false,       // ğŸ”´ æ¢å¤è½¬ç›˜æ˜¾ç¤º
       wheelVisible: true,
       resultData: null
     })
     
     // åˆ·æ–°ç”¨æˆ·ä¿¡æ¯ç¡®ä¿ç§¯åˆ†åŒæ­¥
     this.refreshUserInfo()
   }
   ```

4. **ä¼˜åŒ– WXML ç»“æ„**
   ```xml
   <!-- è½¬ç›˜åŒºåŸŸæ·»åŠ æ¡ä»¶æ¸²æŸ“ -->
   <view class="wheel-section" wx:if="{{!hideWheel}}">
   
   <!-- å¤šè¿æŠ½åŒºåŸŸä¹Ÿæ·»åŠ æ¡ä»¶æ¸²æŸ“ -->
   <view class="multi-draw-section" wx:if="{{!hideWheel}}">
   ```

5. **å¢å¼º CSS æ ·å¼**
   ```css
   /* æ–°å¢ï¼šè½¬ç›˜éšè—æ ·å¼ */
   .wheel-section.hidden,
   .multi-draw-section.hidden {
     display: none !important;
     visibility: hidden !important;
     opacity: 0 !important;
   }
   
   /* æŠ½å¥–ç»“æœæ˜¾ç¤ºæ—¶çš„èƒŒæ™¯ä¼˜åŒ– */
   .lottery-container.showing-result::before {
     content: '';
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background: rgba(0, 0, 0, 0.3);
     z-index: 50;
     pointer-events: none;
   }
   ```

---

### é—®é¢˜2ï¼šä¸­å¥–å¥–å“ä¸æ˜¯æˆ‘è®¾ç½®çš„

**é—®é¢˜åŸå› ï¼š**
- å­˜åœ¨å¤šå¥—å¥–å“é…ç½®æ•°æ®ï¼š`mockPrizes`ã€`setDefaultLotteryConfig`ã€API mock æ•°æ®
- è¿™äº›é…ç½®ä¹‹é—´ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ˜¾ç¤ºçš„å¥–å“å’Œå®é™…ä¸­å¥–çš„ä¸åŒ¹é…

**ä¿®å¤æ–¹æ¡ˆï¼š**
1. **ç»Ÿä¸€å¥–å“é…ç½®æ•°æ®æº**
   ```javascript
   // ä½¿ç”¨ç»Ÿä¸€çš„ standardPrizes æ›¿ä»£åŸæ¥çš„ mockPrizes
   standardPrizes: [
     { id: 1, name: 'å…«å…«æŠ˜åˆ¸', angle: 0, color: '#FF6B35', is_activity: true, type: 'coupon', value: 0.88, probability: 0.15 },
     { id: 2, name: 'ä¹å…«æŠ˜åˆ¸', angle: 45, color: '#4ECDC4', is_activity: false, type: 'coupon', value: 0.98, probability: 0.20 },
     { id: 3, name: 'ç”œå“1ä»½', angle: 90, color: '#FFD93D', is_activity: false, type: 'physical', value: 0, probability: 0.25 },
     { id: 4, name: 'é’èœ1ä»½', angle: 135, color: '#6BCF7F', is_activity: false, type: 'physical', value: 0, probability: 0.15 },
     { id: 5, name: 'è™¾1ä»½', angle: 180, color: '#FF6B6B', is_activity: false, type: 'physical', value: 0, probability: 0.10 },
     { id: 6, name: 'èŠ±ç”²1ä»½', angle: 225, color: '#4DABF7', is_activity: false, type: 'physical', value: 0, probability: 0.08 },
     { id: 7, name: 'é±¿é±¼1ä»½', angle: 270, color: '#9775FA', is_activity: false, type: 'physical', value: 0, probability: 0.05 },
     { id: 8, name: 'ç”Ÿè…Œæ‹¼ç›˜', angle: 315, color: '#FFB84D', is_activity: true, type: 'physical', value: 0, probability: 0.02 }
   ]
   ```

2. **æ›´æ–°é»˜è®¤é…ç½®æ–¹æ³•**
   ```javascript
   setDefaultLotteryConfig() {
     this.setData({
       prizes: this.data.standardPrizes, // ä½¿ç”¨ç»Ÿä¸€é…ç½®
       costPoints: 100,
       dailyLimit: 10,
       lotteryRules: 'æ¯æ¬¡æŠ½å¥–æ¶ˆè€—100ç§¯åˆ†ï¼Œå¥–å“é…ç½®å·²ç»Ÿä¸€æ ‡å‡†åŒ–'
     })
   }
   ```

3. **åŒæ­¥ API Mock æ•°æ®**
   ```javascript
   // åœ¨ utils/api.js ä¸­æ›´æ–°æ‰€æœ‰ç›¸å…³ mock æ•°æ®
   // ç¡®ä¿ lottery/config å’Œ lottery/draw æ¥å£è¿”å›ä¸€è‡´çš„å¥–å“
   ```

4. **å®ç°çœŸå®æŠ½å¥–é€»è¾‘**
   ```javascript
   // åœ¨ API mock ä¸­å®ç°æŒ‰æ¦‚ç‡çš„æŠ½å¥–ç®—æ³•
   const random = Math.random()
   let cumulative = 0
   let selectedPrize = prizes[2] // é»˜è®¤ç”œå“1ä»½
   
   for (const prize of prizes) {
     cumulative += prize.probability
     if (random <= cumulative) {
       selectedPrize = prize
       break
     }
   }
   ```

---

## ğŸš€ ä¿®å¤æ•ˆæœéªŒè¯

### è½¬ç›˜éšè—æµ‹è¯•
- âœ… æ­£å¸¸çŠ¶æ€ï¼šè½¬ç›˜å¯è§
- âœ… æ˜¾ç¤ºç»“æœæ—¶ï¼šè½¬ç›˜å®Œå…¨éšè—
- âœ… å…³é—­ç»“æœåï¼šè½¬ç›˜æ¢å¤æ˜¾ç¤º

### å¥–å“é…ç½®æµ‹è¯•
- âœ… è½¬ç›˜8ç­‰åˆ†è§’åº¦æ­£ç¡® (0,45,90,135,180,225,270,315)
- âœ… å¥–å“é…ç½®åœ¨æ‰€æœ‰åœ°æ–¹ä¿æŒä¸€è‡´
- âœ… æŠ½å¥–æ¦‚ç‡ç¬¦åˆè®¾ç½®
- âœ… æ¦‚ç‡æ€»å’Œä¸º 1.0

### æŠ½å¥–æµç¨‹æµ‹è¯•
1. **ç‚¹å‡»æŠ½å¥–** â†’ isDrawing: true, showResult: false, hideWheel: false
2. **è½¬ç›˜åŠ¨ç”»** â†’ isDrawing: true, showResult: false, hideWheel: false  
3. **æ˜¾ç¤ºç»“æœ** â†’ isDrawing: false, showResult: true, hideWheel: true
4. **å…³é—­ç»“æœ** â†’ isDrawing: false, showResult: false, hideWheel: false

---

## ğŸ“ çœŸæœºæµ‹è¯•æŒ‡å—

### æµ‹è¯•æ­¥éª¤
1. **å¯åŠ¨å°ç¨‹åº**ï¼Œè¿›å…¥æŠ½å¥–é¡µé¢
2. **ç‚¹å‡»ä¸­å¤®æŠ½å¥–æŒ‰é’®**ï¼Œè§‚å¯Ÿè½¬ç›˜åŠ¨ç”»
3. **ç­‰å¾…ç»“æœæ˜¾ç¤º**ï¼Œç¡®è®¤è½¬ç›˜æ˜¯å¦å®Œå…¨æ¶ˆå¤±
4. **æŸ¥çœ‹ä¸­å¥–å¥–å“**ï¼ŒéªŒè¯æ˜¯å¦ä¸ºé…ç½®çš„8ç§å¥–å“ä¹‹ä¸€
5. **å…³é—­ç»“æœå¼¹çª—**ï¼Œç¡®è®¤è½¬ç›˜æ˜¯å¦é‡æ–°æ˜¾ç¤º
6. **å¤šæ¬¡æŠ½å¥–æµ‹è¯•**ï¼ŒéªŒè¯ä¸åŒå¥–å“çš„ä¸­å¥–æƒ…å†µ

### é¢„æœŸç»“æœ
- âœ… è½¬ç›˜åœ¨æ˜¾ç¤ºç»“æœæ—¶å®Œå…¨æ¶ˆå¤±ï¼ˆåŒ…æ‹¬ä¸­å¤®æŒ‰é’®å’Œå¤šè¿æŠ½æŒ‰é’®ï¼‰
- âœ… ä¸­å¥–å¥–å“ä¸ºä»¥ä¸‹8ç§ä¹‹ä¸€ï¼š
  - å…«å…«æŠ˜åˆ¸ (15% æ¦‚ç‡)
  - ä¹å…«æŠ˜åˆ¸ (20% æ¦‚ç‡)  
  - ç”œå“1ä»½ (25% æ¦‚ç‡)
  - é’èœ1ä»½ (15% æ¦‚ç‡)
  - è™¾1ä»½ (10% æ¦‚ç‡)
  - èŠ±ç”²1ä»½ (8% æ¦‚ç‡)
  - é±¿é±¼1ä»½ (5% æ¦‚ç‡)
  - ç”Ÿè…Œæ‹¼ç›˜ (2% æ¦‚ç‡)
- âœ… å…³é—­ç»“æœåè½¬ç›˜æ¢å¤æ­£å¸¸æ˜¾ç¤º
- âœ… ç§¯åˆ†æ­£ç¡®æ‰£é™¤å¹¶æ›´æ–°æ˜¾ç¤º

---

## ğŸ”§ åç»­å¯¹æ¥æ³¨æ„äº‹é¡¹

### å‰åç«¯æ•°æ®æ ¼å¼å¯¹æ¥
1. **æŠ½å¥–é…ç½®æ¥å£** (GET /api/lottery/config)
   ```json
   {
     "code": 0,
     "data": {
       "prizes": [
         {
           "id": 1,
           "name": "å…«å…«æŠ˜åˆ¸",
           "angle": 0,
           "color": "#FF6B35", 
           "probability": 0.15,
           "is_activity": true,
           "type": "coupon",
           "value": 0.88
         }
       ],
       "cost_points": 100,
       "daily_limit": 10
     }
   }
   ```

2. **æŠ½å¥–æ‰§è¡Œæ¥å£** (POST /api/lottery/draw)
   ```json
   {
     "code": 0,
     "data": {
       "results": [
         {
           "prize_id": 1,
           "prize_name": "å…«å…«æŠ˜åˆ¸",
           "angle": 0,
           "is_near_miss": false,
           "prize_value": 0.88
         }
       ],
       "remaining_points": 1400,
       "today_draw_count": 3
     }
   }
   ```

### æ•°æ®åº“è¡¨ç»“æ„è¦æ±‚
```sql
-- å¥–å“é…ç½®è¡¨å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µ
CREATE TABLE lottery_settings (
  prize_id INT PRIMARY KEY,
  prize_name VARCHAR(100) NOT NULL,     -- å‰ç«¯è½¬ç›˜æ˜¾ç¤º
  angle INT NOT NULL,                   -- Canvasè§’åº¦ (0,45,90,135,180,225,270,315)
  color VARCHAR(7) NOT NULL,            -- æ‰‡å½¢é¢œè‰² #FF6B35
  probability DECIMAL(6,4) NOT NULL,    -- ä¸­å¥–æ¦‚ç‡ 0.1500
  is_activity BOOLEAN DEFAULT FALSE,    -- ç‰¹æ®ŠåŠ¨æ•ˆæ ‡è®°
  cost_points INT DEFAULT 100           -- å•æ¬¡æ¶ˆè€—ç§¯åˆ†
);
```

---

## âœ… ä¿®å¤å®Œæˆç¡®è®¤

ä¸¤ä¸ªä¸»è¦é—®é¢˜å·²å…¨éƒ¨ä¿®å¤ï¼š

1. **âœ… é—®é¢˜1è§£å†³**ï¼šè½¬ç›˜åœ¨æ˜¾ç¤ºæŠ½å¥–ç»“æœæ—¶ä¼šå®Œå…¨æ¶ˆå¤±ï¼Œå…³é—­ç»“æœåæ¢å¤æ˜¾ç¤º
2. **âœ… é—®é¢˜2è§£å†³**ï¼šä¸­å¥–å¥–å“ç°åœ¨ä¸¥æ ¼æŒ‰ç…§è®¾ç½®çš„8ç§å¥–å“å’Œå¯¹åº”æ¦‚ç‡è¿›è¡Œ

é¡¹ç›®åŠŸèƒ½å®Œæ•´æ€§ä¿æŒè‰¯å¥½ï¼Œæ‰€æœ‰åŸæœ‰åŠŸèƒ½éƒ½æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥è¿›è¡ŒçœŸæœºæµ‹è¯•éªŒè¯ï¼ 