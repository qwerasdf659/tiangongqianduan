# ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è§„èŒƒæ–‡æ¡£ - ç¼–å†™æ ‡å‡†ä¸å‡†åˆ™

> **åŸºäºMySQLçš„æ•°æ®åº“è®¾è®¡è§„èŒƒ** - ä¸“ä¸šæ•°æ®åº“æ¶æ„è®¾è®¡æ ‡å‡†

## ğŸ“‹ ä¸€ã€æ–‡æ¡£å®šä½ä¸æ ‡å‡†

### 1.1 æ–‡æ¡£å®šä½
- **å”¯ä¸€å—ä¼—**ï¼šæ•°æ®åº“è®¾è®¡å¸ˆã€DBAã€åç«¯æ¶æ„å¸ˆ
- **æ ¸å¿ƒèŒè´£**ï¼šæ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–è§„èŒƒ
- **æŠ€æœ¯è¾¹ç•Œ**ï¼šä»…æ¶µç›–æ•°æ®åº“å±‚é¢ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **å†…å®¹æ·±åº¦**ï¼šæ·±å…¥æ•°æ®åº“ä¸“ä¸šé¢†åŸŸï¼Œæä¾›ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆ

### 1.2 æ–‡æ¡£ç»“æ„æ ‡å‡†
```
# MySQLæ•°æ®åº“è®¾è®¡è§„èŒƒ
â”œâ”€â”€ ğŸ—ï¸ æ•°æ®åº“æ¶æ„è®¾è®¡
â”œâ”€â”€ ğŸ“Š è¡¨ç»“æ„è®¾è®¡è§„èŒƒ
â”œâ”€â”€ ğŸ”‘ å­—æ®µå‘½åè§„èŒƒ
â”œâ”€â”€ ğŸ“ˆ ç´¢å¼•è®¾è®¡è§„èŒƒ
â”œâ”€â”€ ğŸ”„ æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ
â”œâ”€â”€ ğŸ” æ•°æ®å®‰å…¨è§„èŒƒ
â”œâ”€â”€ ğŸ“‹ æ•°æ®è¿ç§»è§„èŒƒ
â”œâ”€â”€ ğŸ’¾ å¤‡ä»½æ¢å¤è§„èŒƒ
â””â”€â”€ ğŸ“Š ç›‘æ§ç»´æŠ¤è§„èŒƒ
```

## ğŸ—ï¸ äºŒã€æ•°æ®åº“æ¶æ„è®¾è®¡

### 2.1 æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡ï¼ˆåŸºäºå¤©å·¥é¡¹ç›®å®æˆ˜ï¼‰

#### ğŸ”´ ç”¨æˆ·è¡¨ (users) - ç”¨æˆ·ç®¡ç†æ ¸å¿ƒ
```sql
-- ğŸ”´ usersè¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE users (
  user_id INT PRIMARY KEY AUTO_INCREMENT,      -- ğŸ”´ å‰ç«¯: userInfo.user_id
  mobile VARCHAR(11) UNIQUE NOT NULL,          -- ğŸ”´ å‰ç«¯: userInfo.mobile (è„±æ•æ˜¾ç¤º)
  total_points INT DEFAULT 0,                  -- ğŸ”´ å‰ç«¯: totalPoints (WebSocketå®æ—¶åŒæ­¥)
  is_merchant BOOLEAN DEFAULT FALSE,           -- ğŸ”´ å‰ç«¯: userInfo.is_merchant
  nickname VARCHAR(50),                        -- ğŸ”´ å‰ç«¯: userInfo.nickname
  avatar VARCHAR(255),                         -- ğŸ”´ å‰ç«¯: userInfo.avatar
  wx_openid VARCHAR(100),                      -- å¾®ä¿¡OpenID
  last_login TIMESTAMP,                        -- æœ€åç™»å½•æ—¶é—´
  status ENUM('active', 'banned') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_mobile (mobile),
  INDEX idx_openid (wx_openid),
  INDEX idx_points (total_points)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨';
```

**ğŸ”´ å‰ç«¯å­—æ®µæ˜ å°„å…³ç³»ï¼š**
```javascript
// ç”¨æˆ·ä¿¡æ¯æ•°æ®ç»“æ„æ˜ å°„
const userFieldMapping = {
  // å‰ç«¯å­—æ®µ -> æ•°æ®åº“å­—æ®µ
  'userInfo.user_id': 'users.user_id',
  'userInfo.mobile': 'users.mobile',           // æ˜¾ç¤ºæ—¶éœ€è„±æ•: 138****8000
  'totalPoints': 'users.total_points',         // WebSocketå®æ—¶åŒæ­¥
  'userInfo.is_merchant': 'users.is_merchant', // æ§åˆ¶é¡µé¢åŠŸèƒ½æ˜¾ç¤º
  'userInfo.nickname': 'users.nickname',
  'userInfo.avatar': 'users.avatar'
}
```

#### ğŸ”´ æŠ½å¥–å¥–å“è¡¨ (lottery_prizes) - è½¬ç›˜æŠ½å¥–æ ¸å¿ƒ
```sql
-- ğŸ”´ lottery_prizesè¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE lottery_prizes (
  prize_id INT PRIMARY KEY AUTO_INCREMENT,
  prize_name VARCHAR(100) NOT NULL,            -- ğŸ”´ å‰ç«¯: prizes[].name
  prize_type ENUM('points', 'coupon', 'physical', 'empty'),
  prize_value DECIMAL(10,2),                   -- å¥–å“ä»·å€¼
  angle INT NOT NULL,                          -- ğŸ”´ å‰ç«¯: prizes[].angle (Canvasè§’åº¦)
  color VARCHAR(7) NOT NULL,                   -- ğŸ”´ å‰ç«¯: prizes[].color (åå…­è¿›åˆ¶è‰²å€¼)
  probability DECIMAL(6,4) NOT NULL,           -- ğŸ”´ å‰ç«¯: prizes[].probability (ä¸­å¥–æ¦‚ç‡)
  is_activity BOOLEAN DEFAULT FALSE,           -- ğŸ”´ å‰ç«¯: prizes[].is_activity (ç‰¹æ®Šæ•ˆæœ)
  cost_points INT DEFAULT 100,                 -- ğŸ”´ å‰ç«¯: costPoints (å•æ¬¡æ¶ˆè€—ç§¯åˆ†)
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_status_probability (status, probability),
  INDEX idx_angle (angle)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ½å¥–å¥–å“é…ç½®è¡¨';
```

**ğŸ”´ å‰ç«¯Canvasç»˜åˆ¶å…³é”®æ˜ å°„ï¼š**
```javascript
// æŠ½å¥–è½¬ç›˜æ•°æ®æ˜ å°„ - å…³é”®å¯¹æ¥ä¿¡æ¯
const lotteryFieldMapping = {
  // Canvasç»˜åˆ¶å‚æ•°æ˜ å°„
  'prizes[].angle': 'lottery_prizes.angle',       // æ‰‡å½¢èµ·å§‹è§’åº¦(0-315,æ­¥é•¿45)
  'prizes[].color': 'lottery_prizes.color',       // æ‰‡å½¢å¡«å……é¢œè‰²(#FF6B35)
  'prizes[].name': 'lottery_prizes.prize_name',   // å¥–å“åç§°æ˜¾ç¤º
  'prizes[].probability': 'lottery_prizes.probability', // ä¸­å¥–æ¦‚ç‡(0-1)
  
  // æŠ½å¥–ä¸šåŠ¡å‚æ•°æ˜ å°„
  'costPoints': 'lottery_prizes.cost_points',     // æŠ½å¥–æ¶ˆè€—ç§¯åˆ†
  'prizes[].is_activity': 'lottery_prizes.is_activity' // ç‰¹æ®ŠåŠ¨ç”»æ•ˆæœ
}
```

#### ğŸ”´ å•†å“è¡¨ (products) - ç§¯åˆ†å…‘æ¢æ ¸å¿ƒ
```sql
-- ğŸ”´ productsè¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE products (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,                  -- ğŸ”´ å‰ç«¯: product.name
  exchange_points INT NOT NULL,                -- ğŸ”´ å‰ç«¯: product.exchange_points
  stock INT NOT NULL,                          -- ğŸ”´ å‰ç«¯: product.stock (WebSocketåŒæ­¥)
  category VARCHAR(50),                        -- ğŸ”´ å‰ç«¯: product.category
  is_hot BOOLEAN DEFAULT FALSE,                -- ğŸ”´ å‰ç«¯: product.is_hot
  image_url VARCHAR(500),                      -- å•†å“å›¾ç‰‡URL
  description TEXT,                            -- å•†å“æè¿°
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_category_status (category, status),
  INDEX idx_stock (stock),
  INDEX idx_points (exchange_points)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…‘æ¢å•†å“è¡¨';
```

#### ğŸ”´ ä¸Šä¼ å®¡æ ¸è¡¨ (upload_reviews) - å›¾ç‰‡å®¡æ ¸æ ¸å¿ƒ
```sql
-- ğŸ”´ upload_reviewsè¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE upload_reviews (
  upload_id VARCHAR(50) PRIMARY KEY,           -- ğŸ”´ å‰ç«¯: upload.upload_id
  user_id INT NOT NULL,
  image_url VARCHAR(500) NOT NULL,             -- ğŸ”´ å‰ç«¯: upload.image_url
  original_filename VARCHAR(255),              -- åŸå§‹æ–‡ä»¶å
  file_size INT,                               -- æ–‡ä»¶å¤§å°(å­—èŠ‚)
  amount DECIMAL(10,2),                        -- ğŸ”´ å‰ç«¯: upload.amount
  points_awarded INT DEFAULT 0,                -- ğŸ”´ å‰ç«¯: upload.points_awarded
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  review_reason TEXT,                          -- ğŸ”´ å‰ç«¯: upload.review_reason
  reviewed_by INT,                             -- å®¡æ ¸äººID
  reviewed_at TIMESTAMP NULL,                  -- å®¡æ ¸æ—¶é—´
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (reviewed_by) REFERENCES users(user_id),
  INDEX idx_status_time (review_status, created_at),
  INDEX idx_user_status (user_id, review_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¸Šä¼ å›¾ç‰‡å®¡æ ¸è¡¨';
```

#### ğŸ”´ ç§¯åˆ†è®°å½•è¡¨ (points_history) - ç§¯åˆ†æµæ°´æ ¸å¿ƒ
```sql
-- ğŸ”´ points_historyè¡¨ç»“æ„è®¾è®¡ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE points_history (
  history_id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  points_change INT NOT NULL,                  -- ç§¯åˆ†å˜åŠ¨æ•°é‡(æ­£æ•°å¢åŠ ,è´Ÿæ•°å‡å°‘)
  change_type ENUM('earn', 'spend', 'admin') NOT NULL, -- å˜åŠ¨ç±»å‹
  change_reason VARCHAR(200),                  -- å˜åŠ¨åŸå› 
  related_id VARCHAR(50),                      -- å…³è”ä¸šåŠ¡ID
  balance_before INT NOT NULL,                 -- å˜åŠ¨å‰ä½™é¢
  balance_after INT NOT NULL,                  -- å˜åŠ¨åä½™é¢
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  INDEX idx_user_time (user_id, created_at),
  INDEX idx_type_time (change_type, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç§¯åˆ†å˜åŠ¨è®°å½•è¡¨';

-- ğŸ”´ æŠ½å¥–å¥–å“è¡¨ (lottery_prizes)
CREATE TABLE lottery_prizes (
  prize_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'å¥–å“ID',
  prize_name VARCHAR(100) NOT NULL COMMENT 'å¥–å“åç§°',
  prize_type ENUM('points', 'coupon', 'product', 'none') NOT NULL COMMENT 'å¥–å“ç±»å‹',
  prize_value DECIMAL(10,2) DEFAULT 0 COMMENT 'å¥–å“ä»·å€¼',
  probability DECIMAL(5,4) NOT NULL COMMENT 'ä¸­å¥–æ¦‚ç‡(0-1)',
  angle SMALLINT NOT NULL COMMENT 'è½¬ç›˜è§’åº¦(0-315)',
  color VARCHAR(7) NOT NULL COMMENT 'æ‰‡å½¢é¢œè‰²',
  status ENUM('active', 'inactive') DEFAULT 'active' COMMENT 'çŠ¶æ€',
  sort_order TINYINT DEFAULT 0 COMMENT 'æ’åº',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_status_sort (status, sort_order),
  INDEX idx_probability (probability)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æŠ½å¥–å¥–å“é…ç½®è¡¨';

-- ğŸ”´ å•†å“è¡¨ (products)
CREATE TABLE products (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'å•†å“ID',
  name VARCHAR(100) NOT NULL COMMENT 'å•†å“åç§°',
  description TEXT COMMENT 'å•†å“æè¿°',
  exchange_points INT NOT NULL COMMENT 'å…‘æ¢ç§¯åˆ†',
  stock INT NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
  category VARCHAR(50) DEFAULT '' COMMENT 'å•†å“åˆ†ç±»',
  is_hot BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦çƒ­é—¨',
  status ENUM('active', 'inactive', 'sold_out') DEFAULT 'active' COMMENT 'å•†å“çŠ¶æ€',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_category_status (category, status),
  INDEX idx_points_stock (exchange_points, stock),
  INDEX idx_is_hot (is_hot)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“ä¿¡æ¯è¡¨';

-- ğŸ”´ ä¸Šä¼ å®¡æ ¸è¡¨ (upload_reviews)
CREATE TABLE upload_reviews (
  upload_id VARCHAR(50) PRIMARY KEY COMMENT 'ä¸Šä¼ å”¯ä¸€æ ‡è¯†',
  user_id INT NOT NULL COMMENT 'ç”¨æˆ·ID',
  image_url VARCHAR(500) NOT NULL COMMENT 'å›¾ç‰‡URL',
  amount DECIMAL(10,2) COMMENT 'æ¶ˆè´¹é‡‘é¢',
  points_awarded INT DEFAULT 0 COMMENT 'å¥–åŠ±ç§¯åˆ†',
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT 'å®¡æ ¸çŠ¶æ€',
  review_reason TEXT COMMENT 'å®¡æ ¸å¤‡æ³¨',
  reviewer_id INT COMMENT 'å®¡æ ¸äººID',
  reviewed_at TIMESTAMP NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  INDEX idx_user_status (user_id, review_status),
  INDEX idx_status_time (review_status, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¸Šä¼ å®¡æ ¸è®°å½•è¡¨';
```

### 2.2 å­—æ®µè®¾è®¡æ ‡å‡†
```sql
-- ğŸ”´ å­—æ®µå‘½åè§„èŒƒ
FIELD_NAMING_RULES = {
  pattern: 'snake_case',           -- ä¸‹åˆ’çº¿å‘½å
  primaryKey: '{table}_id',        -- ä¸»é”®ï¼šuser_id, product_id
  foreignKey: '{ref_table}_id',    -- å¤–é”®ï¼šuser_id, category_id
  timestamp: '_at',                -- æ—¶é—´æˆ³ï¼šcreated_at, updated_at
  boolean: 'is_', 'has_', 'can_',  -- å¸ƒå°”å‹ï¼šis_active, has_permission
  status: 'status',                -- çŠ¶æ€å­—æ®µç»Ÿä¸€å‘½å
  amount: 'money', 'points'        -- é‡‘é¢å’Œç§¯åˆ†å­—æ®µ
}

-- ğŸ”´ å­—æ®µç±»å‹é€‰æ‹©æ ‡å‡†
DATA_TYPE_STANDARDS = {
  -- å­—ç¬¦ä¸²ç±»å‹
  shortString: 'VARCHAR(50)',      -- çŸ­å­—ç¬¦ä¸²ï¼šæ˜µç§°ã€åˆ†ç±»
  normalString: 'VARCHAR(255)',    -- æ™®é€šå­—ç¬¦ä¸²ï¼šURLã€æè¿°
  longText: 'TEXT',                -- é•¿æ–‡æœ¬ï¼šè¯¦ç»†æè¿°
  
  -- æ•°å€¼ç±»å‹
  id: 'INT',                       -- ä¸»é”®ID
  smallNumber: 'TINYINT',          -- å°æ•°å€¼ï¼šçŠ¶æ€ç ã€æ’åº
  normalNumber: 'INT',             -- æ™®é€šæ•°å€¼ï¼šç§¯åˆ†ã€æ•°é‡
  decimal: 'DECIMAL(10,2)',        -- é‡‘é¢ï¼šç²¾ç¡®åˆ°åˆ†
  
  -- æ—¶é—´ç±»å‹
  timestamp: 'TIMESTAMP',          -- æ—¶é—´æˆ³
  date: 'DATE',                    -- æ—¥æœŸ
  
  -- ç‰¹æ®Šç±»å‹
  json: 'JSON',                    -- JSONæ•°æ®
  enum: 'ENUM(...)',               -- æšä¸¾å€¼
  boolean: 'BOOLEAN'               -- å¸ƒå°”å€¼
}
```

## ğŸ“ˆ ä¸‰ã€ç´¢å¼•è®¾è®¡è§„èŒƒ

### 3.1 ç´¢å¼•ç­–ç•¥
```sql
-- ğŸ”´ ç´¢å¼•è®¾è®¡åŸåˆ™
INDEX_DESIGN_PRINCIPLES = {
  -- 1. ä¸»é”®ç´¢å¼•ï¼šæ¯ä¸ªè¡¨å¿…é¡»æœ‰ä¸»é”®
  primaryKey: 'AUTO_INCREMENT INT PRIMARY KEY',
  
  -- 2. å”¯ä¸€ç´¢å¼•ï¼šç¡®ä¿æ•°æ®å”¯ä¸€æ€§
  uniqueIndex: 'UNIQUE KEY uk_{field_name} ({field_name})',
  
  -- 3. æ™®é€šç´¢å¼•ï¼šæå‡æŸ¥è¯¢æ€§èƒ½
  normalIndex: 'INDEX idx_{field_name} ({field_name})',
  
  -- 4. è”åˆç´¢å¼•ï¼šå¤šå­—æ®µæŸ¥è¯¢ä¼˜åŒ–
  compositeIndex: 'INDEX idx_{field1}_{field2} ({field1}, {field2})',
  
  -- 5. å¤–é”®ç´¢å¼•ï¼šå¤–é”®å…³è”æŸ¥è¯¢ä¼˜åŒ–
  foreignKeyIndex: 'INDEX idx_{foreign_key} ({foreign_key_field})'
}

-- âœ… æ ¸å¿ƒä¸šåŠ¡ç´¢å¼•ç¤ºä¾‹
-- ç”¨æˆ·è¡¨ç´¢å¼•
ALTER TABLE users ADD UNIQUE INDEX uk_mobile (mobile);
ALTER TABLE users ADD UNIQUE INDEX uk_wx_openid (wx_openid);
ALTER TABLE users ADD INDEX idx_status_merchant (status, is_merchant);

-- å•†å“è¡¨ç´¢å¼•
ALTER TABLE products ADD INDEX idx_category_status (category, status);
ALTER TABLE products ADD INDEX idx_points_stock (exchange_points, stock);

-- å®¡æ ¸è¡¨ç´¢å¼•
ALTER TABLE upload_reviews ADD INDEX idx_user_status (user_id, review_status);
ALTER TABLE upload_reviews ADD INDEX idx_status_time (review_status, created_at);
```

### 3.2 æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ
```sql
-- ğŸ”´ é«˜æ•ˆæŸ¥è¯¢ç¤ºä¾‹
-- âœ… æ­£ç¡®ï¼šä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢
SELECT user_id, mobile, total_points 
FROM users 
WHERE status = 'active' AND is_merchant = TRUE
ORDER BY created_at DESC 
LIMIT 20;

-- âœ… æ­£ç¡®ï¼šè”åˆç´¢å¼•æœ€å·¦å‰ç¼€åŒ¹é…
SELECT * FROM upload_reviews 
WHERE review_status = 'pending' 
ORDER BY created_at ASC;

-- âŒ é¿å…ï¼šä½¿ç”¨å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ
SELECT * FROM users WHERE YEAR(created_at) = 2024;

-- âœ… æ­£ç¡®ï¼šèŒƒå›´æŸ¥è¯¢ä¿æŒç´¢å¼•æœ‰æ•ˆ
SELECT * FROM users 
WHERE created_at >= '2024-01-01' 
AND created_at < '2025-01-01';
```

## ğŸ” å››ã€æ•°æ®å®‰å…¨è§„èŒƒ

### 4.1 æ•æ„Ÿæ•°æ®å¤„ç†
```sql
-- ğŸ”´ æ•æ„Ÿæ•°æ®è®¾è®¡è§„èŒƒ
SENSITIVE_DATA_RULES = {
  -- 1. æ•°æ®è„±æ•ï¼šæ•æ„Ÿä¿¡æ¯ä¸æ˜æ–‡å­˜å‚¨
  mobile: 'VARCHAR(11) + åŠ å¯†å­˜å‚¨',
  realName: 'VARCHAR(50) + åŠ å¯†å­˜å‚¨',
  idCard: 'ç¦æ­¢å­˜å‚¨å®Œæ•´èº«ä»½è¯å·',
  
  -- 2. è½¯åˆ é™¤ï¼šé‡è¦æ•°æ®æ ‡è®°åˆ é™¤ä¸ç‰©ç†åˆ é™¤
  softDelete: 'deleted_at TIMESTAMP NULL',
  
  -- 3. æ“ä½œæ—¥å¿—ï¼šè®°å½•æ•°æ®å˜æ›´å†å²
  auditLog: 'ç‹¬ç«‹å®¡è®¡æ—¥å¿—è¡¨è®°å½•æ‰€æœ‰å˜æ›´'
}

-- ğŸ”´ æ•°æ®å®¡è®¡è¡¨è®¾è®¡
CREATE TABLE audit_logs (
  log_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  table_name VARCHAR(50) NOT NULL COMMENT 'è¡¨å',
  record_id VARCHAR(50) NOT NULL COMMENT 'è®°å½•ID',
  operation ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL COMMENT 'æ“ä½œç±»å‹',
  old_values JSON COMMENT 'åŸå€¼',
  new_values JSON COMMENT 'æ–°å€¼',
  user_id INT COMMENT 'æ“ä½œç”¨æˆ·ID',
  ip_address VARCHAR(45) COMMENT 'æ“ä½œIP',
  user_agent TEXT COMMENT 'ç”¨æˆ·ä»£ç†',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_table_record (table_name, record_id),
  INDEX idx_user_time (user_id, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®å˜æ›´å®¡è®¡æ—¥å¿—';
```

### 4.2 æ•°æ®å¤‡ä»½ç­–ç•¥
```sql
-- ğŸ”´ å¤‡ä»½æ¢å¤è§„èŒƒ
BACKUP_STRATEGY = {
  -- 1. å…¨é‡å¤‡ä»½ï¼šæ¯æ—¥å‡Œæ™¨è¿›è¡Œå…¨åº“å¤‡ä»½
  fullBackup: {
    frequency: 'daily',
    time: '02:00',
    retention: '30 days',
    location: '/backup/mysql/full/'
  },
  
  -- 2. å¢é‡å¤‡ä»½ï¼šæ¯å°æ—¶è¿›è¡Œbinlogå¤‡ä»½
  incrementalBackup: {
    frequency: 'hourly',
    method: 'binlog',
    retention: '7 days',
    location: '/backup/mysql/binlog/'
  },
  
  -- 3. å¤‡ä»½éªŒè¯ï¼šå®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
  verification: {
    frequency: 'weekly',
    method: 'restore test',
    testDatabase: 'backup_test'
  }
}

-- å¤‡ä»½è„šæœ¬ç¤ºä¾‹
-- å…¨é‡å¤‡ä»½
mysqldump --single-transaction --routines --triggers \
  --all-databases > /backup/mysql/full/backup_$(date +%Y%m%d).sql

-- å¢é‡å¤‡ä»½
mysqlbinlog --start-datetime="2024-12-19 01:00:00" \
  /var/lib/mysql/mysql-bin.000001 > /backup/mysql/binlog/binlog_$(date +%Y%m%d_%H).sql
```

## ğŸ“‹ äº”ã€æ•°æ®è¿ç§»è§„èŒƒ

### 5.1 ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
```sql
-- ğŸ”´ æ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶è¡¨
CREATE TABLE schema_migrations (
  version VARCHAR(20) PRIMARY KEY COMMENT 'ç‰ˆæœ¬å·',
  description VARCHAR(255) NOT NULL COMMENT 'å˜æ›´æè¿°',
  sql_file VARCHAR(255) NOT NULL COMMENT 'SQLæ–‡ä»¶å',
  checksum VARCHAR(64) NOT NULL COMMENT 'æ–‡ä»¶æ ¡éªŒå’Œ',
  applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æ‰§è¡Œæ—¶é—´',
  execution_time INT COMMENT 'æ‰§è¡Œè€—æ—¶(æ¯«ç§’)'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®åº“è¿ç§»ç‰ˆæœ¬è®°å½•';

-- ğŸ”´ è¿ç§»è„šæœ¬å‘½åè§„èŒƒ
MIGRATION_NAMING = {
  pattern: 'V{version}__{description}.sql',
  examples: [
    'V1.0.0__init_database.sql',
    'V1.0.1__add_user_avatar.sql',
    'V1.1.0__create_lottery_table.sql'
  ]
}
```

### 5.2 å®‰å…¨è¿ç§»æµç¨‹
```sql
-- ğŸ”´ è¿ç§»å‰æ£€æŸ¥æ¸…å•
PRE_MIGRATION_CHECKLIST = {
  -- 1. æ•°æ®å¤‡ä»½ï¼šæ‰§è¡Œè¿ç§»å‰å¿…é¡»å®Œæˆå¤‡ä»½
  backup: 'mysqldump --single-transaction database_name',
  
  -- 2. å½±å“è¯„ä¼°ï¼šè¯„ä¼°è¿ç§»å¯¹ä¸šåŠ¡çš„å½±å“
  impact: 'è¯„ä¼°é”è¡¨æ—¶é—´ã€æ•°æ®é‡ã€ä¸šåŠ¡åœæœºæ—¶é—´',
  
  -- 3. å›æ»šæ–¹æ¡ˆï¼šå‡†å¤‡å›æ»šSQLè„šæœ¬
  rollback: 'å‡†å¤‡å¯¹åº”çš„å›æ»šè„šæœ¬',
  
  -- 4. æµ‹è¯•éªŒè¯ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»è„šæœ¬
  testing: 'åœ¨æµ‹è¯•ç¯å¢ƒå®Œæ•´æ‰§è¡Œä¸€éè¿ç§»æµç¨‹'
}

-- âœ… å®‰å…¨çš„è¡¨ç»“æ„å˜æ›´ç¤ºä¾‹
-- æ·»åŠ å­—æ®µï¼ˆå®‰å…¨ï¼‰
ALTER TABLE users ADD COLUMN avatar VARCHAR(255) DEFAULT '' COMMENT 'ç”¨æˆ·å¤´åƒ';

-- åˆ é™¤å­—æ®µï¼ˆåˆ†æ­¥æ‰§è¡Œï¼‰
-- ç¬¬ä¸€æ­¥ï¼šæ ‡è®°å­—æ®µä¸ºåºŸå¼ƒï¼ˆä¸šåŠ¡ä»£ç åœæ­¢ä½¿ç”¨ï¼‰
-- ç¬¬äºŒæ­¥ï¼šç­‰å¾…ä¸€ä¸ªç‰ˆæœ¬ååˆ é™¤å­—æ®µ
ALTER TABLE users DROP COLUMN deprecated_field;

-- å¤§è¡¨æ•°æ®è¿ç§»ï¼ˆåˆ†æ‰¹æ‰§è¡Œï¼‰
-- é¿å…é•¿æ—¶é—´é”è¡¨ï¼Œä½¿ç”¨åˆ†æ‰¹å¤„ç†
UPDATE users SET avatar = '' WHERE avatar IS NULL AND user_id BETWEEN 1 AND 1000;
UPDATE users SET avatar = '' WHERE avatar IS NULL AND user_id BETWEEN 1001 AND 2000;
-- ç»§ç»­åˆ†æ‰¹æ‰§è¡Œ...
```

## ğŸ“Š å…­ã€æ€§èƒ½ç›‘æ§è§„èŒƒ

### 6.1 ç›‘æ§æŒ‡æ ‡å®šä¹‰
```sql
-- ğŸ”´ å…³é”®æ€§èƒ½æŒ‡æ ‡
PERFORMANCE_METRICS = {
  -- 1. æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡
  queryPerformance: {
    slowQueryThreshold: '1 second',
    longQueryThreshold: '10 seconds',
    deadlockDetection: 'enabled',
    indexUsageTracking: 'enabled'
  },
  
  -- 2. è¿æ¥æ± æŒ‡æ ‡
  connectionPool: {
    maxConnections: '100',
    activeConnections: 'monitor',
    waitingConnections: 'alert if > 10',
    connectionLeaks: 'monitor'
  },
  
  -- 3. å­˜å‚¨æŒ‡æ ‡
  storage: {
    diskUsage: 'alert if > 80%',
    tableSize: 'monitor growth',
    indexSize: 'monitor efficiency',
    fragmentationLevel: 'optimize if > 30%'
  }
}

-- ğŸ”´ æ…¢æŸ¥è¯¢ç›‘æ§é…ç½®
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- å®šæœŸåˆ†ææ…¢æŸ¥è¯¢
-- ä½¿ç”¨ pt-query-digest åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
pt-query-digest /var/lib/mysql/slow-query.log
```

### 6.2 è¡¨ç»´æŠ¤è§„èŒƒ
```sql
-- ğŸ”´ å®šæœŸç»´æŠ¤ä»»åŠ¡
MAINTENANCE_TASKS = {
  -- 1. è¡¨ä¼˜åŒ–ï¼šå®šæœŸä¼˜åŒ–è¡¨ç»“æ„
  optimize: 'OPTIMIZE TABLE table_name',
  
  -- 2. ç´¢å¼•é‡å»ºï¼šé‡å»ºç¢ç‰‡åŒ–ä¸¥é‡çš„ç´¢å¼•
  rebuild: 'ALTER TABLE table_name ENGINE=InnoDB',
  
  -- 3. ç»Ÿè®¡ä¿¡æ¯æ›´æ–°ï¼šæ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
  analyze: 'ANALYZE TABLE table_name',
  
  -- 4. æ•°æ®æ¸…ç†ï¼šæ¸…ç†è¿‡æœŸæ•°æ®
  cleanup: 'å®šæœŸæ¸…ç†æ—¥å¿—è¡¨ã€ä¸´æ—¶æ•°æ®'
}

-- ç»´æŠ¤è„šæœ¬ç¤ºä¾‹
-- ä¼˜åŒ–æ‰€æœ‰è¡¨
OPTIMIZE TABLE users, products, lottery_prizes, upload_reviews;

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE users, products, lottery_prizes, upload_reviews;

-- æ¸…ç†è¿‡æœŸæ—¥å¿—ï¼ˆä¿ç•™30å¤©ï¼‰
DELETE FROM audit_logs WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

## ğŸ¯ ä¸ƒã€æ•°æ®è´¨é‡ä¿éšœ

### 7.1 çº¦æŸå’Œæ ¡éªŒ
```sql
-- ğŸ”´ æ•°æ®å®Œæ•´æ€§çº¦æŸ
DATA_INTEGRITY_CONSTRAINTS = {
  -- 1. ä¸»é”®çº¦æŸï¼šç¡®ä¿è®°å½•å”¯ä¸€æ€§
  primaryKey: 'PRIMARY KEY (id)',
  
  -- 2. å¤–é”®çº¦æŸï¼šç»´æŠ¤å…³è”å…³ç³»
  foreignKey: 'FOREIGN KEY (user_id) REFERENCES users(user_id)',
  
  -- 3. å”¯ä¸€çº¦æŸï¼šé˜²æ­¢é‡å¤æ•°æ®
  unique: 'UNIQUE KEY uk_mobile (mobile)',
  
  -- 4. æ£€æŸ¥çº¦æŸï¼šæ•°æ®èŒƒå›´éªŒè¯
  check: 'CHECK (total_points >= 0)',
  
  -- 5. éç©ºçº¦æŸï¼šå¿…å¡«å­—æ®µéªŒè¯
  notNull: 'NOT NULL'
}

-- âœ… æ•°æ®æ ¡éªŒè§„åˆ™ç¤ºä¾‹
ALTER TABLE users 
ADD CONSTRAINT chk_mobile CHECK (mobile REGEXP '^1[3-9][0-9]{9}$'),
ADD CONSTRAINT chk_points CHECK (total_points >= 0);

ALTER TABLE products
ADD CONSTRAINT chk_stock CHECK (stock >= 0),
ADD CONSTRAINT chk_points CHECK (exchange_points > 0);
```

### 7.2 æ•°æ®æ¸…ç†ç­–ç•¥
```sql
-- ğŸ”´ æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†
DATA_LIFECYCLE_MANAGEMENT = {
  -- 1. è½¯åˆ é™¤ï¼šæ ‡è®°åˆ é™¤ï¼Œä¿ç•™æ•°æ®
  softDelete: {
    mechanism: 'deleted_at timestamp',
    retention: 'ç‰©ç†åˆ é™¤å‰ä¿ç•™90å¤©'
  },
  
  -- 2. å½’æ¡£ç­–ç•¥ï¼šå†å²æ•°æ®å½’æ¡£
  archive: {
    criteria: 'è¶…è¿‡1å¹´çš„å†å²è®°å½•',
    destination: 'å½’æ¡£è¡¨æˆ–å†·å­˜å‚¨',
    frequency: 'æœˆåº¦å½’æ¡£'
  },
  
  -- 3. æ¸…ç†ç­–ç•¥ï¼šå®šæœŸæ¸…ç†ä¸´æ—¶æ•°æ®
  cleanup: {
    logData: 'æ—¥å¿—æ•°æ®ä¿ç•™30å¤©',
    tempData: 'ä¸´æ—¶æ•°æ®ä¿ç•™7å¤©',
    testData: 'æµ‹è¯•æ•°æ®åŠæ—¶æ¸…ç†'
  }
}

-- æ•°æ®å½’æ¡£è„šæœ¬ç¤ºä¾‹
-- åˆ›å»ºå½’æ¡£è¡¨
CREATE TABLE lottery_records_archive LIKE lottery_records;

-- å½’æ¡£å†å²æ•°æ®
INSERT INTO lottery_records_archive 
SELECT * FROM lottery_records 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- åˆ é™¤å·²å½’æ¡£æ•°æ®
DELETE FROM lottery_records 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);
```

---

## ğŸ¯ æ€»ç»“ï¼šæ•°æ®åº“è®¾è®¡è§„èŒƒä»·å€¼

### âœ… æ ¸å¿ƒæ”¶ç›Š
1. **æ•°æ®ä¸€è‡´æ€§**ï¼šè§„èŒƒçš„è®¾è®¡ç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
2. **æŸ¥è¯¢æ€§èƒ½**ï¼šåˆç†çš„ç´¢å¼•è®¾è®¡æå‡æŸ¥è¯¢æ•ˆç‡
3. **ç³»ç»Ÿç¨³å®šæ€§**ï¼šæ ‡å‡†åŒ–çš„ç»´æŠ¤æµç¨‹ä¿éšœç³»ç»Ÿç¨³å®šè¿è¡Œ
4. **å¯æ‰©å±•æ€§**ï¼šè§„èŒƒçš„æ¶æ„è®¾è®¡æ”¯æŒä¸šåŠ¡å¿«é€Ÿæ‰©å±•

### ğŸ¯ å®æ–½å»ºè®®
1. **åˆ†é˜¶æ®µå®æ–½**ï¼šä»æ ¸å¿ƒè¡¨å¼€å§‹ï¼Œé€æ­¥å®Œå–„æ•´ä¸ªæ•°æ®åº“è®¾è®¡
2. **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®ä¸šåŠ¡å‘å±•å’Œæ€§èƒ½ç›‘æ§æŒç»­ä¼˜åŒ–è®¾è®¡
3. **å›¢é˜ŸåŸ¹è®­**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜ç†è§£å’Œéµå¾ªè®¾è®¡è§„èŒƒ
4. **å·¥å…·æ”¯æŒ**ï¼šä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·è¾…åŠ©è®¾è®¡å’Œç»´æŠ¤

**æ–‡æ¡£å®šä½**ï¼šæ•°æ®åº“ä¸“ä¸šäººå‘˜æŠ€æœ¯è§„èŒƒ  
**è¦†ç›–èŒƒå›´**ï¼šMySQLæ•°æ®åº“è®¾è®¡å’Œç»´æŠ¤å…¨æµç¨‹  
**æ›´æ–°ç­–ç•¥**ï¼šéšæ•°æ®åº“æŠ€æœ¯å‘å±•æŒç»­æ›´æ–° 