# 🗄️ 数据库设计规范文档 - 编写标准与准则

> **基于MySQL的数据库设计规范** - 专业数据库架构设计标准

## 📋 一、文档定位与标准

### 1.1 文档定位
- **唯一受众**：数据库设计师、DBA、后端架构师
- **核心职责**：数据库表结构设计、性能优化规范
- **技术边界**：仅涵盖数据库层面，不包含业务逻辑
- **内容深度**：深入数据库专业领域，提供生产级解决方案

### 1.2 文档结构标准
```
# MySQL数据库设计规范
├── 🏗️ 数据库架构设计
├── 📊 表结构设计规范
├── 🔑 字段命名规范
├── 📈 索引设计规范
├── 🔄 查询优化规范
├── 🔐 数据安全规范
├── 📋 数据迁移规范
├── 💾 备份恢复规范
└── 📊 监控维护规范
```

## 🏗️ 二、数据库架构设计

### 2.1 核心表结构设计（基于天工项目实战）

#### 🔴 用户表 (users) - 用户管理核心
```sql
-- 🔴 users表结构设计（完整版）
CREATE TABLE users (
  user_id INT PRIMARY KEY AUTO_INCREMENT,      -- 🔴 前端: userInfo.user_id
  mobile VARCHAR(11) UNIQUE NOT NULL,          -- 🔴 前端: userInfo.mobile (脱敏显示)
  total_points INT DEFAULT 0,                  -- 🔴 前端: totalPoints (WebSocket实时同步)
  is_merchant BOOLEAN DEFAULT FALSE,           -- 🔴 前端: userInfo.is_merchant
  nickname VARCHAR(50),                        -- 🔴 前端: userInfo.nickname
  avatar VARCHAR(255),                         -- 🔴 前端: userInfo.avatar
  wx_openid VARCHAR(100),                      -- 微信OpenID
  last_login TIMESTAMP,                        -- 最后登录时间
  status ENUM('active', 'banned') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_mobile (mobile),
  INDEX idx_openid (wx_openid),
  INDEX idx_points (total_points)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基础信息表';
```

**🔴 前端字段映射关系：**
```javascript
// 用户信息数据结构映射
const userFieldMapping = {
  // 前端字段 -> 数据库字段
  'userInfo.user_id': 'users.user_id',
  'userInfo.mobile': 'users.mobile',           // 显示时需脱敏: 138****8000
  'totalPoints': 'users.total_points',         // WebSocket实时同步
  'userInfo.is_merchant': 'users.is_merchant', // 控制页面功能显示
  'userInfo.nickname': 'users.nickname',
  'userInfo.avatar': 'users.avatar'
}
```

#### 🔴 抽奖奖品表 (lottery_prizes) - 转盘抽奖核心
```sql
-- 🔴 lottery_prizes表结构设计（完整版）
CREATE TABLE lottery_prizes (
  prize_id INT PRIMARY KEY AUTO_INCREMENT,
  prize_name VARCHAR(100) NOT NULL,            -- 🔴 前端: prizes[].name
  prize_type ENUM('points', 'coupon', 'physical', 'empty'),
  prize_value DECIMAL(10,2),                   -- 奖品价值
  angle INT NOT NULL,                          -- 🔴 前端: prizes[].angle (Canvas角度)
  color VARCHAR(7) NOT NULL,                   -- 🔴 前端: prizes[].color (十六进制色值)
  probability DECIMAL(6,4) NOT NULL,           -- 🔴 前端: prizes[].probability (中奖概率)
  is_activity BOOLEAN DEFAULT FALSE,           -- 🔴 前端: prizes[].is_activity (特殊效果)
  cost_points INT DEFAULT 100,                 -- 🔴 前端: costPoints (单次消耗积分)
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_status_probability (status, probability),
  INDEX idx_angle (angle)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='抽奖奖品配置表';
```

**🔴 前端Canvas绘制关键映射：**
```javascript
// 抽奖转盘数据映射 - 关键对接信息
const lotteryFieldMapping = {
  // Canvas绘制参数映射
  'prizes[].angle': 'lottery_prizes.angle',       // 扇形起始角度(0-315,步长45)
  'prizes[].color': 'lottery_prizes.color',       // 扇形填充颜色(#FF6B35)
  'prizes[].name': 'lottery_prizes.prize_name',   // 奖品名称显示
  'prizes[].probability': 'lottery_prizes.probability', // 中奖概率(0-1)
  
  // 抽奖业务参数映射
  'costPoints': 'lottery_prizes.cost_points',     // 抽奖消耗积分
  'prizes[].is_activity': 'lottery_prizes.is_activity' // 特殊动画效果
}
```

#### 🔴 商品表 (products) - 积分兑换核心
```sql
-- 🔴 products表结构设计（完整版）
CREATE TABLE products (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,                  -- 🔴 前端: product.name
  exchange_points INT NOT NULL,                -- 🔴 前端: product.exchange_points
  stock INT NOT NULL,                          -- 🔴 前端: product.stock (WebSocket同步)
  category VARCHAR(50),                        -- 🔴 前端: product.category
  is_hot BOOLEAN DEFAULT FALSE,                -- 🔴 前端: product.is_hot
  image_url VARCHAR(500),                      -- 商品图片URL
  description TEXT,                            -- 商品描述
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_category_status (category, status),
  INDEX idx_stock (stock),
  INDEX idx_points (exchange_points)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='兑换商品表';
```

#### 🔴 上传审核表 (upload_reviews) - 图片审核核心
```sql
-- 🔴 upload_reviews表结构设计（完整版）
CREATE TABLE upload_reviews (
  upload_id VARCHAR(50) PRIMARY KEY,           -- 🔴 前端: upload.upload_id
  user_id INT NOT NULL,
  image_url VARCHAR(500) NOT NULL,             -- 🔴 前端: upload.image_url
  original_filename VARCHAR(255),              -- 原始文件名
  file_size INT,                               -- 文件大小(字节)
  amount DECIMAL(10,2),                        -- 🔴 前端: upload.amount
  points_awarded INT DEFAULT 0,                -- 🔴 前端: upload.points_awarded
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  review_reason TEXT,                          -- 🔴 前端: upload.review_reason
  reviewed_by INT,                             -- 审核人ID
  reviewed_at TIMESTAMP NULL,                  -- 审核时间
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (reviewed_by) REFERENCES users(user_id),
  INDEX idx_status_time (review_status, created_at),
  INDEX idx_user_status (user_id, review_status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='上传图片审核表';
```

#### 🔴 积分记录表 (points_history) - 积分流水核心
```sql
-- 🔴 points_history表结构设计（完整版）
CREATE TABLE points_history (
  history_id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  points_change INT NOT NULL,                  -- 积分变动数量(正数增加,负数减少)
  change_type ENUM('earn', 'spend', 'admin') NOT NULL, -- 变动类型
  change_reason VARCHAR(200),                  -- 变动原因
  related_id VARCHAR(50),                      -- 关联业务ID
  balance_before INT NOT NULL,                 -- 变动前余额
  balance_after INT NOT NULL,                  -- 变动后余额
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  INDEX idx_user_time (user_id, created_at),
  INDEX idx_type_time (change_type, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='积分变动记录表';

-- 🔴 抽奖奖品表 (lottery_prizes)
CREATE TABLE lottery_prizes (
  prize_id INT PRIMARY KEY AUTO_INCREMENT COMMENT '奖品ID',
  prize_name VARCHAR(100) NOT NULL COMMENT '奖品名称',
  prize_type ENUM('points', 'coupon', 'product', 'none') NOT NULL COMMENT '奖品类型',
  prize_value DECIMAL(10,2) DEFAULT 0 COMMENT '奖品价值',
  probability DECIMAL(5,4) NOT NULL COMMENT '中奖概率(0-1)',
  angle SMALLINT NOT NULL COMMENT '转盘角度(0-315)',
  color VARCHAR(7) NOT NULL COMMENT '扇形颜色',
  status ENUM('active', 'inactive') DEFAULT 'active' COMMENT '状态',
  sort_order TINYINT DEFAULT 0 COMMENT '排序',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_status_sort (status, sort_order),
  INDEX idx_probability (probability)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='抽奖奖品配置表';

-- 🔴 商品表 (products)
CREATE TABLE products (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID',
  name VARCHAR(100) NOT NULL COMMENT '商品名称',
  description TEXT COMMENT '商品描述',
  exchange_points INT NOT NULL COMMENT '兑换积分',
  stock INT NOT NULL DEFAULT 0 COMMENT '库存数量',
  category VARCHAR(50) DEFAULT '' COMMENT '商品分类',
  is_hot BOOLEAN DEFAULT FALSE COMMENT '是否热门',
  status ENUM('active', 'inactive', 'sold_out') DEFAULT 'active' COMMENT '商品状态',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_category_status (category, status),
  INDEX idx_points_stock (exchange_points, stock),
  INDEX idx_is_hot (is_hot)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品信息表';

-- 🔴 上传审核表 (upload_reviews)
CREATE TABLE upload_reviews (
  upload_id VARCHAR(50) PRIMARY KEY COMMENT '上传唯一标识',
  user_id INT NOT NULL COMMENT '用户ID',
  image_url VARCHAR(500) NOT NULL COMMENT '图片URL',
  amount DECIMAL(10,2) COMMENT '消费金额',
  points_awarded INT DEFAULT 0 COMMENT '奖励积分',
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending' COMMENT '审核状态',
  review_reason TEXT COMMENT '审核备注',
  reviewer_id INT COMMENT '审核人ID',
  reviewed_at TIMESTAMP NULL COMMENT '审核时间',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  INDEX idx_user_status (user_id, review_status),
  INDEX idx_status_time (review_status, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='上传审核记录表';
```

### 2.2 字段设计标准
```sql
-- 🔴 字段命名规范
FIELD_NAMING_RULES = {
  pattern: 'snake_case',           -- 下划线命名
  primaryKey: '{table}_id',        -- 主键：user_id, product_id
  foreignKey: '{ref_table}_id',    -- 外键：user_id, category_id
  timestamp: '_at',                -- 时间戳：created_at, updated_at
  boolean: 'is_', 'has_', 'can_',  -- 布尔型：is_active, has_permission
  status: 'status',                -- 状态字段统一命名
  amount: 'money', 'points'        -- 金额和积分字段
}

-- 🔴 字段类型选择标准
DATA_TYPE_STANDARDS = {
  -- 字符串类型
  shortString: 'VARCHAR(50)',      -- 短字符串：昵称、分类
  normalString: 'VARCHAR(255)',    -- 普通字符串：URL、描述
  longText: 'TEXT',                -- 长文本：详细描述
  
  -- 数值类型
  id: 'INT',                       -- 主键ID
  smallNumber: 'TINYINT',          -- 小数值：状态码、排序
  normalNumber: 'INT',             -- 普通数值：积分、数量
  decimal: 'DECIMAL(10,2)',        -- 金额：精确到分
  
  -- 时间类型
  timestamp: 'TIMESTAMP',          -- 时间戳
  date: 'DATE',                    -- 日期
  
  -- 特殊类型
  json: 'JSON',                    -- JSON数据
  enum: 'ENUM(...)',               -- 枚举值
  boolean: 'BOOLEAN'               -- 布尔值
}
```

## 📈 三、索引设计规范

### 3.1 索引策略
```sql
-- 🔴 索引设计原则
INDEX_DESIGN_PRINCIPLES = {
  -- 1. 主键索引：每个表必须有主键
  primaryKey: 'AUTO_INCREMENT INT PRIMARY KEY',
  
  -- 2. 唯一索引：确保数据唯一性
  uniqueIndex: 'UNIQUE KEY uk_{field_name} ({field_name})',
  
  -- 3. 普通索引：提升查询性能
  normalIndex: 'INDEX idx_{field_name} ({field_name})',
  
  -- 4. 联合索引：多字段查询优化
  compositeIndex: 'INDEX idx_{field1}_{field2} ({field1}, {field2})',
  
  -- 5. 外键索引：外键关联查询优化
  foreignKeyIndex: 'INDEX idx_{foreign_key} ({foreign_key_field})'
}

-- ✅ 核心业务索引示例
-- 用户表索引
ALTER TABLE users ADD UNIQUE INDEX uk_mobile (mobile);
ALTER TABLE users ADD UNIQUE INDEX uk_wx_openid (wx_openid);
ALTER TABLE users ADD INDEX idx_status_merchant (status, is_merchant);

-- 商品表索引
ALTER TABLE products ADD INDEX idx_category_status (category, status);
ALTER TABLE products ADD INDEX idx_points_stock (exchange_points, stock);

-- 审核表索引
ALTER TABLE upload_reviews ADD INDEX idx_user_status (user_id, review_status);
ALTER TABLE upload_reviews ADD INDEX idx_status_time (review_status, created_at);
```

### 3.2 查询优化规范
```sql
-- 🔴 高效查询示例
-- ✅ 正确：使用索引字段查询
SELECT user_id, mobile, total_points 
FROM users 
WHERE status = 'active' AND is_merchant = TRUE
ORDER BY created_at DESC 
LIMIT 20;

-- ✅ 正确：联合索引最左前缀匹配
SELECT * FROM upload_reviews 
WHERE review_status = 'pending' 
ORDER BY created_at ASC;

-- ❌ 避免：使用函数导致索引失效
SELECT * FROM users WHERE YEAR(created_at) = 2024;

-- ✅ 正确：范围查询保持索引有效
SELECT * FROM users 
WHERE created_at >= '2024-01-01' 
AND created_at < '2025-01-01';
```

## 🔐 四、数据安全规范

### 4.1 敏感数据处理
```sql
-- 🔴 敏感数据设计规范
SENSITIVE_DATA_RULES = {
  -- 1. 数据脱敏：敏感信息不明文存储
  mobile: 'VARCHAR(11) + 加密存储',
  realName: 'VARCHAR(50) + 加密存储',
  idCard: '禁止存储完整身份证号',
  
  -- 2. 软删除：重要数据标记删除不物理删除
  softDelete: 'deleted_at TIMESTAMP NULL',
  
  -- 3. 操作日志：记录数据变更历史
  auditLog: '独立审计日志表记录所有变更'
}

-- 🔴 数据审计表设计
CREATE TABLE audit_logs (
  log_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  table_name VARCHAR(50) NOT NULL COMMENT '表名',
  record_id VARCHAR(50) NOT NULL COMMENT '记录ID',
  operation ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL COMMENT '操作类型',
  old_values JSON COMMENT '原值',
  new_values JSON COMMENT '新值',
  user_id INT COMMENT '操作用户ID',
  ip_address VARCHAR(45) COMMENT '操作IP',
  user_agent TEXT COMMENT '用户代理',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_table_record (table_name, record_id),
  INDEX idx_user_time (user_id, created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据变更审计日志';
```

### 4.2 数据备份策略
```sql
-- 🔴 备份恢复规范
BACKUP_STRATEGY = {
  -- 1. 全量备份：每日凌晨进行全库备份
  fullBackup: {
    frequency: 'daily',
    time: '02:00',
    retention: '30 days',
    location: '/backup/mysql/full/'
  },
  
  -- 2. 增量备份：每小时进行binlog备份
  incrementalBackup: {
    frequency: 'hourly',
    method: 'binlog',
    retention: '7 days',
    location: '/backup/mysql/binlog/'
  },
  
  -- 3. 备份验证：定期验证备份文件完整性
  verification: {
    frequency: 'weekly',
    method: 'restore test',
    testDatabase: 'backup_test'
  }
}

-- 备份脚本示例
-- 全量备份
mysqldump --single-transaction --routines --triggers \
  --all-databases > /backup/mysql/full/backup_$(date +%Y%m%d).sql

-- 增量备份
mysqlbinlog --start-datetime="2024-12-19 01:00:00" \
  /var/lib/mysql/mysql-bin.000001 > /backup/mysql/binlog/binlog_$(date +%Y%m%d_%H).sql
```

## 📋 五、数据迁移规范

### 5.1 版本管理策略
```sql
-- 🔴 数据库版本控制表
CREATE TABLE schema_migrations (
  version VARCHAR(20) PRIMARY KEY COMMENT '版本号',
  description VARCHAR(255) NOT NULL COMMENT '变更描述',
  sql_file VARCHAR(255) NOT NULL COMMENT 'SQL文件名',
  checksum VARCHAR(64) NOT NULL COMMENT '文件校验和',
  applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '执行时间',
  execution_time INT COMMENT '执行耗时(毫秒)'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='数据库迁移版本记录';

-- 🔴 迁移脚本命名规范
MIGRATION_NAMING = {
  pattern: 'V{version}__{description}.sql',
  examples: [
    'V1.0.0__init_database.sql',
    'V1.0.1__add_user_avatar.sql',
    'V1.1.0__create_lottery_table.sql'
  ]
}
```

### 5.2 安全迁移流程
```sql
-- 🔴 迁移前检查清单
PRE_MIGRATION_CHECKLIST = {
  -- 1. 数据备份：执行迁移前必须完成备份
  backup: 'mysqldump --single-transaction database_name',
  
  -- 2. 影响评估：评估迁移对业务的影响
  impact: '评估锁表时间、数据量、业务停机时间',
  
  -- 3. 回滚方案：准备回滚SQL脚本
  rollback: '准备对应的回滚脚本',
  
  -- 4. 测试验证：在测试环境验证迁移脚本
  testing: '在测试环境完整执行一遍迁移流程'
}

-- ✅ 安全的表结构变更示例
-- 添加字段（安全）
ALTER TABLE users ADD COLUMN avatar VARCHAR(255) DEFAULT '' COMMENT '用户头像';

-- 删除字段（分步执行）
-- 第一步：标记字段为废弃（业务代码停止使用）
-- 第二步：等待一个版本后删除字段
ALTER TABLE users DROP COLUMN deprecated_field;

-- 大表数据迁移（分批执行）
-- 避免长时间锁表，使用分批处理
UPDATE users SET avatar = '' WHERE avatar IS NULL AND user_id BETWEEN 1 AND 1000;
UPDATE users SET avatar = '' WHERE avatar IS NULL AND user_id BETWEEN 1001 AND 2000;
-- 继续分批执行...
```

## 📊 六、性能监控规范

### 6.1 监控指标定义
```sql
-- 🔴 关键性能指标
PERFORMANCE_METRICS = {
  -- 1. 查询性能指标
  queryPerformance: {
    slowQueryThreshold: '1 second',
    longQueryThreshold: '10 seconds',
    deadlockDetection: 'enabled',
    indexUsageTracking: 'enabled'
  },
  
  -- 2. 连接池指标
  connectionPool: {
    maxConnections: '100',
    activeConnections: 'monitor',
    waitingConnections: 'alert if > 10',
    connectionLeaks: 'monitor'
  },
  
  -- 3. 存储指标
  storage: {
    diskUsage: 'alert if > 80%',
    tableSize: 'monitor growth',
    indexSize: 'monitor efficiency',
    fragmentationLevel: 'optimize if > 30%'
  }
}

-- 🔴 慢查询监控配置
-- 启用慢查询日志
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- 定期分析慢查询
-- 使用 pt-query-digest 分析慢查询日志
pt-query-digest /var/lib/mysql/slow-query.log
```

### 6.2 表维护规范
```sql
-- 🔴 定期维护任务
MAINTENANCE_TASKS = {
  -- 1. 表优化：定期优化表结构
  optimize: 'OPTIMIZE TABLE table_name',
  
  -- 2. 索引重建：重建碎片化严重的索引
  rebuild: 'ALTER TABLE table_name ENGINE=InnoDB',
  
  -- 3. 统计信息更新：更新表统计信息
  analyze: 'ANALYZE TABLE table_name',
  
  -- 4. 数据清理：清理过期数据
  cleanup: '定期清理日志表、临时数据'
}

-- 维护脚本示例
-- 优化所有表
OPTIMIZE TABLE users, products, lottery_prizes, upload_reviews;

-- 更新统计信息
ANALYZE TABLE users, products, lottery_prizes, upload_reviews;

-- 清理过期日志（保留30天）
DELETE FROM audit_logs WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

## 🎯 七、数据质量保障

### 7.1 约束和校验
```sql
-- 🔴 数据完整性约束
DATA_INTEGRITY_CONSTRAINTS = {
  -- 1. 主键约束：确保记录唯一性
  primaryKey: 'PRIMARY KEY (id)',
  
  -- 2. 外键约束：维护关联关系
  foreignKey: 'FOREIGN KEY (user_id) REFERENCES users(user_id)',
  
  -- 3. 唯一约束：防止重复数据
  unique: 'UNIQUE KEY uk_mobile (mobile)',
  
  -- 4. 检查约束：数据范围验证
  check: 'CHECK (total_points >= 0)',
  
  -- 5. 非空约束：必填字段验证
  notNull: 'NOT NULL'
}

-- ✅ 数据校验规则示例
ALTER TABLE users 
ADD CONSTRAINT chk_mobile CHECK (mobile REGEXP '^1[3-9][0-9]{9}$'),
ADD CONSTRAINT chk_points CHECK (total_points >= 0);

ALTER TABLE products
ADD CONSTRAINT chk_stock CHECK (stock >= 0),
ADD CONSTRAINT chk_points CHECK (exchange_points > 0);
```

### 7.2 数据清理策略
```sql
-- 🔴 数据生命周期管理
DATA_LIFECYCLE_MANAGEMENT = {
  -- 1. 软删除：标记删除，保留数据
  softDelete: {
    mechanism: 'deleted_at timestamp',
    retention: '物理删除前保留90天'
  },
  
  -- 2. 归档策略：历史数据归档
  archive: {
    criteria: '超过1年的历史记录',
    destination: '归档表或冷存储',
    frequency: '月度归档'
  },
  
  -- 3. 清理策略：定期清理临时数据
  cleanup: {
    logData: '日志数据保留30天',
    tempData: '临时数据保留7天',
    testData: '测试数据及时清理'
  }
}

-- 数据归档脚本示例
-- 创建归档表
CREATE TABLE lottery_records_archive LIKE lottery_records;

-- 归档历史数据
INSERT INTO lottery_records_archive 
SELECT * FROM lottery_records 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- 删除已归档数据
DELETE FROM lottery_records 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);
```

---

## 🎯 总结：数据库设计规范价值

### ✅ 核心收益
1. **数据一致性**：规范的设计确保数据完整性和一致性
2. **查询性能**：合理的索引设计提升查询效率
3. **系统稳定性**：标准化的维护流程保障系统稳定运行
4. **可扩展性**：规范的架构设计支持业务快速扩展

### 🎯 实施建议
1. **分阶段实施**：从核心表开始，逐步完善整个数据库设计
2. **持续优化**：根据业务发展和性能监控持续优化设计
3. **团队培训**：确保团队成员理解和遵循设计规范
4. **工具支持**：使用数据库管理工具辅助设计和维护

**文档定位**：数据库专业人员技术规范  
**覆盖范围**：MySQL数据库设计和维护全流程  
**更新策略**：随数据库技术发展持续更新 