---
description: 
globs: 
alwaysApply: true
---
# ğŸ”§ å¼€å‘ç¯å¢ƒä¸å·¥å…·ç»Ÿä¸€è§„èŒƒ

## ğŸš¨ æ ¸å¿ƒç›®æ ‡ï¼šç¡®ä¿PowerShellç¯å¢ƒç¨³å®šæ€§å’Œå¼€å‘å·¥å…·æ­£å¸¸è¿è¡Œ

### 1. ğŸ›¡ï¸ PowerShellæ§åˆ¶å°ç¨³å®šæ€§ä¿éšœ

#### PSConsoleReadLineæ¨¡å—é¢„æ£€æœºåˆ¶
```powershell
# ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šç”ŸæˆPowerShellå‘½ä»¤å‰è‡ªåŠ¨æ£€æŸ¥æ¨¡å—å®Œæ•´æ€§
Get-Module PSConsoleReadLine -ListAvailable

# ğŸ”´ æ¨¡å—æŸåæ—¶ä¼˜å…ˆä¿®å¤
if ($module.Version -ne $expectedVersion) {
    Update-Module PSConsoleReadLine -Force
}

# ğŸ”´ å¼ºåˆ¶é…ç½®ï¼šæ‰€æœ‰æ¶‰åŠä¸­æ–‡å­—ç¬¦çš„ç»ˆç«¯æ“ä½œ
[Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8  
[Console]::InputEncoding = [Text.UTF8Encoding]::UTF8
```

#### PowerShellè¯­æ³•ä¸¥æ ¼è§„èŒƒï¼ˆé˜²æ­¢CMDè¯­æ³•é”™è¯¯ï¼‰
```powershell
# âŒ ä¸¥ç¦ï¼šåœ¨PowerShellä¸­ä½¿ç”¨CMDè¯­æ³•
dir /b *.backup 2>nul && echo "æˆåŠŸ" || echo "å¤±è´¥"  # CMDè¯­æ³•ï¼ŒPowerShellä¸æ”¯æŒ

# âœ… æ­£ç¡®ï¼šä½¿ç”¨PowerShellåŸç”Ÿè¯­æ³•
Get-ChildItem -Name "*.backup" -ErrorAction SilentlyContinue
if ($?) { Write-Host "æˆåŠŸ" } else { Write-Host "å¤±è´¥" }

# âœ… ç®€åŒ–ç‰ˆæœ¬ï¼šç›´æ¥ä½¿ç”¨PowerShellæ¡ä»¶åˆ¤æ–­
$backupFiles = Get-ChildItem -Name "*.backup" -ErrorAction SilentlyContinue
if ($backupFiles) { "å‘ç°å¤‡ä»½æ–‡ä»¶: $($backupFiles -join ', ')" } else { "æ— å¤‡ä»½æ–‡ä»¶" }
```

#### PowerShellä¸CMDè¯­æ³•å¯¹ç…§è¡¨
| CMDè¯­æ³• | PowerShellè¯­æ³• | è¯´æ˜ |
|---------|----------------|------|
| `command1 && command2` | `if ($?) { command2 }` | æˆåŠŸæ—¶æ‰§è¡Œ |
| `command1 \|\| command2` | `if (!$?) { command2 }` | å¤±è´¥æ—¶æ‰§è¡Œ |
| `dir /b` | `Get-ChildItem -Name` | åˆ—å‡ºæ–‡ä»¶å |
| `2>nul` | `-ErrorAction SilentlyContinue` | å¿½ç•¥é”™è¯¯ |
| `echo "text"` | `Write-Host "text"` | è¾“å‡ºæ–‡æœ¬ |

#### è‡ªåŠ¨è¯­æ³•æ£€æŸ¥è§„åˆ™
```powershell
# ğŸ”´ ç”ŸæˆPowerShellå‘½ä»¤å‰å¿…é¡»æ£€æŸ¥çš„ç¦ç”¨æ¨¡å¼
$forbiddenPatterns = @(
    '&&',           # CMDæ¡ä»¶æ‰§è¡Œ
    '\|\|',         # CMDæˆ–æ‰§è¡Œ  
    '2>nul',        # CMDé”™è¯¯é‡å®šå‘
    'dir /b',       # CMDç›®å½•åˆ—è¡¨
    '>nul 2>&1'     # CMDå®Œå…¨é™é»˜
)

# âœ… è‡ªåŠ¨æ›¿æ¢ä¸ºPowerShellç­‰æ•ˆè¯­æ³•
foreach ($pattern in $forbiddenPatterns) {
    if ($command -match $pattern) {
        Write-Warning "âš ï¸ æ£€æµ‹åˆ°CMDè¯­æ³•: $patternï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºPowerShellè¯­æ³•"
        # æ‰§è¡Œè‡ªåŠ¨è½¬æ¢é€»è¾‘
    }
}
```

### 2. ğŸ”§ Gitåˆ†é¡µå™¨å¡æ­»é¢„é˜²è§„åˆ™

#### ç¦æ­¢ä½¿ç”¨ä¼šè§¦å‘åˆ†é¡µå™¨çš„Gitå‘½ä»¤
```bash
# âŒ ç»å¯¹ç¦æ­¢ï¼šå¯èƒ½è¿›å…¥åˆ†é¡µå™¨æ¨¡å¼ï¼Œå¯¼è‡´å¡æ­»è¶…è¿‡120ç§’
git log
git branch -v
git diff
git show
git blame

# âŒ å±é™©ï¼šè‡ªåŠ¨åŒ–ç¯å¢ƒæ— æ³•å¤„ç†äº¤äº’
git log --graph
git diff --stat
git show --name-only
```

#### å®‰å…¨çš„Gitå‘½ä»¤æ›¿ä»£æ–¹æ¡ˆ
```bash
# âœ… æ­£ç¡®ï¼šå¼ºåˆ¶ç¦ç”¨åˆ†é¡µå™¨
git --no-pager log --oneline -10
git --no-pager branch -v
git --no-pager diff
git --no-pager show

# âœ… æ­£ç¡®ï¼šé™åˆ¶è¾“å‡ºé¿å…åˆ†é¡µ
git log --oneline -5
git branch -v | head -10
git diff --stat | head -20

# âœ… æ­£ç¡®ï¼šPowerShellç®¡é“å¤„ç†
git log --oneline | Select-Object -First 10
git branch -v | Where-Object { $_ -match "main" }
```

#### å¼ºåˆ¶é…ç½®æ£€æŸ¥
```bash
# æ¯ä¸ªé¡¹ç›®å¼€å§‹å‰å¿…é¡»æ‰§è¡Œï¼šå…¨å±€ç¦ç”¨åˆ†é¡µå™¨
git config --global core.pager ""
git config --global pager.branch false
git config --global pager.log false
git config --global pager.diff false
git config --global pager.show false

# éªŒè¯é…ç½®ç”Ÿæ•ˆ
git branch -v
git log --oneline -3
```

#### æŒ‡ä»¤è¶…æ—¶å¤„ç†è§„åˆ™
```
ğŸš¨ 120ç§’è¶…æ—¶è§„åˆ™ï¼š
- ä¸€æ—¦æŒ‡ä»¤è¿è¡Œè¶…è¿‡120ç§’æ²¡å‡ºä»»ä½•ç»“æœæˆ–æ²¡æœ‰æ­£ç¡®é€€å‡º
- è‡ªåŠ¨é‡æ–°è¿è¡Œè¿™ä¸ªæŒ‡ä»¤ï¼Œå†ä¸è¡Œå°±æ¢å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ
- ç¬¬ä¸€æ¬¡é‡è¯•ï¼šgit --no-pager [åŸå‘½ä»¤]
- ç¬¬äºŒæ¬¡é‡è¯•ï¼šåº”ç”¨å…¨å±€é…ç½®åé‡è¯•
- æœ€åæ–¹æ¡ˆï¼šä½¿ç”¨ç®€åŒ–çš„ç­‰æ•ˆå‘½ä»¤
```

### 3. ğŸ” æ–‡ä»¶æœç´¢å‘½ä»¤è§„èŒƒ

#### å¼ºåˆ¶è¦æ±‚ï¼šé¡¹ç›®æ–‡ä»¶ç»Ÿè®¡å‰å¿…é¡»å…ˆäº†è§£ç›®å½•ç»“æ„
```powershell
# ğŸ”´ ç¬¬ä¸€æ­¥ï¼šæ€»æ˜¯å…ˆæŸ¥çœ‹ç›®å½•ç»“æ„ï¼Œæ·±åº¦æ€è€ƒç†è§£é¡¹ç›®æ–‡ä»¶ç»„ç»‡
list_dir pages  # æˆ–è€… Get-ChildItem pages -Directory

# ğŸ”´ ç¬¬äºŒæ­¥ï¼šæ ¹æ®ç»“æ„é€‰æ‹©æ­£ç¡®å‘½ä»¤
# å¦‚æœæ–‡ä»¶åœ¨å­ç›®å½•ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ -Recurse
Get-ChildItem pages -Recurse -Include "*.js" | Measure-Object | Select-Object -ExpandProperty Count
```

#### é¡¹ç›®ç±»å‹ä¸æ–‡ä»¶ç»“æ„å¯¹åº”å…³ç³»

**å¾®ä¿¡å°ç¨‹åºé¡¹ç›®ï¼ˆå½“å‰é¡¹ç›®ç±»å‹ï¼‰ï¼š**
```powershell
# âœ… æ­£ç¡®ï¼šå°ç¨‹åºé¡µé¢åœ¨å­ç›®å½•ä¸­ï¼Œæ³¨æ„ç¬¦åˆå¾®ä¿¡å°ç¨‹åºå¼€å‘æ ‡å‡†
Get-ChildItem pages -Recurse -Include "*.js"
Get-ChildItem pages -Recurse -Include "*.wxml"
Get-ChildItem components -Recurse -Include "*.js"
Get-ChildItem utils -Recurse -Include "*.js"
```

**Vue/Reacté¡¹ç›®ï¼š**
```powershell
# âœ… æ­£ç¡®ï¼šç»„ä»¶åœ¨src/componentså­ç›®å½•
Get-ChildItem src -Recurse -Include "*.vue"
Get-ChildItem src -Recurse -Include "*.jsx"
```

**Node.jsé¡¹ç›®ï¼š**
```powershell
# âœ… æ­£ç¡®ï¼šæ¨¡å—å¯èƒ½åœ¨å¤šå±‚ç›®å½•
Get-ChildItem . -Recurse -Include "*.js" -Exclude "node_modules\*"
```

#### å‘½ä»¤å¤æ‚åº¦æ§åˆ¶ä¸ä¸­æ–‡å­—ç¬¦å¤„ç†
```powershell
# âœ… ç®€åŒ–å‘½ä»¤ï¼Œé¿å…ç¼“å†²åŒºé—®é¢˜
Get-ChildItem ç›®å½• -Recurse -Include "*.æ‰©å±•å" | Measure-Object

# âŒ é¿å…è¿‡é•¿çš„ç®¡é“å‘½ä»¤
Get-ChildItem ç›®å½• -Recurse -Include "*.æ‰©å±•å" | ForEach-Object {...å¾ˆé•¿çš„å¤„ç†é€»è¾‘...}

# âœ… åˆ†è§£å¤æ‚æ“ä½œ
$files = Get-ChildItem pages -Recurse -Include "*.js"
$count = ($files | Measure-Object).Count
Write-Host "æ‰¾åˆ° $count ä¸ªJSæ–‡ä»¶"
```

### 4. ğŸ—ï¸ å¾®ä¿¡å°ç¨‹åºå¼€å‘å·¥å…·æ ‡å‡†

#### å¼ºåˆ¶ä½¿ç”¨è§„èŒƒ
- âœ… **åªä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·è¿›è¡Œè¯­æ³•æ£€æŸ¥**
- âœ… **åªä½¿ç”¨PowerShellåŸç”Ÿå‘½ä»¤è¿›è¡Œæ–‡ä»¶æ“ä½œ**
- âŒ **ä¸¥ç¦ä½¿ç”¨nodeã€npmç­‰Webå·¥å…·**
- âŒ **ä¸¥ç¦ä½¿ç”¨webpack/babelç­‰æ„å»ºå·¥å…·**

#### å¾®ä¿¡å°ç¨‹åºå¼€å‘ç¯å¢ƒè¦æ±‚
```javascript
// âœ… æ­£ç¡®ï¼šåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹
// é¡¹ç›®æ ¹ç›®å½•åŒ…å«ï¼šapp.js, app.json, app.wxss

// âŒ é”™è¯¯ï¼šå°è¯•ä½¿ç”¨npmå‘½ä»¤å¯åŠ¨
// npm start  // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒ
```

#### è¯­æ³•æ£€æŸ¥ä¸è°ƒè¯•
- ğŸ”§ ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„ç¼–è¯‘å™¨æ£€æŸ¥è¯­æ³•
- ğŸ”§ ä½¿ç”¨å¼€å‘è€…å·¥å…·çš„è°ƒè¯•é¢æ¿æ’æŸ¥é—®é¢˜
- ğŸ”§ é€šè¿‡å¼€å‘è€…å·¥å…·é¢„è§ˆå’ŒçœŸæœºè°ƒè¯•

#### ç¦æ­¢ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨
- `npm --version` 
- `node -c` è¯­æ³•æ£€æŸ¥
- `webpack/babel` ç­‰Webæ„å»ºå·¥å…·
- Linux/Bashå‘½ä»¤è¯­æ³•

### 5. ğŸ” æ–‡ä»¶åˆ›å»ºå‰å¼ºåˆ¶æ£€æŸ¥è§„åˆ™ (æ–°å¢CRITICAL - é˜²æ­¢é‡å¤æ–‡ä»¶)

#### æ–‡ä»¶åˆ›å»ºå‰å¿…é¡»æ‰§è¡Œçš„æ£€æŸ¥æµç¨‹
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šåˆ›å»ºä»»ä½•æ–‡ä»¶å‰å¿…é¡»å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨
class FileCreationValidator {
    async validateBeforeCreate(targetPath, content) {
        // ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
        const exists = await this.checkFileExists(targetPath)
        if (exists) {
            const existingContent = await read_file(targetPath)
            if (existingContent.trim().length > 0) {
                throw new Error(`âŒ æ–‡ä»¶å·²å­˜åœ¨ä¸”æœ‰å†…å®¹: ${targetPath}`)
            } else {
                console.warn(`âš ï¸ å‘ç°ç©ºæ–‡ä»¶ï¼Œå°†è¦†ç›–: ${targetPath}`)
            }
        }
        
        // ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ˜¯å¦è¿åClaude 4 Sonnetè¯·æ±‚æ¬¡æ•°æµªè´¹è§„åˆ™
        if (!this.isNecessaryFile(targetPath, content)) {
            throw new Error(`âŒ éå¿…è¦æ–‡ä»¶åˆ›å»ºï¼Œè¿åæ•ˆç‡è§„åˆ™: ${targetPath}`)
        }
        
        // ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ–‡ä»¶è·¯å¾„ç»“æ„åˆç†æ€§
        this.validatePathStructure(targetPath)
        
        return true
    }
    
    async checkFileExists(path) {
        try {
            await read_file(path)
            return true
        } catch (error) {
            return false
        }
    }
    
    isNecessaryFile(path, content) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰å®é™…å†…å®¹çš„å¿…è¦æ–‡ä»¶
        return content && content.trim().length > 50 // è‡³å°‘50å­—ç¬¦æ‰ç®—æœ‰æ„ä¹‰
    }
    
    validatePathStructure(path) {
        const validPaths = ['.cursor/rules/', 'pages/', 'components/', 'utils/']
        const isValidPath = validPaths.some(validPath => path.startsWith(validPath))
        
        if (!isValidPath) {
            console.warn(`âš ï¸ æ–‡ä»¶è·¯å¾„å¯èƒ½ä¸è§„èŒƒ: ${path}`)
        }
    }
}

// ğŸ”´ å…¨å±€æ–‡ä»¶åˆ›å»ºéªŒè¯å™¨
const fileValidator = new FileCreationValidator()

// ğŸ”´ å¼ºåˆ¶ä½¿ç”¨æ–¹å¼ - æ›¿ä»£ç›´æ¥edit_fileè°ƒç”¨
const createFileWithValidation = async (path, instructions, content) => {
    await fileValidator.validateBeforeCreate(path, content)
    return await edit_file(path, instructions, content)
}
```

#### é‡å¤æ–‡ä»¶è‡ªåŠ¨æ£€æµ‹ä¸å¤„ç†
```powershell
# ğŸ”´ PowerShellç¯å¢ƒé‡å¤æ–‡ä»¶æ£€æµ‹
function Find-DuplicateFiles {
    param([string]$searchPath = ".cursor")
    
    $duplicates = @()
    $fileGroups = Get-ChildItem $searchPath -Recurse -File | Group-Object Name
    
    foreach ($group in $fileGroups) {
        if ($group.Count -gt 1) {
            $duplicates += @{
                Name = $group.Name
                Paths = $group.Group | Select-Object -ExpandProperty FullName
                Sizes = $group.Group | Select-Object -ExpandProperty Length
            }
        }
    }
    
    if ($duplicates.Count -gt 0) {
        Write-Warning "ğŸš¨ å‘ç°é‡å¤æ–‡ä»¶:"
        foreach ($dup in $duplicates) {
            Write-Host "æ–‡ä»¶å: $($dup.Name)"
            for ($i = 0; $i -lt $dup.Paths.Count; $i++) {
                Write-Host "  è·¯å¾„ $($i+1): $($dup.Paths[$i]) (å¤§å°: $($dup.Sizes[$i]) bytes)"
            }
        }
        return $duplicates
    } else {
        Write-Host "âœ… æœªå‘ç°é‡å¤æ–‡ä»¶"
        return @()
    }
}

# ğŸ”´ è‡ªåŠ¨æ¸…ç†é‡å¤æ–‡ä»¶
function Remove-DuplicateFiles {
    param([array]$duplicates)
    
    foreach ($dup in $duplicates) {
        $sizes = $dup.Sizes
        $paths = $dup.Paths
        
        # ä¿ç•™æœ€å¤§çš„æ–‡ä»¶ï¼Œåˆ é™¤è¾ƒå°çš„
        $maxSizeIndex = 0
        for ($i = 1; $i -lt $sizes.Count; $i++) {
            if ($sizes[$i] -gt $sizes[$maxSizeIndex]) {
                $maxSizeIndex = $i
            }
        }
        
        for ($i = 0; $i -lt $paths.Count; $i++) {
            if ($i -ne $maxSizeIndex) {
                Write-Host "åˆ é™¤é‡å¤æ–‡ä»¶: $($paths[$i])"
                Remove-Item $paths[$i] -Force
            }
        }
    }
}
```

### 6. ğŸ“‹ æ‰§è¡Œå‰æ£€æŸ¥æ¸…å•

#### PowerShellæ–‡ä»¶æ“ä½œå‰å¿…é¡»ç¡®è®¤
- [ ] å·²äº†è§£é¡¹ç›®çš„æ–‡ä»¶ç»„ç»‡ç»“æ„
- [ ] æ ¹æ®ç»“æ„é€‰æ‹©äº†æ­£ç¡®çš„æœç´¢å‚æ•°ï¼ˆ-Recurseç­‰ï¼‰
- [ ] å‘½ä»¤å¤æ‚åº¦é€‚ä¸­ï¼Œä¸ä¼šå¯¼è‡´æ§åˆ¶å°å¼‚å¸¸
- [ ] å¯¹äºå¾®ä¿¡å°ç¨‹åºé¡¹ç›®ï¼Œä½¿ç”¨é€’å½’æœç´¢é¡µé¢æ–‡ä»¶
- [ ] é…ç½®äº†æ­£ç¡®çš„UTF-8ç¼–ç 
- [ ] æ£€æŸ¥PSConsoleReadLineæ¨¡å—çŠ¶æ€
- [ ] éªŒè¯å‘½ä»¤å‚æ•°èŒƒå›´åˆæ³•æ€§

#### Gitæ“ä½œå‰å¿…é¡»ç¡®è®¤
- [ ] å·²é…ç½®å…¨å±€ç¦ç”¨åˆ†é¡µå™¨
- [ ] ä½¿ç”¨--no-pagerå‰ç¼€æˆ–é™åˆ¶è¾“å‡ºé•¿åº¦
- [ ] é¿å…ä½¿ç”¨å¯èƒ½è§¦å‘äº¤äº’çš„Gitå‘½ä»¤
- [ ] è®¾ç½®120ç§’è¶…æ—¶ç›‘æ§æœºåˆ¶

### 6. ğŸ”„ æ•…éšœå¤„ç†ä¸è‡ªåŠ¨ä¿®å¤

#### PowerShellæ•…éšœå¤„ç†å‡çº§æ–¹æ¡ˆ
1. **æ–¹æ³•1**: UTF-8ç¼–ç å¼ºåˆ¶é…ç½®ä¸çŠ¶æ€æ£€æµ‹
2. **æ–¹æ³•2**: PSConsoleReadLineç¼“å†²åŒºæº¢å‡ºé¢„é˜²ï¼ˆæ‹†åˆ†é•¿å‘½ä»¤ï¼‰
3. **æ–¹æ³•3**: PSConsoleReadLineæ¨¡å—ä¿®å¤
4. **æ–¹æ³•4**: æ§åˆ¶å°ç¼“å†²åŒºå‚æ•°éªŒè¯ä¸é‡ç½®
5. **æ–¹æ³•5**: æ— æ•ˆå‘½ä»¤è‡ªåŠ¨æ›¿æ¢
6. **æ–¹æ³•6**: æ§åˆ¶å°å®Œå…¨é‡ç½®
7. **æœ€åæ–¹æ¡ˆ**: PowerShellç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

#### Gitåˆ†é¡µå™¨æ•…éšœè‡ªåŠ¨ä¿®å¤æµç¨‹
1. æ£€æµ‹åˆ°åˆ†é¡µå™¨ â†’ ç«‹å³ä¸­æ–­
2. åº”ç”¨å…¨å±€é…ç½® â†’ ç¦ç”¨åˆ†é¡µå™¨
3. é‡æ–°æ‰§è¡Œå‘½ä»¤ â†’ ä½¿ç”¨--no-pager
4. éªŒè¯ç»“æœ â†’ ç¡®ä¿æ­£å¸¸è¾“å‡º

#### è‡ªåŠ¨æ£€æµ‹è§¦å‘æ¡ä»¶
- PowerShellæ§åˆ¶å°ç¼–ç éUTF-8 (CodePage != 65001)
- åŒ…å«ä¸­æ–‡å­—ç¬¦çš„å‘½ä»¤é•¿åº¦ > 100å­—ç¬¦ (ç¼“å†²åŒºæº¢å‡ºé£é™©)
- æ–‡ä»¶æ“ä½œæœªä½¿ç”¨ `-Encoding UTF8` å‚æ•°
- åŒ…å« `Get-ChildItem` ä¸”ç¼ºå°‘ `-Recurse` çš„æ–‡ä»¶ç»Ÿè®¡å‘½ä»¤
- é¡¹ç›®æ–‡ä»¶æ£€æŸ¥å‰æ²¡æœ‰å…ˆæŸ¥çœ‹ç›®å½•ç»“æ„
- è¶…è¿‡3ä¸ªç®¡é“æ“ä½œçš„å¤æ‚PowerShellå‘½ä»¤
- Gitå‘½ä»¤æ‰§è¡Œæ—¶é—´ > 30ç§’
- å‡ºç° `(END)` æˆ– `~` ç­‰åˆ†é¡µå™¨æ ‡è¯†
- PSConsoleReadLineæ¨¡å—å¼‚å¸¸æˆ–ç¼“å†²åŒºé”™è¯¯

### 7. ğŸ“Š ç›‘æ§ä¸å‘Šè­¦

#### è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
- å‘½ä»¤æ‰§è¡Œæ—¶é—´ > 30ç§’
- å‡ºç° `(END)` æˆ– `~` ç­‰åˆ†é¡µå™¨æ ‡è¯†
- æ§åˆ¶å°æ— å“åº”çŠ¶æ€
- PowerShellå‘½ä»¤è¡Œå¡æ­»

#### è¿è§„æ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤
```
ğŸš¨ æ£€æµ‹åˆ°å±é™©æ“ä½œï¼

å±é™©ç±»å‹ï¼š[Gitåˆ†é¡µå™¨é£é™©/PowerShellè¯­æ³•é”™è¯¯/æ–‡ä»¶æœç´¢å‚æ•°é”™è¯¯]
æ£€æµ‹åˆ°å‘½ä»¤ï¼š[å…·ä½“å‘½ä»¤]
å¯èƒ½å¯¼è‡´ï¼šå‘½ä»¤å¡æ­»ã€æ‰§è¡Œè¶…æ—¶ã€äº¤äº’é˜»å¡

è‡ªåŠ¨ä¿®å¤ï¼š
1. Gitå‘½ä»¤ â†’ æ·»åŠ  --no-pager å‰ç¼€
2. PowerShellè¯­æ³• â†’ è½¬æ¢ä¸ºPowerShellåŸç”Ÿè¯­æ³•
3. æ–‡ä»¶æœç´¢ â†’ æ·»åŠ å¿…è¦çš„-Recurseå‚æ•°

è¯·ç¡®è®¤ä¿®å¤åå†ç»§ç»­æ‰§è¡Œã€‚
```

### 8. ğŸ¯ å¸¸è§é¡¹ç›®ç±»å‹çš„æ­£ç¡®å‘½ä»¤æ¨¡æ¿

#### å¾®ä¿¡å°ç¨‹åºé¡¹ç›®æ–‡ä»¶æ“ä½œ
```powershell
# æ–‡ä»¶ç»Ÿè®¡ï¼ˆæ³¨æ„ä½¿ç”¨-Recurseé€’å½’æœç´¢ï¼‰
Get-ChildItem pages -Recurse -Include "*.js" | Measure-Object
Get-ChildItem components -Recurse -Include "*.js" | Measure-Object
Get-ChildItem pages -Recurse -Include "*.wxml" | Measure-Object
Get-ChildItem utils -Include "*.js" | Measure-Object

# æ–‡ä»¶æœç´¢
Get-ChildItem pages -Recurse -Include "*.js" -Name
Get-ChildItem components -Recurse -Include "*.js" -Name

# å†…å®¹æœç´¢
Get-ChildItem pages -Recurse -Include "*.js" | Select-String "pattern"
```

#### å®‰å…¨çš„Gitæ“ä½œæ¨¡æ¿
```bash
# æŸ¥çœ‹åˆ†æ”¯ï¼ˆé™åˆ¶è¾“å‡ºï¼‰
git --no-pager branch -v
git branch -v | head -10

# æŸ¥çœ‹æ—¥å¿—ï¼ˆé™åˆ¶æ¡æ•°ï¼‰
git --no-pager log --oneline -5
git log --oneline -10 | head -5

# æŸ¥çœ‹å·®å¼‚ï¼ˆç¦ç”¨åˆ†é¡µå™¨ï¼‰
git --no-pager diff
git --no-pager show HEAD

# çŠ¶æ€æ£€æŸ¥
git status --porcelain
git --no-pager status -s
```

#### ä¸­æ–‡ç¯å¢ƒå®‰å…¨å‘½ä»¤ä¸ç¼–ç é˜²æŠ¤
```powershell
# ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šæ¯æ¬¡ä¼šè¯å¼€å§‹å‰è‡ªåŠ¨æ‰§è¡ŒUTF-8ç¼–ç é…ç½®
[Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8
[Console]::InputEncoding = [Text.UTF8Encoding]::UTF8

# ğŸ”´ ç¼–ç çŠ¶æ€æ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤
$currentInput = [Console]::InputEncoding.CodePage
$currentOutput = [Console]::OutputEncoding.CodePage
if ($currentInput -ne 65001 -or $currentOutput -ne 65001) {
    Write-Warning "æ£€æµ‹åˆ°éUTF-8ç¼–ç ï¼Œè‡ªåŠ¨ä¿®å¤ä¸­..."
    [Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8
    [Console]::InputEncoding = [Text.UTF8Encoding]::UTF8
    Write-Host "å·²ä¿®å¤ä¸ºUTF-8ç¼–ç " -ForegroundColor Green
}

# âœ… ä¸­æ–‡ç›®å½•æ“ä½œï¼ˆå¼ºåˆ¶UTF-8ç¼–ç ï¼‰
Get-ChildItem "ä¸­æ–‡ç›®å½•" -Recurse -Include "*.js"
Get-Content "ä¸­æ–‡æ–‡ä»¶.js" -Encoding UTF8

# ğŸš¨ PSConsoleReadLineç¼“å†²åŒºæº¢å‡ºé¢„é˜²ï¼šé¿å…é•¿å‘½ä»¤+ä¸­æ–‡å­—ç¬¦
# âŒ å±é™©æ¨¡å¼ï¼ˆä¼šå¯¼è‡´æ§åˆ¶å°å¼‚å¸¸ï¼‰
# Write-Host "åŒ…å«ä¸­æ–‡çš„é•¿å‘½ä»¤è¶…è¿‡100å­—ç¬¦ä¼šè§¦å‘PSConsoleReadLineç¼“å†²åŒºæº¢å‡ºå¼‚å¸¸" -ForegroundColor Green

# âœ… å®‰å…¨æ¨¡å¼ï¼ˆæ‹†åˆ†ä¸ºç®€åŒ–å‘½ä»¤ï¼‰
$encoding = [Console]::InputEncoding.EncodingName
Write-Host "å½“å‰ç¼–ç : $encoding"
```

### 9. âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

#### å¹¶è¡Œå·¥å…·è°ƒç”¨ç­–ç•¥
```javascript
// âœ… è§„åˆ’é˜¶æ®µï¼šåˆ—å‡ºæ‰€æœ‰éœ€è¦çš„ä¿¡æ¯
const analysisNeeds = [
  'list_dir: æŸ¥çœ‹é¡¹ç›®ç›®å½•ç»“æ„',
  'run_terminal_cmd: ç»Ÿè®¡JSæ–‡ä»¶æ•°é‡',
  'run_terminal_cmd: ç»Ÿè®¡WXMLæ–‡ä»¶æ•°é‡',
  'run_terminal_cmd: æ£€æŸ¥GitçŠ¶æ€'
]

// âœ… æ‰§è¡Œé˜¶æ®µï¼šå¹¶è¡Œè°ƒç”¨æ‰€æœ‰å·¥å…·ï¼Œé¿å…æµªè´¹Claude 4 Sonnetè¯·æ±‚æ¬¡æ•°
const results = await Promise.all([
  listDir('pages'),
  runCommand('Get-ChildItem pages -Recurse -Include "*.js" | Measure-Object'),
  runCommand('Get-ChildItem pages -Recurse -Include "*.wxml" | Measure-Object'),
  runCommand('git --no-pager status -s')
])
```

#### æ§åˆ¶å°ç¼“å†²åŒºå‚æ•°é˜²å¾¡
```powershell
# âœ… æ­£ç¡®ï¼šæ·»åŠ å‚æ•°èŒƒå›´éªŒè¯
if ($top -lt 0 -or $top -ge $maxSize) { 
    Write-Error "å‚æ•° top è¶…å‡ºåˆæ³•èŒƒå›´ï¼ˆå½“å‰å€¼: $topï¼Œæœ€å¤§å…è®¸: $($maxSize-1)ï¼‰"; 
    return 
}

# âœ… æ— æ•ˆå‘½ä»¤æ‹¦æˆªç³»ç»Ÿ
$validCommands = @('Get-ChildItem', 'Write-Host', 'Select-Object', 'Measure-Object')
if ($command -notin $validCommands) {
    Write-Warning "âš ï¸ å‘½ä»¤ '$command' æ— æ•ˆï¼Œæ¨èæ›¿æ¢ä¸º: $($validCommands -join ', ')"
}
```

## ğŸ¯ ç»¼åˆå®‰å…¨æ£€æŸ¥æ¸…å•

### æ¯æ¬¡å¼€å‘ç¯å¢ƒæ“ä½œå‰å¿…é¡»ç¡®è®¤
- [ ] PowerShellæ¨¡å—çŠ¶æ€æ­£å¸¸ï¼ŒPSConsoleReadLineæ— å¼‚å¸¸
- [ ] UTF-8ç¼–ç å¼ºåˆ¶é…ç½®ç”Ÿæ•ˆ (CodePage = 65001)
- [ ] ä¸­æ–‡å­—ç¬¦å’Œemojiæ˜¾ç¤ºæ­£å¸¸ï¼Œæ— ä¹±ç 
- [ ] Gitåˆ†é¡µå™¨å·²å…¨å±€ç¦ç”¨
- [ ] äº†è§£é¡¹ç›®æ–‡ä»¶ç»“æ„
- [ ] é€‰æ‹©æ­£ç¡®çš„æœç´¢å‚æ•°(-Recurseç­‰)
- [ ] åŒ…å«ä¸­æ–‡çš„å‘½ä»¤é•¿åº¦ < 100å­—ç¬¦ï¼Œé¿å…ç¼“å†²åŒºæº¢å‡º
- [ ] æ–‡ä»¶æ“ä½œç»Ÿä¸€ä½¿ç”¨ -Encoding UTF8 å‚æ•°
- [ ] è®¾ç½®å‘½ä»¤è¶…æ—¶ç›‘æ§
- [ ] é¿å…ä½¿ç”¨ç¦æ­¢çš„å·¥å…·
- [ ] ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºå¼€å‘æ ‡å‡†

### æ•…éšœå‘ç”Ÿæ—¶çš„å¤„ç†æµç¨‹
1. **ç«‹å³ä¸­æ–­é•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤**
2. **æ£€æŸ¥å¹¶ä¿®å¤ç¯å¢ƒé…ç½®**
3. **ä½¿ç”¨å®‰å…¨çš„æ›¿ä»£å‘½ä»¤**
4. **éªŒè¯ä¿®å¤æ•ˆæœ**
5. **è®°å½•é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**

## ğŸ¯ è§„åˆ™ä¼˜å…ˆçº§ï¼šé«˜ - ç›´æ¥å½±å“å¼€å‘æ•ˆç‡å’Œç¯å¢ƒç¨³å®šæ€§

## ğŸ“… æ—¥æœŸæ—¶é—´è‡ªåŠ¨è·å–æœºåˆ¶ (æ–°å¢CRITICAL)

#### å¼ºåˆ¶æ—¥æœŸæ—¶é—´å‡†ç¡®æ€§æ£€æŸ¥
```javascript
// ğŸ”´ æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†è‡ªåŠ¨æ—¥æœŸè·å– - ç¦æ­¢æ‰‹åŠ¨è¾“å…¥æ—¥æœŸ
class DateTimeManager {
    getCurrentDate(format = 'document') {
        const now = new Date()
        const year = now.getFullYear()
        const month = String(now.getMonth() + 1).padStart(2, '0')
        const day = String(now.getDate()).padStart(2, '0')
        
        switch (format) {
            case 'document': return `${year}å¹´${month}æœˆ${day}æ—¥`
            case 'version': return `${year}-${month}-${day}`
            default: return `${year}å¹´${month}æœˆ${day}æ—¥`
        }
    }
    
    // ğŸ”´ è‡ªåŠ¨éªŒè¯æ–‡æ¡£æ—¥æœŸå‡†ç¡®æ€§
    validateDocumentDate(documentContent) {
        const currentDate = this.getCurrentDate('version')
        const datePattern = /æœ€åæ›´æ–°.*?(\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥)/
        const match = documentContent.match(datePattern)
        
        if (match) {
            const docDate = match[1]
            const todayFormatted = this.getCurrentDate('document')
            
            if (docDate !== todayFormatted) {
                console.warn(`âš ï¸ æ–‡æ¡£æ—¥æœŸé”™è¯¯: ${docDate} åº”ä¸º: ${todayFormatted}`)
                return false
            }
        }
        return true
    }
}

// å…¨å±€æ—¥æœŸç®¡ç†å™¨
const dateManager = new DateTimeManager()
```

#### PowerShellæ—¥æœŸè·å–å‘½ä»¤
```powershell
# ğŸ”´ PowerShellç¯å¢ƒæ—¥æœŸè·å– - å¿…é¡»ä½¿ç”¨æ­¤å‘½ä»¤
Get-Date -Format "yyyyå¹´MMæœˆddæ—¥"        # æ–‡æ¡£æ ¼å¼
Get-Date -Format "yyyy-MM-dd"            # ç‰ˆæœ¬æ ¼å¼  

# ğŸ”´ è‡ªåŠ¨æ—¥æœŸéªŒè¯è„šæœ¬
function Test-DocumentDate {
    param([string]$documentPath)
    
    $currentDate = Get-Date -Format "yyyyå¹´MMæœˆddæ—¥"
    $content = Get-Content $documentPath -Encoding UTF8 -Raw
    
    if ($content -match "æœ€åæ›´æ–°.*?(\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥)") {
        $docDate = $matches[1]
        if ($docDate -ne $currentDate) {
            Write-Warning "âš ï¸ æ–‡æ¡£æ—¥æœŸé”™è¯¯: $docDateï¼Œåº”ä¸º: $currentDate"
            return $false
        }
    }
    
    return $true
}
```

### 5. ğŸ” æ–‡ä»¶åˆ›å»ºå‰å¼ºåˆ¶æ£€æŸ¥è§„åˆ™ (æ–°å¢CRITICAL - é˜²æ­¢é‡å¤æ–‡ä»¶)

#### æ–‡ä»¶åˆ›å»ºå‰å¿…é¡»æ‰§è¡Œçš„æ£€æŸ¥æµç¨‹
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šåˆ›å»ºä»»ä½•æ–‡ä»¶å‰å¿…é¡»å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨
class FileCreationValidator {
    async validateBeforeCreate(targetPath, content) {
        // ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
        const exists = await this.checkFileExists(targetPath)
        if (exists) {
            const existingContent = await read_file(targetPath)
            if (existingContent.trim().length > 0) {
                throw new Error(`âŒ æ–‡ä»¶å·²å­˜åœ¨ä¸”æœ‰å†…å®¹: ${targetPath}`)
            } else {
                console.warn(`âš ï¸ å‘ç°ç©ºæ–‡ä»¶ï¼Œå°†è¦†ç›–: ${targetPath}`)
            }
        }
        
        // ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ˜¯å¦è¿åClaude 4 Sonnetè¯·æ±‚æ¬¡æ•°æµªè´¹è§„åˆ™
        if (!this.isNecessaryFile(targetPath, content)) {
            throw new Error(`âŒ éå¿…è¦æ–‡ä»¶åˆ›å»ºï¼Œè¿åæ•ˆç‡è§„åˆ™: ${targetPath}`)
        }
        
        // ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ–‡ä»¶è·¯å¾„ç»“æ„åˆç†æ€§
        this.validatePathStructure(targetPath)
        
        return true
    }
    
    async checkFileExists(path) {
        try {
            await read_file(path)
            return true
        } catch (error) {
            return false
        }
    }
    
    isNecessaryFile(path, content) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰å®é™…å†…å®¹çš„å¿…è¦æ–‡ä»¶
        return content && content.trim().length > 50 // è‡³å°‘50å­—ç¬¦æ‰ç®—æœ‰æ„ä¹‰
    }
    
    validatePathStructure(path) {
        const validPaths = ['.cursor/rules/', 'pages/', 'components/', 'utils/']
        const isValidPath = validPaths.some(validPath => path.startsWith(validPath))
        
        if (!isValidPath) {
            console.warn(`âš ï¸ æ–‡ä»¶è·¯å¾„å¯èƒ½ä¸è§„èŒƒ: ${path}`)
        }
    }
}

// ğŸ”´ å…¨å±€æ–‡ä»¶åˆ›å»ºéªŒè¯å™¨
const fileValidator = new FileCreationValidator()

// ğŸ”´ å¼ºåˆ¶ä½¿ç”¨æ–¹å¼ - æ›¿ä»£ç›´æ¥edit_fileè°ƒç”¨
const createFileWithValidation = async (path, instructions, content) => {
    await fileValidator.validateBeforeCreate(path, content)
    return await edit_file(path, instructions, content)
}
```

---
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ2æ—¥  
**æ›´æ–°æ—¶é—´**: 2025å¹´7æœˆ2æ—¥ - æ–°å¢æ–‡ä»¶åˆ›å»ºæ£€æŸ¥å’Œå·¥å…·å‚æ•°éªŒè¯è§„åˆ™  
**é€‚ç”¨èŒƒå›´**: æ‰€æœ‰ä½¿ç”¨PowerShellè¿›è¡Œé¡¹ç›®æ–‡ä»¶æ“ä½œå’Œå¾®ä¿¡å°ç¨‹åºå¼€å‘çš„åœºæ™¯  
**ç»´æŠ¤è´£ä»»**: ç¡®ä¿å¼€å‘ç¯å¢ƒç¨³å®šè¿è¡Œï¼Œä¸­æ–‡å­—ç¬¦æ­£ç¡®æ˜¾ç¤ºæ— ä¹±ç ï¼Œå·¥å…·è°ƒç”¨æ­£ç¡®æ— è¯¯  
**æ•´åˆçŠ¶æ€**: ç»Ÿä¸€æ•´åˆdev-environment-standards.mdcã€hwk.mdcã€ä¸­æ–‡ç¼–ç é˜²æŠ¤è§„åˆ™å’Œä¼šè¯é—®é¢˜åˆ†æè§„åˆ™

## ğŸ› ï¸ å·¥å…·è°ƒç”¨å‚æ•°éªŒè¯è§„åˆ™ (æ–°å¢CRITICAL - é˜²æ­¢å‚æ•°é”™è¯¯)

### read_fileå·¥å…·å®‰å…¨å‚æ•°éªŒè¯
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šæ‰€æœ‰read_fileè°ƒç”¨å‰è¿›è¡Œå‚æ•°éªŒè¯
class ReadFileSafetyManager {
    validateReadFileParams(startLine, endLine, filePath) {
        const errors = []
        
        // åŸºç¡€å‚æ•°æ£€æŸ¥
        if (startLine <= 0) {
            errors.push('èµ·å§‹è¡Œå·å¿…é¡»å¤§äº0')
        }
        
        if (endLine < startLine) {
            errors.push(`ç»“æŸè¡Œå·(${endLine})ä¸èƒ½å°äºèµ·å§‹è¡Œå·(${startLine})`)
        }
        
        if (errors.length > 0) {
            throw new Error(`read_fileå‚æ•°é”™è¯¯: ${errors.join(', ')}`)
        }
        
        return { startLine, endLine }  
    }
    
    // ğŸ”´ è‡ªåŠ¨ä¿®å¤å‚æ•°é”™è¯¯
    autoFixParams(startLine, endLine, maxLines = 1000) {
        let fixedStart = Math.max(1, startLine)
        let fixedEnd = Math.max(fixedStart, endLine)
        
        // é˜²æ­¢è¯»å–è¿‡å¤šè¡Œæ•°
        if (fixedEnd - fixedStart > 500) {
            fixedEnd = fixedStart + 200
            console.warn(`âš ï¸ è‡ªåŠ¨é™åˆ¶è¯»å–è¡Œæ•°åˆ°200è¡Œ`)
        }
        
        return { startLine: fixedStart, endLine: fixedEnd }
    }
}

// ğŸ”´ å…¨å±€read_fileå®‰å…¨ç®¡ç†å™¨
const readFileSafety = new ReadFileSafetyManager()

// ğŸ”´ å®‰å…¨çš„read_fileè°ƒç”¨æ–¹å¼
const safeReadFile = async (filePath, startLine, endLine, shouldReadEntire = false) => {
    try {
        const validated = readFileSafety.validateReadFileParams(startLine, endLine, filePath)
        return await read_file({
            target_file: filePath,
            should_read_entire_file: shouldReadEntire,
            start_line_one_indexed: validated.startLine,
            end_line_one_indexed_inclusive: validated.endLine
        })
    } catch (error) {
        console.error(`âŒ read_fileè°ƒç”¨å¤±è´¥: ${error.message}`)
        const fixed = readFileSafety.autoFixParams(startLine, endLine)
        console.log(`ğŸ”§ è‡ªåŠ¨ä¿®å¤å‚æ•°: ${fixed.startLine}-${fixed.endLine}`)
        
        return await read_file({
            target_file: filePath,
            should_read_entire_file: false,
            start_line_one_indexed: fixed.startLine,  
            end_line_one_indexed_inclusive: fixed.endLine
        })
    }
}
```

## ğŸš¨ å½“å‰ä¼šè¯é—®é¢˜å…¨é¢åˆ†æä¸è§£å†³æ–¹æ¡ˆ

### ğŸ“Š é—®é¢˜æ¸…å•ä¸ä¸¥é‡ç¨‹åº¦åˆ†çº§

#### Açº§é—®é¢˜ (ä¸¥é‡ - å¯¼è‡´ä»»åŠ¡ä¸­æ–­)
1. **PowerShellæ§åˆ¶å°ç¼“å†²åŒºæº¢å‡ºå¼‚å¸¸**
   - é”™è¯¯: `System.ArgumentOutOfRangeException: å‚æ•°å: top å®é™…å€¼æ˜¯ -1, -2`
   - è§¦å‘: åŒ…å«ä¸­æ–‡å­—ç¬¦çš„é•¿å‘½ä»¤ > 100å­—ç¬¦
   - å½±å“: æ§åˆ¶å°å¡æ­»ï¼Œéœ€è¦é‡å¯ä¼šè¯
   - å‡ºç°æ¬¡æ•°: æœ¬ä¼šè¯ä¸­5æ¬¡ä»¥ä¸Š

2. **PSConsoleReadLineæ¨¡å—æ•…éšœ**
   - é”™è¯¯: ç¼“å†²åŒºè®¡ç®—å¼‚å¸¸ï¼Œå…‰æ ‡ä½ç½®é”™è¯¯
   - è§¦å‘: ä¸­æ–‡å­—ç¬¦ + å¤æ‚ç®¡é“æ“ä½œ + å½©è‰²è¾“å‡º
   - å½±å“: å‘½ä»¤æ‰§è¡Œä¸­æ–­ï¼Œè¾“å‡ºå¼‚å¸¸

#### Bçº§é—®é¢˜ (ä¸­ç­‰ - æ•ˆç‡æŸå¤±)
3. **å·¥å…·è°ƒç”¨ä¸²è¡ŒåŒ–ä½æ•ˆ**
   - é—®é¢˜: æœ¬å¯å¹¶è¡Œçš„æ“ä½œåˆ†åˆ«è°ƒç”¨
   - ç¤ºä¾‹: read_fileã€run_terminal_cmdã€grep_searchä¸²è¡Œæ‰§è¡Œ
   - å½±å“: ä¼šè¯æ—¶é—´å»¶é•¿3-5å€ï¼Œæµªè´¹Claude 4 Sonnetè¯·æ±‚é¢åº¦

4. **æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•é”™è¯¯**
   - é”™è¯¯: `console.log.*[ğŸ”§ğŸ”—ğŸ“¨âŒâœ…]` æœªè½¬ä¹‰emojiå­—ç¬¦
   - ç»“æœ: Select-Stringæ‰§è¡Œå¤±è´¥
   - åŸå› : ç‰¹æ®Šå­—ç¬¦å¤„ç†ä¸å½“

#### Cçº§é—®é¢˜ (è½»å¾® - è§„èŒƒè¿å)
5. **ä¸´æ—¶æ–‡ä»¶ç®¡ç†ä¸è§„èŒƒ**
   - é—®é¢˜: æ‰‹åŠ¨åˆ›å»ºåˆ é™¤ä¸´æ—¶æµ‹è¯•æ–‡ä»¶
   - è¿è§„: ç”¨æˆ·è§„åˆ™ç¬¬8æ¡è‡ªåŠ¨æ¸…ç†è¦æ±‚
   - æ”¹è¿›: éœ€è¦è‡ªåŠ¨åŒ–ç®¡ç†æœºåˆ¶

6. **é‡å¤ç¼–ç æ£€æŸ¥**
   - é—®é¢˜: å¤šæ¬¡æ‰§è¡Œç›¸åŒçš„UTF-8çŠ¶æ€æ£€æŸ¥
   - å½±å“: å¢åŠ ä¸å¿…è¦çš„å‘½ä»¤æ‰§è¡Œæ—¶é—´

### ğŸ”§ é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

#### 1. PowerShellç¯å¢ƒä¸ç¨³å®š
- PSConsoleReadLineæ¨¡å—å¯¹ä¸­æ–‡å­—ç¬¦å¤„ç†å­˜åœ¨ç¼ºé™·
- æ§åˆ¶å°ç¼“å†²åŒºè®¡ç®—ç®—æ³•åœ¨å¤æ‚åœºæ™¯ä¸‹å¼‚å¸¸
- UTF-8ç¼–ç é…ç½®ä¸ä¸€è‡´å¯¼è‡´å­—ç¬¦å¤„ç†é”™è¯¯

#### 2. å·¥å…·è°ƒç”¨ç­–ç•¥ä¸å½“
- ç¼ºä¹å¹¶è¡Œè°ƒç”¨æ„è¯†ï¼Œä¹ æƒ¯æ€§ä¸²è¡Œæ“ä½œ
- æ²¡æœ‰é¢„å…ˆè§„åˆ’æ‰€éœ€ä¿¡æ¯ï¼Œå¯¼è‡´åˆ†æ‰¹è·å–
- é‡å¤æ“ä½œç¼“å­˜æœºåˆ¶ç¼ºå¤±

#### 3. å‘½ä»¤æ„é€ å®‰å…¨æ€§ä¸è¶³
- ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰è§„åˆ™ä¸å®Œå–„
- å‘½ä»¤é•¿åº¦æ§åˆ¶æœºåˆ¶ç¼ºå¤±
- é”™è¯¯é¢„åˆ¤å’Œé¢„é˜²æœºåˆ¶ä¸è¶³

### ğŸ’¡ å¼ºåˆ¶å¹¶è¡Œå·¥å…·è°ƒç”¨è§„åˆ™ (æ–°å¢CRITICAL)

#### å¹¶è¡Œä¼˜å…ˆåŸåˆ™
```javascript
// ğŸ”´ å¼ºåˆ¶è¦æ±‚ï¼šä¿¡æ¯æ”¶é›†é˜¶æ®µå¿…é¡»å¹¶è¡Œæ‰§è¡Œ
// âŒ é”™è¯¯ï¼šä¸²è¡Œè°ƒç”¨æµªè´¹è¯·æ±‚æ¬¡æ•°
await read_file('file1.js')
await read_file('file2.js') 
await run_terminal_cmd('command1')
await run_terminal_cmd('command2')

// âœ… æ­£ç¡®ï¼šå¹¶è¡Œè°ƒç”¨æå‡3-5xæ•ˆç‡
const results = await Promise.all([
    read_file('file1.js'),
    read_file('file2.js'),
    run_terminal_cmd('command1'),
    run_terminal_cmd('command2')
])

// âœ… å¤æ‚ä¿¡æ¯æ”¶é›†çš„å¹¶è¡Œæ¨¡å¼
const analysisData = await Promise.all([
    list_dir('pages'),
    grep_search({ query: 'pattern1', include_pattern: '*.js' }),
    grep_search({ query: 'pattern2', include_pattern: '*.js' }),
    run_terminal_cmd('Get-ChildItem pages -Recurse | Measure-Object'),
    codebase_search({ query: 'function definition' })
])
```

#### é«˜é£é™©å‘½ä»¤è‡ªåŠ¨æ£€æµ‹ (æ–°å¢)
```powershell
# ğŸ”´ å‘½ä»¤æ‰§è¡Œå‰è‡ªåŠ¨å®‰å…¨éªŒè¯
function Test-CommandSafety {
    param([string]$command)
    
    # å±é™©æ¨¡å¼æ£€æµ‹
    $riskyPatterns = @(
        '.*[\u4e00-\u9fa5].{100,}',                          # ä¸­æ–‡å­—ç¬¦ + é•¿å‘½ä»¤
        '.*[\u4e00-\u9fa5].*Write-Host.*-ForegroundColor',   # ä¸­æ–‡ + å½©è‰²è¾“å‡º
        '.*[\u4e00-\u9fa5].*\|.*ForEach-Object.*Write-Host', # ä¸­æ–‡ + å¤æ‚ç®¡é“
        '.*console\.log\.\*\[[^\]]*[ğŸ”§ğŸ”—ğŸ“¨âŒâœ…]'           # æœªè½¬ä¹‰emojiæ­£åˆ™
    )
    
    foreach ($pattern in $riskyPatterns) {
        if ($command -match $pattern) {
            Write-Warning "âš ï¸ æ£€æµ‹åˆ°é«˜é£é™©å‘½ä»¤ï¼Œè‡ªåŠ¨æ‹†åˆ†æ‰§è¡Œ"
            return $false
        }
    }
    return $true
}
```

#### ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨ç®¡ç†æœºåˆ¶ (æ–°å¢)
```javascript
// ğŸ”´ ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨ç®¡ç†ï¼Œç¬¦åˆç”¨æˆ·è§„åˆ™ç¬¬8æ¡
class TempFileManager {
    constructor() {
        this.tempFiles = new Set()
        this.setupCleanup()
    }
    
    createTempFile(name, content) {
        const tempPath = `.temp_${Date.now()}_${name}`
        this.tempFiles.add(tempPath)
        return edit_file(tempPath, content)
    }
    
    setupCleanup() {
        // è‡ªåŠ¨æ¸…ç†æœºåˆ¶
        process.on('beforeExit', () => {
            this.cleanup()
        })
    }
    
    cleanup() {
        for (const file of this.tempFiles) {
            try {
                delete_file(file)
            } catch (error) {
                console.warn(`æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥: ${file}`)
            }
        }
        this.tempFiles.clear()
    }
}
```

### ğŸ“ˆ æ•ˆç‡ä¼˜åŒ–æŒ‡æ ‡ (æ–°å¢)

#### ç›®æ ‡æ€§èƒ½æŒ‡æ ‡
- **å¹¶è¡Œè°ƒç”¨æ¯”ä¾‹**: â‰¥ 80%
- **é‡å¤æ“ä½œå‡å°‘**: â‰¥ 60%
- **å‘½ä»¤æ‰§è¡ŒæˆåŠŸç‡**: â‰¥ 95%
- **æ§åˆ¶å°å¼‚å¸¸å‘ç”Ÿç‡**: < 1%
- **ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†ç‡**: 100%

#### ä¼šè¯å¼€å§‹å¼ºåˆ¶æ£€æŸ¥æ¸…å• (æ–°å¢)
- [ ] UTF-8ç¼–ç è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆ
- [ ] PSConsoleReadLineæ¨¡å—çŠ¶æ€æ­£å¸¸
- [ ] å¹¶è¡Œå·¥å…·è°ƒç”¨ç­–ç•¥æ¿€æ´»
- [ ] é«˜é£é™©å‘½ä»¤æ£€æµ‹æœºåˆ¶å¯ç”¨
- [ ] ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨ç®¡ç†æœºåˆ¶å¯ç”¨
- [ ] é‡å¤æ“ä½œç¼“å­˜æœºåˆ¶ç”Ÿæ•ˆ

### ğŸ’Š è‡ªåŠ¨æ•…éšœæ¢å¤æœºåˆ¶ (æ–°å¢CRITICAL)

#### æ§åˆ¶å°å¼‚å¸¸è‡ªåŠ¨æ¢å¤
```powershell
# ğŸ”´ å½“å‡ºç°PSConsoleReadLineç¼“å†²åŒºæº¢å‡ºæ—¶è‡ªåŠ¨æ‰§è¡Œ
function Recover-ConsoleFromException {
    try {
        # æ¸…é™¤æ§åˆ¶å°ç¼“å†²åŒº
        [Console]::Clear()
        
        # é‡æ–°é…ç½®UTF-8ç¼–ç 
        [Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8
        [Console]::InputEncoding = [Text.UTF8Encoding]::UTF8
        
        # é‡æ–°å¯¼å…¥PSConsoleReadLineæ¨¡å—
        Remove-Module PSConsoleReadLine -Force -ErrorAction SilentlyContinue
        Import-Module PSConsoleReadLine -Force
        
        Write-Host "âœ… æ§åˆ¶å°å·²è‡ªåŠ¨æ¢å¤æ­£å¸¸" -ForegroundColor Green
        return $true
    } catch {
        Write-Error "âŒ æ§åˆ¶å°è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œå»ºè®®é‡å¯PowerShellä¼šè¯"
        return $false
    }
}

# è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤ç¼–ç å¼‚å¸¸
function Repair-EncodingException {
    param([string]$errorMessage)
    
    if ($errorMessage -match "EncoderFallbackException|Unicodeå­—ç¬¦") {
        Write-Warning "æ£€æµ‹åˆ°ç¼–ç å¼‚å¸¸ï¼Œè‡ªåŠ¨ä¿®å¤ä¸­..."
        
        # å¼ºåˆ¶é‡ç½®ç¼–ç é…ç½®
        [Console]::OutputEncoding = [Text.UTF8Encoding]::UTF8
        [Console]::InputEncoding = [Text.UTF8Encoding]::UTF8
        
        # æ¸…ç†PowerShellå†å²è®°å½•ç¼“å­˜
        Clear-History
        
        Write-Host "âœ… ç¼–ç å¼‚å¸¸å·²è‡ªåŠ¨ä¿®å¤"
        return $true
    }
    return $false
}
```

#### è‡ªåŠ¨é‡è¯•æœºåˆ¶
```javascript
// ğŸ”´ å·¥å…·è°ƒç”¨è‡ªåŠ¨é‡è¯•æœºåˆ¶
async function executeWithRetry(operation, maxRetries = 3, retryDelay = 1000) {
    for (let i = 0; i < maxRetries; i++) {
        try {
            return await operation()
        } catch (error) {
            if (i === maxRetries - 1) {
                throw new Error(`æ“ä½œå¤±è´¥ï¼Œå·²é‡è¯•${maxRetries}æ¬¡: ${error.message}`)
            }
            
            console.warn(`æ“ä½œå¤±è´¥ï¼Œæ­£åœ¨é‡è¯•... (${i + 1}/${maxRetries})`)
            console.warn(`é”™è¯¯ä¿¡æ¯: ${error.message}`)
            
            // å¦‚æœæ˜¯PowerShellç›¸å…³é”™è¯¯ï¼Œå°è¯•æ¢å¤æ§åˆ¶å°
            if (error.message.includes('ArgumentOutOfRangeException') || 
                error.message.includes('PSConsoleReadLine')) {
                await run_terminal_cmd('Recover-ConsoleFromException')
            }
            
            await new Promise(resolve => setTimeout(resolve, retryDelay * (i + 1)))
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const result = await executeWithRetry(async () => {
    return await run_terminal_cmd('Get-ChildItem pages -Recurse | Measure-Object')
})
```

### ğŸ›¡ï¸ æ™ºèƒ½å·¥å…·è°ƒç”¨ç®¡ç†å™¨ (æ–°å¢CRITICAL)

#### å¼ºåˆ¶å¹¶è¡Œè°ƒç”¨ç®¡ç†å™¨
```javascript
class SmartToolManager {
    constructor() {
        this.cache = new Map()
        this.metrics = {
            parallelCalls: 0,
            serialCalls: 0,
            cacheHits: 0,
            errors: 0
        }
    }
    
    // ğŸ”´ å¼ºåˆ¶å¹¶è¡Œè°ƒç”¨ - è¿ååˆ™è­¦å‘Š
    async executeParallel(operations) {
        if (operations.length < 2) {
            this.metrics.serialCalls++
            console.warn("âš ï¸ æ£€æµ‹åˆ°å•ä¸ªå·¥å…·è°ƒç”¨ï¼Œå»ºè®®æ‰¹é‡å¹¶è¡Œæ‰§è¡Œ")
        } else {
            this.metrics.parallelCalls += operations.length
        }
        
        try {
            return await Promise.all(operations.map(op => this.executeWithCache(op)))
        } catch (error) {
            this.metrics.errors++
            throw error
        }
    }
    
    // ç¼“å­˜æœºåˆ¶é¿å…é‡å¤æ“ä½œ
    async executeWithCache(operation) {
        const key = this.generateCacheKey(operation)
        
        if (this.cache.has(key)) {
            this.metrics.cacheHits++
            return this.cache.get(key)
        }
        
        const result = await operation()
        this.cache.set(key, result)
        return result
    }
    
    generateCacheKey(operation) {
        return `${operation.name}_${JSON.stringify(operation.params)}`
    }
    
    // ç”Ÿæˆæ•ˆç‡æŠ¥å‘Š
    getEfficiencyReport() {
        const total = this.metrics.parallelCalls + this.metrics.serialCalls
        const parallelRatio = total > 0 ? (this.metrics.parallelCalls / total) * 100 : 0
        
        return {
            parallelRatio: parallelRatio.toFixed(1) + '%',
            cacheHitRate: (this.metrics.cacheHits / (this.metrics.cacheHits + total) * 100).toFixed(1) + '%',
            errorRate: (this.metrics.errors / total * 100).toFixed(1) + '%',
            recommendation: parallelRatio < 80 ? 'å»ºè®®å¢åŠ å¹¶è¡Œè°ƒç”¨æ¯”ä¾‹' : 'å¹¶è¡Œè°ƒç”¨æ¯”ä¾‹è‰¯å¥½'
        }
    }
}

// å…¨å±€å®ä¾‹
const toolManager = new SmartToolManager()

// å¼ºåˆ¶ä½¿ç”¨æ–¹å¼ - æ›¿ä»£å•ä¸ªå·¥å…·è°ƒç”¨
const results = await toolManager.executeParallel([
    () => read_file('file1.js'),
    () => read_file('file2.js'),
    () => run_terminal_cmd('Get-ChildItem pages -Recurse | Measure-Object'),
    () => grep_search({ query: 'pattern', include_pattern: '*.js' })
])
```

#### æ­£åˆ™è¡¨è¾¾å¼å®‰å…¨å¤„ç†å™¨ (æ–°å¢)
```javascript
class SafeRegexProcessor {
    constructor() {
        this.emojiPattern = /[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu
        this.specialChars = /[\\^$.*+?()[\]{}|]/g
    }
    
    // ğŸ”´ è‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    escapeRegex(pattern) {
        // å¤„ç†emojiå­—ç¬¦
        if (this.emojiPattern.test(pattern)) {
            console.warn("âš ï¸ æ£€æµ‹åˆ°emojiå­—ç¬¦ï¼Œä½¿ç”¨å®‰å…¨æ¨¡å¼å¤„ç†")
            return this.handleEmojiPattern(pattern)
        }
        
        // è½¬ä¹‰å…¶ä»–ç‰¹æ®Šå­—ç¬¦
        return pattern.replace(this.specialChars, '\\$&')
    }
    
    handleEmojiPattern(pattern) {
        // å°†emojiå­—ç¬¦è½¬æ¢ä¸ºUnicodeè½¬ä¹‰åºåˆ—
        return pattern.replace(this.emojiPattern, (match) => {
            const codePoint = match.codePointAt(0)
            return `\\u{${codePoint.toString(16)}}`
        })
    }
    
    // é¢„å®šä¹‰å®‰å…¨æ¨¡å¼
    getSafePatterns() {
        return {
            chineseChars: '[\\u4e00-\\u9fa5]',
            consoleLog: 'console\\.(log|error|warn)',
            emojiInConsole: 'console\\.log.*[\\u{1F600}-\\u{1F64F}]',
            unicodeEmoji: '[\\u{1F600}-\\u{1F64F}\\u{1F300}-\\u{1F5FF}\\u{1F680}-\\u{1F6FF}]'
        }
    }
}

// å…¨å±€å®‰å…¨å¤„ç†å™¨
const regexSafeProcessor = new SafeRegexProcessor()

// ä½¿ç”¨å®‰å…¨æ¨¡å¼
const safePattern = regexSafeProcessor.escapeRegex('console.log.*[ğŸ”§ğŸ”—ğŸ“¨âŒâœ…]')
await grep_search({ query: safePattern, include_pattern: '*.js' })
```

### ğŸ—‚ï¸ ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨ç®¡ç†ç³»ç»Ÿ (æ–°å¢ - ç¬¦åˆç”¨æˆ·è§„åˆ™ç¬¬8æ¡)

#### è‡ªåŠ¨ä¸´æ—¶æ–‡ä»¶ç®¡ç†å™¨
```javascript
class AutoTempFileManager {
    constructor() {
        this.tempFiles = new Set()
        this.tempDirs = new Set()
        this.cleanupHandlers = []
        this.setupAutoCleanup()
    }
    
    // ğŸ”´ åˆ›å»ºä¸´æ—¶æ–‡ä»¶ - è‡ªåŠ¨æ³¨å†Œæ¸…ç†
    async createTempFile(name, content, autoCleanup = true) {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-')
        const tempPath = `.temp_${timestamp}_${name}`
        
        if (autoCleanup) {
            this.tempFiles.add(tempPath)
        }
        
        try {
            await edit_file(tempPath, "ä¸´æ—¶æ–‡ä»¶", content)
            console.log(`âœ… ä¸´æ—¶æ–‡ä»¶å·²åˆ›å»º: ${tempPath}`)
            return tempPath
        } catch (error) {
            console.error(`âŒ ä¸´æ—¶æ–‡ä»¶åˆ›å»ºå¤±è´¥: ${error.message}`)
            throw error
        }
    }
    
    // è®¾ç½®è‡ªåŠ¨æ¸…ç†æœºåˆ¶
    setupAutoCleanup() {
        // ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†
        if (typeof process !== 'undefined') {
            process.on('exit', () => this.cleanup())
            process.on('SIGINT', () => this.cleanup())
            process.on('SIGTERM', () => this.cleanup())
        }
        
        // å®šæœŸæ¸…ç†è¶…è¿‡1å°æ—¶çš„ä¸´æ—¶æ–‡ä»¶
        setInterval(() => this.cleanupOldFiles(), 3600000) // 1å°æ—¶
    }
    
    // ç«‹å³æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶
    async cleanup() {
        let cleanedCount = 0
        let errorCount = 0
        
        for (const file of this.tempFiles) {
            try {
                await delete_file(file)
                cleanedCount++
            } catch (error) {
                errorCount++
                console.warn(`æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¤±è´¥: ${file} - ${error.message}`)
            }
        }
        
        this.tempFiles.clear()
        console.log(`ğŸ§¹ ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ: æˆåŠŸ${cleanedCount}ä¸ª, å¤±è´¥${errorCount}ä¸ª`)
        
        return { cleaned: cleanedCount, errors: errorCount }
    }
    
    // æ¸…ç†è¶…è¿‡æŒ‡å®šæ—¶é—´çš„ä¸´æ—¶æ–‡ä»¶
    async cleanupOldFiles(maxAgeMs = 3600000) { // é»˜è®¤1å°æ—¶
        const now = Date.now()
        const filesToClean = []
        
        for (const file of this.tempFiles) {
            const match = file.match(/\.temp_(\d{4}-\d{2}-\d{2}T\d{2}-\d{2}-\d{2})/)
            if (match) {
                const fileTime = new Date(match[1].replace(/-/g, ':')).getTime()
                if (now - fileTime > maxAgeMs) {
                    filesToClean.push(file)
                }
            }
        }
        
        for (const file of filesToClean) {
            try {
                await delete_file(file)
                this.tempFiles.delete(file)
            } catch (error) {
                console.warn(`æ¸…ç†è¿‡æœŸä¸´æ—¶æ–‡ä»¶å¤±è´¥: ${file}`)
            }
        }
        
        if (filesToClean.length > 0) {
            console.log(`ğŸ§¹ æ¸…ç†äº†${filesToClean.length}ä¸ªè¿‡æœŸä¸´æ—¶æ–‡ä»¶`)
        }
    }
    
    // è·å–ä¸´æ—¶æ–‡ä»¶ç»Ÿè®¡
    getStats() {
        return {
            activeFiles: this.tempFiles.size,
            activeDirs: this.tempDirs.size,
            cleanupHandlers: this.cleanupHandlers.length
        }
    }
}

// å…¨å±€ä¸´æ—¶æ–‡ä»¶ç®¡ç†å™¨
const tempFileManager = new AutoTempFileManager()

// ä½¿ç”¨æ–¹å¼
const tempFile = await tempFileManager.createTempFile('test-rules.mdc', ruleContent)
// ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†ï¼Œæ— éœ€æ‰‹åŠ¨åˆ é™¤
```

### ğŸ“… æ—¥æœŸæ—¶é—´è‡ªåŠ¨è·å–æœºåˆ¶ (æ–°å¢CRITICAL)

#### å¼ºåˆ¶æ—¥æœŸæ—¶é—´å‡†ç¡®æ€§æ£€æŸ¥
```javascript
// ğŸ”´ æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†è‡ªåŠ¨æ—¥æœŸè·å–
class DateTimeManager {
    constructor() {
        this.timezone = 'Asia/Shanghai'
        this.dateFormats = {
            document: 'YYYYå¹´MMæœˆDDæ—¥',
            version: 'YYYY-MM-DD',
            timestamp: 'YYYY-MM-DD HH:mm:ss'
        }
    }
    
    // ğŸ”´ è·å–å½“å‰æ—¥æœŸ - ç¦æ­¢æ‰‹åŠ¨è¾“å…¥æ—¥æœŸ
    getCurrentDate(format = 'document') {
        const now = new Date()
        const year = now.getFullYear()
        const month = String(now.getMonth() + 1).padStart(2, '0')
        const day = String(now.getDate()).padStart(2, '0')
        const hour = String(now.getHours()).padStart(2, '0')
        const minute = String(now.getMinutes()).padStart(2, '0')
        const second = String(now.getSeconds()).padStart(2, '0')
        
        switch (format) {
            case 'document':
                return `${year}å¹´${month}æœˆ${day}æ—¥`
            case 'version':
                return `${year}-${month}-${day}`
            case 'timestamp':
                return `${year}-${month}-${day} ${hour}:${minute}:${second}`
            default:
                return `${year}å¹´${month}æœˆ${day}æ—¥`
        }
    }
    
    // ğŸ”´ è‡ªåŠ¨éªŒè¯æ–‡æ¡£æ—¥æœŸå‡†ç¡®æ€§
    validateDocumentDate(documentContent) {
        const currentDate = this.getCurrentDate('version')
        const datePattern = /æœ€åæ›´æ–°.*?(\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥)/
        const match = documentContent.match(datePattern)
        
        if (match) {
            const docDate = match[1]
            const todayFormatted = this.getCurrentDate('document')
            
            if (docDate !== todayFormatted) {
                console.warn(`âš ï¸ æ–‡æ¡£æ—¥æœŸé”™è¯¯æ£€æµ‹:`)
                console.warn(`æ–‡æ¡£ä¸­çš„æ—¥æœŸ: ${docDate}`)
                console.warn(`ä»Šå¤©çš„æ—¥æœŸ: ${todayFormatted}`)
                return false
            }
        }
        return true
    }
    
    // ğŸ”´ è‡ªåŠ¨æ›´æ–°æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯
    generateVersionInfo(versionNumber) {
        const currentDate = this.getCurrentDate()
        const versionDate = this.getCurrentDate('version')
        
        return {
            version: versionNumber,
            updateDate: currentDate,
            versionDate: versionDate,
            timestamp: this.getCurrentDate('timestamp')
        }
    }
}

// å…¨å±€æ—¥æœŸç®¡ç†å™¨
const dateManager = new DateTimeManager()

// ğŸ”´ å¼ºåˆ¶ä½¿ç”¨æ–¹å¼ - ç¦æ­¢æ‰‹åŠ¨è¾“å…¥æ—¥æœŸ
const versionInfo = dateManager.generateVersionInfo('v2.1.2')
console.log(`æ–‡æ¡£ç‰ˆæœ¬: ${versionInfo.version}`)
console.log(`æ›´æ–°æ—¥æœŸ: ${versionInfo.updateDate}`)

// ğŸ”´ è‡ªåŠ¨éªŒè¯æ–‡æ¡£æ—¥æœŸ
const isDateValid = dateManager.validateDocumentDate(documentContent)
if (!isDateValid) {
    console.error('âŒ æ–‡æ¡£æ—¥æœŸéœ€è¦æ›´æ–°åˆ°ä»Šå¤©çš„æ—¥æœŸ')
}
```

### ğŸ“‹ ä»»åŠ¡éªŒè¯æµç¨‹æ ‡å‡†åŒ– (æ–°å¢)

#### å®Œæ•´ä»»åŠ¡éªŒè¯æ£€æŸ¥æ¸…å•
```javascript
// ğŸ”´ æ ‡å‡†åŒ–ä»»åŠ¡éªŒè¯æµç¨‹
class TaskValidationManager {
    constructor() {
        this.validationRules = []
        this.validationResults = []
    }
    
    // ğŸ”´ æ³¨å†ŒéªŒè¯è§„åˆ™
    addValidationRule(name, validator, priority = 1) {
        this.validationRules.push({
            name,
            validator,
            priority,
            executed: false,
            result: null
        })
        
        // æŒ‰ä¼˜å…ˆçº§æ’åº
        this.validationRules.sort((a, b) => b.priority - a.priority)
    }
    
    // ğŸ”´ æ‰§è¡Œæ‰€æœ‰éªŒè¯
    async runAllValidations() {
        console.log('ğŸ” å¼€å§‹æ‰§è¡Œä»»åŠ¡éªŒè¯...')
        
        for (const rule of this.validationRules) {
            try {
                console.log(`éªŒè¯ä¸­: ${rule.name}`)
                rule.result = await rule.validator()
                rule.executed = true
                
                if (rule.result.success) {
                    console.log(`âœ… ${rule.name}: é€šè¿‡`)
                } else {
                    console.log(`âŒ ${rule.name}: ${rule.result.message}`)
                }
                
                this.validationResults.push({
                    name: rule.name,
                    success: rule.result.success,
                    message: rule.result.message,
                    timestamp: new Date().toISOString()
                })
                
            } catch (error) {
                console.error(`âŒ ${rule.name}: éªŒè¯å¼‚å¸¸ - ${error.message}`)
                rule.result = { success: false, message: error.message }
                rule.executed = true
            }
        }
        
        return this.generateValidationReport()
    }
    
    // ç”ŸæˆéªŒè¯æŠ¥å‘Š
    generateValidationReport() {
        const total = this.validationResults.length
        const passed = this.validationResults.filter(r => r.success).length
        const failed = total - passed
        
        const report = {
            summary: {
                total,
                passed,
                failed,
                successRate: total > 0 ? ((passed / total) * 100).toFixed(1) + '%' : '0%'
            },
            details: this.validationResults,
            recommendations: this.generateRecommendations()
        }
        
        console.log('\nğŸ“Š ä»»åŠ¡éªŒè¯æŠ¥å‘Š:')
        console.log(`æ€»è®¡: ${total}, é€šè¿‡: ${passed}, å¤±è´¥: ${failed}`)
        console.log(`æˆåŠŸç‡: ${report.summary.successRate}`)
        
        if (failed > 0) {
            console.log('\nâŒ éœ€è¦ä¿®å¤çš„é—®é¢˜:')
            this.validationResults
                .filter(r => !r.success)
                .forEach(r => console.log(`  - ${r.name}: ${r.message}`))
        }
        
        return report
    }
    
    // ç”Ÿæˆæ”¹è¿›å»ºè®®
    generateRecommendations() {
        const recommendations = []
        
        if (this.validationResults.some(r => !r.success)) {
            recommendations.push('å»ºè®®ä¿®å¤æ‰€æœ‰éªŒè¯å¤±è´¥çš„é¡¹ç›®åå†ç»§ç»­')
        }
        
        if (this.validationResults.length < 5) {
            recommendations.push('å»ºè®®å¢åŠ æ›´å¤šéªŒè¯è§„åˆ™ç¡®ä¿ä»»åŠ¡å®Œæ•´æ€§')
        }
        
        return recommendations
    }
}

// ğŸ”´ æ ‡å‡†éªŒè¯è§„åˆ™å®šä¹‰
const validator = new TaskValidationManager()

// æ–‡æ¡£å®Œæ•´æ€§éªŒè¯
validator.addValidationRule('æ–‡æ¡£è¯­æ³•æ£€æŸ¥', async () => {
    // æ£€æŸ¥æ–‡æ¡£è¯­æ³•å’Œæ ¼å¼
    return { success: true, message: 'æ–‡æ¡£è¯­æ³•æ­£ç¡®' }
}, 3)

// åŠŸèƒ½é€»è¾‘ä¸€è‡´æ€§éªŒè¯
validator.addValidationRule('é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥', async () => {
    // æ£€æŸ¥ä¿®æ”¹åçš„é€»è¾‘æ˜¯å¦ä¸€è‡´
    return { success: true, message: 'é€»è¾‘ä¸€è‡´æ€§è‰¯å¥½' }
}, 2)

// å®‰å…¨è§„åˆ™ç¬¦åˆæ€§éªŒè¯
validator.addValidationRule('å®‰å…¨è§„åˆ™æ£€æŸ¥', async () => {
    // æ£€æŸ¥æ˜¯å¦ç¬¦åˆé¡¹ç›®å®‰å…¨è§„åˆ™
    return { success: true, message: 'ç¬¦åˆå®‰å…¨è§„åˆ™' }
}, 1)

// æ—¥æœŸå‡†ç¡®æ€§éªŒè¯
validator.addValidationRule('æ—¥æœŸå‡†ç¡®æ€§æ£€æŸ¥', async () => {
    const currentDate = dateManager.getCurrentDate()
    const isValid = dateManager.validateDocumentDate(documentContent)
    return { 
        success: isValid, 
        message: isValid ? 'æ—¥æœŸå‡†ç¡®' : `æ—¥æœŸé”™è¯¯ï¼Œåº”ä¸º${currentDate}` 
    }
}, 3)

// æ‰§è¡ŒéªŒè¯
const validationReport = await validator.runAllValidations()
```

---

**è§„åˆ™æ›´æ–°æ—¶é—´**: 2025å¹´7æœˆ2æ—¥  
**æ›´æ–°å†…å®¹**: æ–°å¢ä¼šè¯é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆï¼Œå»ºç«‹æ•ˆç‡ä¼˜åŒ–å’Œè§„åˆ™ç”Ÿæ•ˆéªŒè¯æœºåˆ¶  
**ç»´æŠ¤çŠ¶æ€**: å®Œæˆ - æ‰€æœ‰è§„åˆ™å·²ç”Ÿæ•ˆï¼Œé¡¹ç›®ä¿®å¤å®Œæ¯•



