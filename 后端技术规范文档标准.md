# ğŸš€ åç«¯æŠ€æœ¯è§„èŒƒæ–‡æ¡£ - ç¼–å†™æ ‡å‡†ä¸å‡†åˆ™

> **åŸºäºNode.jsçš„åç«¯å¼€å‘æŠ€æœ¯è§„èŒƒ** - ä»"å‰ç«¯2å·"æ–‡æ¡£æç‚¼çš„ä¸“ä¸šæ ‡å‡†

## ğŸ“‹ ä¸€ã€æ–‡æ¡£å®šä½ä¸æ ‡å‡†

### 1.1 æ–‡æ¡£å®šä½
- **å”¯ä¸€å—ä¼—**ï¼šåç«¯å¼€å‘å·¥ç¨‹å¸ˆã€DevOpså·¥ç¨‹å¸ˆ
- **æ ¸å¿ƒèŒè´£**ï¼šNode.jsåç«¯æœåŠ¡å¼€å‘è§„èŒƒ
- **æŠ€æœ¯è¾¹ç•Œ**ï¼šä»…æ¶µç›–åç«¯æŠ€æœ¯æ ˆï¼Œä¸åŒ…å«å‰ç«¯UIé€»è¾‘
- **å†…å®¹æ·±åº¦**ï¼šæ·±å…¥åç«¯ä¸“ä¸šé¢†åŸŸï¼Œæä¾›ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆ

### 1.2 æ–‡æ¡£ç»“æ„æ ‡å‡†
```
# Node.jsåç«¯æŠ€æœ¯è§„èŒƒ
â”œâ”€â”€ ğŸ—ï¸ æœåŠ¡æ¶æ„è§„èŒƒ
â”œâ”€â”€ ğŸ“ é¡¹ç›®ç»“æ„è§„èŒƒ
â”œâ”€â”€ ğŸ”Œ APIè®¾è®¡è§„èŒƒ
â”œâ”€â”€ ğŸ—„ï¸ æ•°æ®è®¿é—®è§„èŒƒ
â”œâ”€â”€ ğŸ” å®‰å…¨é˜²æŠ¤è§„èŒƒ
â”œâ”€â”€ ğŸ” æ—¥å¿—ç›‘æ§è§„èŒƒ
â”œâ”€â”€ âš¡ æ€§èƒ½ä¼˜åŒ–è§„èŒƒ
â”œâ”€â”€ ğŸ§ª æµ‹è¯•è§„èŒƒ
â”œâ”€â”€ ğŸš€ éƒ¨ç½²è¿ç»´è§„èŒƒ
â””â”€â”€ ğŸ“Š ç›‘æ§å‘Šè­¦è§„èŒƒ
```

## ğŸ—ï¸ äºŒã€æœåŠ¡æ¶æ„è§„èŒƒ

### 2.1 å¾®æœåŠ¡æ¶æ„è®¾è®¡
```javascript
// ğŸ”´ æœåŠ¡åˆ†å±‚æ¶æ„æ ‡å‡†
const SERVICE_LAYERS = {
  // 1. æ¥å…¥å±‚ (Gateway Layer)
  gateway: {
    purpose: 'APIç½‘å…³ã€è·¯ç”±åˆ†å‘ã€è®¤è¯é‰´æƒ',
    technologies: ['Express.js', 'Koa.js', 'Fastify'],
    responsibilities: [
      'HTTPè¯·æ±‚è·¯ç”±',
      'JWT tokenéªŒè¯',
      'è¯·æ±‚é™æµ',
      'è·¨åŸŸå¤„ç†',
      'è¯·æ±‚æ—¥å¿—è®°å½•'
    ]
  },
  
  // 2. ä¸šåŠ¡å±‚ (Business Layer)
  business: {
    purpose: 'ä¸šåŠ¡é€»è¾‘å¤„ç†ã€æ•°æ®éªŒè¯',
    technologies: ['Service Classes', 'Business Logic'],
    responsibilities: [
      'ä¸šåŠ¡è§„åˆ™å®ç°',
      'æ•°æ®éªŒè¯',
      'ä¸šåŠ¡æµç¨‹æ§åˆ¶',
      'ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ'
    ]
  },
  
  // 3. æ•°æ®å±‚ (Data Layer)
  data: {
    purpose: 'æ•°æ®è®¿é—®ã€ç¼“å­˜ç®¡ç†',
    technologies: ['MySQL', 'Redis', 'Sequelize'],
    responsibilities: [
      'æ•°æ®åº“æ“ä½œ',
      'ç¼“å­˜ç®¡ç†',
      'æ•°æ®æŒä¹…åŒ–',
      'äº‹åŠ¡å¤„ç†'
    ]
  },
  
  // 4. å¤–éƒ¨æœåŠ¡å±‚ (External Layer)
  external: {
    purpose: 'å¤–éƒ¨æœåŠ¡é›†æˆ',
    technologies: ['HTTP Client', 'WebSocket', 'Message Queue'],
    responsibilities: [
      'ç¬¬ä¸‰æ–¹APIè°ƒç”¨',
      'æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†',
      'æ–‡ä»¶å­˜å‚¨æœåŠ¡',
      'å®æ—¶é€šä¿¡æœåŠ¡'
    ]
  }
}
```

### 2.2 é¡¹ç›®ç»“æ„è§„èŒƒ
```
// ğŸ”´ æ ‡å‡†Node.jsé¡¹ç›®ç»“æ„
restaurant-lottery-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/          // ğŸ”´ æ§åˆ¶å™¨å±‚ - è¯·æ±‚å¤„ç†
â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”œâ”€â”€ lottery.controller.js
â”‚   â”‚   â””â”€â”€ user.controller.js
â”‚   â”œâ”€â”€ services/            // ğŸ”´ ä¸šåŠ¡å±‚ - ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ auth.service.js
â”‚   â”‚   â”œâ”€â”€ lottery.service.js
â”‚   â”‚   â””â”€â”€ user.service.js
â”‚   â”œâ”€â”€ models/              // ğŸ”´ æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”œâ”€â”€ Lottery.js
â”‚   â”‚   â””â”€â”€ Product.js
â”‚   â”œâ”€â”€ middleware/          // ğŸ”´ ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.middleware.js
â”‚   â”‚   â”œâ”€â”€ validation.middleware.js
â”‚   â”‚   â””â”€â”€ ratelimit.middleware.js
â”‚   â”œâ”€â”€ routes/              // ğŸ”´ è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â”‚   â”œâ”€â”€ lottery.routes.js
â”‚   â”‚   â””â”€â”€ user.routes.js
â”‚   â”œâ”€â”€ utils/               // ğŸ”´ å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.js
â”‚   â”‚   â”œâ”€â”€ redis.js
â”‚   â”‚   â””â”€â”€ sms.js
â”‚   â”œâ”€â”€ config/              // ğŸ”´ é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js
â”‚   â”‚   â”œâ”€â”€ redis.js
â”‚   â”‚   â””â”€â”€ environment.js
â”‚   â””â”€â”€ app.js               // ğŸ”´ åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                   // ğŸ”´ æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docs/                    // ğŸ”´ APIæ–‡æ¡£
â”œâ”€â”€ docker/                  // ğŸ”´ å®¹å™¨é…ç½®
â”œâ”€â”€ scripts/                 // ğŸ”´ éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ”Œ ä¸‰ã€APIè®¾è®¡è§„èŒƒ

### 3.1 RESTful APIè®¾è®¡æ ‡å‡†
```javascript
// ğŸ”´ APIè·¯ç”±è®¾è®¡è§„èŒƒ
const API_DESIGN_STANDARDS = {
  // 1. èµ„æºå‘½åè§„èŒƒ
  naming: {
    pattern: 'kebab-case',
    examples: {
      users: '/api/users',
      userProfiles: '/api/user-profiles',
      lotteryRecords: '/api/lottery-records'
    }
  },
  
  // 2. HTTPæ–¹æ³•ä½¿ç”¨è§„èŒƒ
  methods: {
    GET: 'è·å–èµ„æº',
    POST: 'åˆ›å»ºèµ„æº',
    PUT: 'å®Œæ•´æ›´æ–°èµ„æº',
    PATCH: 'éƒ¨åˆ†æ›´æ–°èµ„æº',
    DELETE: 'åˆ é™¤èµ„æº'
  },
  
  // 3. çŠ¶æ€ç ä½¿ç”¨è§„èŒƒ
  statusCodes: {
    200: 'è¯·æ±‚æˆåŠŸ',
    201: 'åˆ›å»ºæˆåŠŸ',
    400: 'è¯·æ±‚å‚æ•°é”™è¯¯',
    401: 'æœªæˆæƒ',
    403: 'æƒé™ä¸è¶³',
    404: 'èµ„æºä¸å­˜åœ¨',
    500: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  }
}

// âœ… æ ‡å‡†æ§åˆ¶å™¨å®ç°
class LotteryController {
  constructor() {
    this.lotteryService = new LotteryService()
  }
  
  /**
   * ğŸ”´ è·å–æŠ½å¥–é…ç½®
   * GET /api/lottery/config
   */
  async getConfig(req, res) {
    try {
      const config = await this.lotteryService.getConfig()
      
      res.status(200).json({
        code: 0,
        message: 'è·å–æˆåŠŸ',
        data: config,
        timestamp: new Date().toISOString()
      })
    } catch (error) {
      this.handleError(res, error)
    }
  }
  
  /**
   * ğŸ”´ æ‰§è¡ŒæŠ½å¥–
   * POST /api/lottery/draw
   */
  async draw(req, res) {
    try {
      // 1. å‚æ•°éªŒè¯
      const { userId, costPoints } = req.body
      if (!userId || !costPoints) {
        return res.status(400).json({
          code: 400,
          message: 'å‚æ•°ä¸å®Œæ•´'
        })
      }
      
      // 2. ä¸šåŠ¡é€»è¾‘å¤„ç†
      const result = await this.lotteryService.draw(userId, costPoints)
      
      // 3. è¿”å›ç»“æœ
      res.status(200).json({
        code: 0,
        message: 'æŠ½å¥–æˆåŠŸ',
        data: result
      })
      
    } catch (error) {
      this.handleError(res, error)
    }
  }
  
  /**
   * ğŸ”´ ç»Ÿä¸€é”™è¯¯å¤„ç†
   */
  handleError(res, error) {
    console.error('Controller Error:', error)
    
    // æ ¹æ®é”™è¯¯ç±»å‹è¿”å›ä¸åŒçŠ¶æ€ç 
    if (error.name === 'ValidationError') {
      return res.status(400).json({
        code: 400,
        message: error.message
      })
    }
    
    if (error.name === 'UnauthorizedError') {
      return res.status(401).json({
        code: 401,
        message: 'è®¤è¯å¤±è´¥'
      })
    }
    
    res.status(500).json({
      code: 500,
      message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
    })
  }
}
```

### 3.2 æ•°æ®éªŒè¯ä¸­é—´ä»¶
```javascript
// ğŸ”´ è¯·æ±‚æ•°æ®éªŒè¯æ ‡å‡†
const Joi = require('joi')

const validationSchemas = {
  // ç”¨æˆ·ç™»å½•éªŒè¯
  login: Joi.object({
    mobile: Joi.string()
      .pattern(/^1[3-9]\d{9}$/)
      .required()
      .messages({
        'string.pattern.base': 'æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®'
      }),
    code: Joi.string()
      .length(6)
      .pattern(/^\d{6}$/)
      .required()
      .messages({
        'string.length': 'éªŒè¯ç å¿…é¡»æ˜¯6ä½æ•°å­—'
      })
  }),
  
  // æŠ½å¥–è¯·æ±‚éªŒè¯
  lottery: Joi.object({
    userId: Joi.number().integer().positive().required(),
    costPoints: Joi.number().integer().min(1).required()
  })
}

// âœ… éªŒè¯ä¸­é—´ä»¶å®ç°
const validateRequest = (schema) => {
  return (req, res, next) => {
    const { error } = schema.validate(req.body)
    if (error) {
      return res.status(400).json({
        code: 400,
        message: error.details[0].message
      })
    }
    next()
  }
}

// ä½¿ç”¨æ–¹å¼
router.post('/login', 
  validateRequest(validationSchemas.login),
  authController.login
)
```

## ğŸ—„ï¸ å››ã€æ•°æ®è®¿é—®è§„èŒƒ

### 4.1 æ•°æ®åº“è¿æ¥ç®¡ç†
```javascript
// ğŸ”´ æ•°æ®åº“è¿æ¥æ± é…ç½®
const { Sequelize } = require('sequelize')

class DatabaseManager {
  constructor() {
    this.sequelize = new Sequelize({
      host: process.env.DB_HOST,
      port: process.env.DB_PORT,
      database: process.env.DB_NAME,
      username: process.env.DB_USER,
      password: process.env.DB_PASSWORD,
      dialect: 'mysql',
      
      // ğŸ”´ è¿æ¥æ± é…ç½®
      pool: {
        max: 10,          // æœ€å¤§è¿æ¥æ•°
        min: 0,           // æœ€å°è¿æ¥æ•°
        acquire: 30000,   // è·å–è¿æ¥è¶…æ—¶æ—¶é—´
        idle: 10000       // è¿æ¥ç©ºé—²æ—¶é—´
      },
      
      // ğŸ”´ æ—¥å¿—é…ç½®
      logging: process.env.NODE_ENV === 'development' ? console.log : false,
      
      // ğŸ”´ æ€§èƒ½ä¼˜åŒ–é…ç½®
      define: {
        freezeTableName: true,  // ç¦ç”¨è¡¨åå¤æ•°å½¢å¼
        timestamps: true,       // å¯ç”¨æ—¶é—´æˆ³
        underscored: true,      // ä½¿ç”¨ä¸‹åˆ’çº¿å‘½å
        paranoid: true          // å¯ç”¨è½¯åˆ é™¤
      }
    })
  }
  
  // ğŸ”´ æ•°æ®åº“è¿æ¥åˆå§‹åŒ–
  async initialize() {
    try {
      await this.sequelize.authenticate()
      console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ')
      
      // åŒæ­¥æ•°æ®åº“è¡¨ç»“æ„
      if (process.env.NODE_ENV === 'development') {
        await this.sequelize.sync({ alter: true })
      }
    } catch (error) {
      console.error('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥:', error)
      process.exit(1)
    }
  }
  
  // ğŸ”´ è·å–æ•°æ®åº“å®ä¾‹
  getInstance() {
    return this.sequelize
  }
}
```

### 4.2 æ¨¡å‹å®šä¹‰è§„èŒƒ
```javascript
// ğŸ”´ æ•°æ®æ¨¡å‹æ ‡å‡†å®šä¹‰
const { DataTypes } = require('sequelize')

const User = sequelize.define('User', {
  // ğŸ”´ ä¸»é”®å­—æ®µ
  user_id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true,
    comment: 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†'
  },
  
  // ğŸ”´ ä¸šåŠ¡å­—æ®µ
  mobile: {
    type: DataTypes.STRING(11),
    allowNull: false,
    unique: true,
    validate: {
      is: /^1[3-9]\d{9}$/,
      notEmpty: true
    },
    comment: 'æ‰‹æœºå·'
  },
  
  nickname: {
    type: DataTypes.STRING(50),
    allowNull: true,
    defaultValue: '',
    comment: 'ç”¨æˆ·æ˜µç§°'
  },
  
  avatar: {
    type: DataTypes.STRING(255),
    allowNull: true,
    defaultValue: '',
    comment: 'ç”¨æˆ·å¤´åƒURL'
  },
  
  total_points: {
    type: DataTypes.INTEGER,
    allowNull: false,
    defaultValue: 0,
    validate: {
      min: 0
    },
    comment: 'ç”¨æˆ·æ€»ç§¯åˆ†'
  },
  
  // ğŸ”´ çŠ¶æ€å­—æ®µ
  status: {
    type: DataTypes.ENUM('active', 'inactive', 'banned'),
    allowNull: false,
    defaultValue: 'active',
    comment: 'ç”¨æˆ·çŠ¶æ€'
  },
  
  // ğŸ”´ æƒé™å­—æ®µ
  is_merchant: {
    type: DataTypes.BOOLEAN,
    allowNull: false,
    defaultValue: false,
    comment: 'æ˜¯å¦ä¸ºå•†å®¶'
  },
  
  // ğŸ”´ å¾®ä¿¡ç›¸å…³å­—æ®µ
  wx_openid: {
    type: DataTypes.STRING(50),
    allowNull: true,
    unique: true,
    comment: 'å¾®ä¿¡OpenID'
  }
}, {
  // ğŸ”´ è¡¨é…ç½®
  tableName: 'users',
  timestamps: true,
  paranoid: true,
  
  // ğŸ”´ ç´¢å¼•é…ç½®
  indexes: [
    {
      unique: true,
      fields: ['mobile']
    },
    {
      unique: true,
      fields: ['wx_openid'],
      where: {
        wx_openid: {
          [Op.ne]: null
        }
      }
    },
    {
      fields: ['status', 'is_merchant']
    }
  ],
  
  // ğŸ”´ æ¨¡å‹é’©å­
  hooks: {
    beforeCreate: (user) => {
      // åˆ›å»ºå‰æ•°æ®å¤„ç†
      if (!user.nickname) {
        user.nickname = `ç”¨æˆ·${user.mobile.substr(-4)}`
      }
    }
  }
})

// ğŸ”´ æ¨¡å‹å…³è”å®šä¹‰
User.hasMany(LotteryRecord, { foreignKey: 'user_id' })
User.hasMany(ExchangeRecord, { foreignKey: 'user_id' })
```

### 4.3 æ•°æ®è®¿é—®å±‚æœåŠ¡
```javascript
// ğŸ”´ æ•°æ®è®¿é—®å±‚æ ‡å‡†å®ç°
class UserService {
  constructor() {
    this.model = User
  }
  
  /**
   * ğŸ”´ åˆ›å»ºç”¨æˆ· - åŒ…å«äº‹åŠ¡å¤„ç†
   */
  async createUser(userData) {
    const transaction = await sequelize.transaction()
    
    try {
      // 1. éªŒè¯ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
      const existingUser = await this.model.findOne({
        where: { mobile: userData.mobile }
      })
      
      if (existingUser) {
        throw new Error('ç”¨æˆ·å·²å­˜åœ¨')
      }
      
      // 2. åˆ›å»ºç”¨æˆ·
      const user = await this.model.create(userData, { transaction })
      
      // 3. åˆå§‹åŒ–ç”¨æˆ·ç§¯åˆ†è®°å½•
      await PointsHistory.create({
        user_id: user.user_id,
        points: 0,
        change_type: 'initial',
        description: 'è´¦æˆ·åˆå§‹åŒ–'
      }, { transaction })
      
      await transaction.commit()
      return user
      
    } catch (error) {
      await transaction.rollback()
      throw error
    }
  }
  
  /**
   * ğŸ”´ æ›´æ–°ç”¨æˆ·ç§¯åˆ† - åŸå­æ“ä½œ
   */
  async updateUserPoints(userId, pointsChange, description) {
    const transaction = await sequelize.transaction()
    
    try {
      // 1. é”å®šç”¨æˆ·è®°å½•
      const user = await this.model.findByPk(userId, {
        lock: transaction.LOCK.UPDATE,
        transaction
      })
      
      if (!user) {
        throw new Error('ç”¨æˆ·ä¸å­˜åœ¨')
      }
      
      // 2. æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¶³å¤Ÿï¼ˆæ‰£å‡æ“ä½œï¼‰
      if (pointsChange < 0 && user.total_points + pointsChange < 0) {
        throw new Error('ç§¯åˆ†ä¸è¶³')
      }
      
      // 3. æ›´æ–°ç§¯åˆ†
      await user.update({
        total_points: user.total_points + pointsChange
      }, { transaction })
      
      // 4. è®°å½•ç§¯åˆ†å˜åŠ¨å†å²
      await PointsHistory.create({
        user_id: userId,
        points: pointsChange,
        change_type: pointsChange > 0 ? 'earn' : 'spend',
        description: description,
        balance_after: user.total_points + pointsChange
      }, { transaction })
      
      await transaction.commit()
      return user
      
    } catch (error) {
      await transaction.rollback()
      throw error
    }
  }
  
  /**
   * ğŸ”´ æ‰¹é‡æŸ¥è¯¢ç”¨æˆ· - åˆ†é¡µå’Œè¿‡æ»¤
   */
  async findUsers(options = {}) {
    const {
      page = 1,
      limit = 20,
      status = 'active',
      isMerchant = null,
      search = null
    } = options
    
    const where = { status }
    
    // å•†å®¶ç­›é€‰
    if (isMerchant !== null) {
      where.is_merchant = isMerchant
    }
    
    // æœç´¢æ¡ä»¶
    if (search) {
      where[Op.or] = [
        { mobile: { [Op.like]: `%${search}%` } },
        { nickname: { [Op.like]: `%${search}%` } }
      ]
    }
    
    const result = await this.model.findAndCountAll({
      where,
      limit,
      offset: (page - 1) * limit,
      order: [['created_at', 'DESC']],
      attributes: { exclude: ['deleted_at'] }
    })
    
    return {
      users: result.rows,
      total: result.count,
      page,
      limit,
      totalPages: Math.ceil(result.count / limit)
    }
  }
}
```

## ğŸ” äº”ã€å®‰å…¨é˜²æŠ¤è§„èŒƒ

### 5.1 è®¤è¯æˆæƒç³»ç»Ÿ
```javascript
// ğŸ”´ JWTè®¤è¯ä¸­é—´ä»¶
const jwt = require('jsonwebtoken')
const rateLimit = require('express-rate-limit')

class AuthMiddleware {
  constructor() {
    this.jwtSecret = process.env.JWT_SECRET
    this.jwtExpires = process.env.JWT_EXPIRES || '7d'
  }
  
  /**
   * ğŸ”´ ç”ŸæˆJWT Token
   */
  generateToken(payload) {
    return jwt.sign(payload, this.jwtSecret, {
      expiresIn: this.jwtExpires,
      issuer: 'restaurant-lottery-api',
      audience: 'restaurant-lottery-client'
    })
  }
  
  /**
   * ğŸ”´ éªŒè¯JWT Token
   */
  verifyToken(req, res, next) {
    const authHeader = req.headers.authorization
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return res.status(401).json({
        code: 401,
        message: 'è®¤è¯å¤´æ ¼å¼é”™è¯¯'
      })
    }
    
    const token = authHeader.substring(7)
    
    try {
      const decoded = jwt.verify(token, this.jwtSecret)
      req.user = decoded
      next()
    } catch (error) {
      if (error.name === 'TokenExpiredError') {
        return res.status(401).json({
          code: 401,
          message: 'Tokenå·²è¿‡æœŸ'
        })
      }
      
      return res.status(401).json({
        code: 401,
        message: 'TokenéªŒè¯å¤±è´¥'
      })
    }
  }
  
  /**
   * ğŸ”´ æƒé™éªŒè¯ä¸­é—´ä»¶
   */
  requireMerchant(req, res, next) {
    if (!req.user.is_merchant) {
      return res.status(403).json({
        code: 403,
        message: 'éœ€è¦å•†å®¶æƒé™'
      })
    }
    next()
  }
}

// ğŸ”´ è¯·æ±‚é¢‘ç‡é™åˆ¶
const createRateLimit = (windowMs, max, message) => {
  return rateLimit({
    windowMs,
    max,
    message: {
      code: 429,
      message
    },
    standardHeaders: true,
    legacyHeaders: false
  })
}

// ä¸åŒæ¥å£çš„é™æµé…ç½®
const rateLimiters = {
  // ç™»å½•æ¥å£ï¼šæ¯åˆ†é’Ÿæœ€å¤š5æ¬¡
  login: createRateLimit(60 * 1000, 5, 'ç™»å½•è¯·æ±‚è¿‡äºé¢‘ç¹'),
  
  // å‘é€éªŒè¯ç ï¼šæ¯åˆ†é’Ÿæœ€å¤š3æ¬¡
  sendCode: createRateLimit(60 * 1000, 3, 'éªŒè¯ç å‘é€è¿‡äºé¢‘ç¹'),
  
  // æŠ½å¥–æ¥å£ï¼šæ¯åˆ†é’Ÿæœ€å¤š10æ¬¡
  lottery: createRateLimit(60 * 1000, 10, 'æŠ½å¥–è¯·æ±‚è¿‡äºé¢‘ç¹'),
  
  // ä¸€èˆ¬APIï¼šæ¯åˆ†é’Ÿæœ€å¤š100æ¬¡
  general: createRateLimit(60 * 1000, 100, 'è¯·æ±‚è¿‡äºé¢‘ç¹')
}
```

### 5.2 æ•°æ®åŠ å¯†ä¸éªŒè¯
```javascript
// ğŸ”´ æ•°æ®åŠ å¯†å·¥å…·
const crypto = require('crypto')
const bcrypt = require('bcrypt')

class SecurityUtils {
  constructor() {
    this.algorithm = 'aes-256-gcm'
    this.secretKey = process.env.ENCRYPTION_KEY
  }
  
  /**
   * ğŸ”´ æ•æ„Ÿæ•°æ®åŠ å¯†
   */
  encrypt(text) {
    const iv = crypto.randomBytes(16)
    const cipher = crypto.createCipher(this.algorithm, this.secretKey)
    cipher.setAAD(Buffer.from('restaurant-lottery', 'utf8'))
    
    let encrypted = cipher.update(text, 'utf8', 'hex')
    encrypted += cipher.final('hex')
    
    const authTag = cipher.getAuthTag()
    
    return {
      encrypted,
      iv: iv.toString('hex'),
      authTag: authTag.toString('hex')
    }
  }
  
  /**
   * ğŸ”´ æ•æ„Ÿæ•°æ®è§£å¯†
   */
  decrypt(encryptedData) {
    const { encrypted, iv, authTag } = encryptedData
    
    const decipher = crypto.createDecipher(this.algorithm, this.secretKey)
    decipher.setAAD(Buffer.from('restaurant-lottery', 'utf8'))
    decipher.setAuthTag(Buffer.from(authTag, 'hex'))
    
    let decrypted = decipher.update(encrypted, 'hex', 'utf8')
    decrypted += decipher.final('utf8')
    
    return decrypted
  }
  
  /**
   * ğŸ”´ å¯†ç å“ˆå¸Œ
   */
  async hashPassword(password) {
    const saltRounds = 12
    return await bcrypt.hash(password, saltRounds)
  }
  
  /**
   * ğŸ”´ å¯†ç éªŒè¯
   */
  async verifyPassword(password, hash) {
    return await bcrypt.compare(password, hash)
  }
  
  /**
   * ğŸ”´ æ‰‹æœºå·è„±æ•
   */
  maskMobile(mobile) {
    if (!mobile || mobile.length !== 11) return mobile
    return mobile.substring(0, 3) + '****' + mobile.substring(7)
  }
}
```

## ğŸ” å…­ã€æ—¥å¿—ç›‘æ§è§„èŒƒ

### 6.1 æ—¥å¿—ç³»ç»Ÿè®¾è®¡
```javascript
// ğŸ”´ ç»Ÿä¸€æ—¥å¿—ç®¡ç†
const winston = require('winston')
const DailyRotateFile = require('winston-daily-rotate-file')

class Logger {
  constructor() {
    this.logger = winston.createLogger({
      level: process.env.LOG_LEVEL || 'info',
      format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.errors({ stack: true }),
        winston.format.json()
      ),
      
      transports: [
        // ğŸ”´ æ§åˆ¶å°è¾“å‡º
        new winston.transports.Console({
          format: winston.format.combine(
            winston.format.colorize(),
            winston.format.simple()
          )
        }),
        
        // ğŸ”´ æ–‡ä»¶è¾“å‡º - æŒ‰æ—¥æœŸè½®è½¬
        new DailyRotateFile({
          filename: 'logs/application-%DATE%.log',
          datePattern: 'YYYY-MM-DD',
          maxSize: '20m',
          maxFiles: '30d'
        }),
        
        // ğŸ”´ é”™è¯¯æ—¥å¿—å•ç‹¬è®°å½•
        new DailyRotateFile({
          filename: 'logs/error-%DATE%.log',
          datePattern: 'YYYY-MM-DD',
          level: 'error',
          maxSize: '20m',
          maxFiles: '90d'
        })
      ]
    })
  }
  
  /**
   * ğŸ”´ APIè¯·æ±‚æ—¥å¿—
   */
  logRequest(req, res, responseTime) {
    this.logger.info('API Request', {
      method: req.method,
      url: req.originalUrl,
      ip: req.ip,
      userAgent: req.get('User-Agent'),
      statusCode: res.statusCode,
      responseTime: `${responseTime}ms`,
      userId: req.user?.user_id,
      timestamp: new Date().toISOString()
    })
  }
  
  /**
   * ğŸ”´ ä¸šåŠ¡æ“ä½œæ—¥å¿—
   */
  logBusinessOperation(operation, data, userId = null) {
    this.logger.info('Business Operation', {
      operation,
      data,
      userId,
      timestamp: new Date().toISOString()
    })
  }
  
  /**
   * ğŸ”´ é”™è¯¯æ—¥å¿—
   */
  logError(error, context = {}) {
    this.logger.error('Application Error', {
      message: error.message,
      stack: error.stack,
      context,
      timestamp: new Date().toISOString()
    })
  }
}

// ğŸ”´ è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
const requestLogger = (req, res, next) => {
  const startTime = Date.now()
  
  res.on('finish', () => {
    const responseTime = Date.now() - startTime
    logger.logRequest(req, res, responseTime)
  })
  
  next()
}
```

### 6.2 æ€§èƒ½ç›‘æ§
```javascript
// ğŸ”´ æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
const performanceMonitor = (req, res, next) => {
  const startTime = process.hrtime()
  const startMemory = process.memoryUsage()
  
  res.on('finish', () => {
    const [seconds, nanoseconds] = process.hrtime(startTime)
    const responseTime = seconds * 1000 + nanoseconds / 1000000
    const endMemory = process.memoryUsage()
    
    // è®°å½•æ€§èƒ½æŒ‡æ ‡
    logger.info('Performance Metrics', {
      url: req.originalUrl,
      method: req.method,
      responseTime: `${responseTime.toFixed(2)}ms`,
      memoryUsage: {
        rss: endMemory.rss - startMemory.rss,
        heapUsed: endMemory.heapUsed - startMemory.heapUsed
      },
      timestamp: new Date().toISOString()
    })
    
    // æ€§èƒ½å‘Šè­¦
    if (responseTime > 1000) {
      logger.warn('Slow API Response', {
        url: req.originalUrl,
        responseTime: `${responseTime.toFixed(2)}ms`
      })
    }
  })
  
  next()
}
```

## âš¡ ä¸ƒã€æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 7.1 æ•°æ®åº“ä¼˜åŒ–
```javascript
// ğŸ”´ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥
class DatabaseOptimization {
  
  /**
   * ğŸ”´ æŸ¥è¯¢ä¼˜åŒ– - ä½¿ç”¨ç´¢å¼•
   */
  async optimizedQuery(conditions) {
    // âœ… ä½¿ç”¨ç´¢å¼•å­—æ®µæŸ¥è¯¢
    return await User.findAll({
      where: {
        status: 'active',        // æœ‰ç´¢å¼•
        is_merchant: true        // æœ‰è”åˆç´¢å¼•
      },
      attributes: ['user_id', 'mobile', 'nickname'], // åªé€‰æ‹©éœ€è¦çš„å­—æ®µ
      limit: 50,
      offset: 0,
      order: [['created_at', 'DESC']]  // ä½¿ç”¨ç´¢å¼•æ’åº
    })
  }
  
  /**
   * ğŸ”´ æ‰¹é‡æ“ä½œä¼˜åŒ–
   */
  async batchUpdate(updates) {
    const transaction = await sequelize.transaction()
    
    try {
      // ä½¿ç”¨æ‰¹é‡æ›´æ–°è€Œä¸æ˜¯å¾ªç¯å•ä¸ªæ›´æ–°
      const promises = updates.map(update => 
        User.update(
          { total_points: update.points },
          { 
            where: { user_id: update.userId },
            transaction 
          }
        )
      )
      
      await Promise.all(promises)
      await transaction.commit()
      
    } catch (error) {
      await transaction.rollback()
      throw error
    }
  }
  
  /**
   * ğŸ”´ åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
   */
  async paginatedQuery(page, limit) {
    // ä½¿ç”¨ offset å’Œ limit è¿›è¡Œåˆ†é¡µ
    const offset = (page - 1) * limit
    
    return await User.findAndCountAll({
      where: { status: 'active' },
      limit: Math.min(limit, 50), // é™åˆ¶æœ€å¤§æŸ¥è¯¢æ•°é‡
      offset,
      order: [['created_at', 'DESC']],
      attributes: { exclude: ['password', 'deleted_at'] }
    })
  }
}
```

### 7.2 ç¼“å­˜ç­–ç•¥
```javascript
// ğŸ”´ Redisç¼“å­˜ç®¡ç†
const redis = require('redis')

class CacheManager {
  constructor() {
    this.client = redis.createClient({
      host: process.env.REDIS_HOST,
      port: process.env.REDIS_PORT,
      password: process.env.REDIS_PASSWORD,
      retry_strategy: (options) => {
        if (options.error && options.error.code === 'ECONNREFUSED') {
          return new Error('RedisæœåŠ¡å™¨è¿æ¥è¢«æ‹’ç»')
        }
        if (options.total_retry_time > 1000 * 60 * 60) {
          return new Error('Redisé‡è¯•æ—¶é—´è€—å°½')
        }
        return Math.min(options.attempt * 100, 3000)
      }
    })
  }
  
  /**
   * ğŸ”´ ç¼“å­˜æŠ½å¥–é…ç½®
   */
  async cacheLotteryConfig(config) {
    const key = 'lottery:config'
    const ttl = 60 * 60 // 1å°æ—¶è¿‡æœŸ
    
    await this.client.setex(key, ttl, JSON.stringify(config))
  }
  
  /**
   * ğŸ”´ è·å–ç¼“å­˜çš„æŠ½å¥–é…ç½®
   */
  async getLotteryConfig() {
    const key = 'lottery:config'
    const cached = await this.client.get(key)
    
    return cached ? JSON.parse(cached) : null
  }
  
  /**
   * ğŸ”´ ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
   */
  async cacheUserInfo(userId, userInfo) {
    const key = `user:${userId}`
    const ttl = 30 * 60 // 30åˆ†é’Ÿè¿‡æœŸ
    
    await this.client.setex(key, ttl, JSON.stringify(userInfo))
  }
  
  /**
   * ğŸ”´ åˆ†å¸ƒå¼é”å®ç°
   */
  async acquireLock(key, timeout = 10000) {
    const lockKey = `lock:${key}`
    const lockValue = Date.now() + timeout
    
    const result = await this.client.set(lockKey, lockValue, 'PX', timeout, 'NX')
    return result === 'OK'
  }
  
  /**
   * ğŸ”´ é‡Šæ”¾åˆ†å¸ƒå¼é”
   */
  async releaseLock(key) {
    const lockKey = `lock:${key}`
    await this.client.del(lockKey)
  }
}
```

## ğŸ§ª å…«ã€æµ‹è¯•è§„èŒƒ

### 8.1 å•å…ƒæµ‹è¯•æ ‡å‡†
```javascript
// ğŸ”´ å•å…ƒæµ‹è¯•æ¡†æ¶é…ç½®
const { describe, it, beforeEach, afterEach } = require('mocha')
const { expect } = require('chai')
const sinon = require('sinon')

describe('UserService', () => {
  let userService
  let mockDb
  
  beforeEach(() => {
    userService = new UserService()
    mockDb = sinon.createStubInstance(User)
  })
  
  afterEach(() => {
    sinon.restore()
  })
  
  describe('createUser', () => {
    it('åº”è¯¥æˆåŠŸåˆ›å»ºæ–°ç”¨æˆ·', async () => {
      // Arrange
      const userData = {
        mobile: '13800138000',
        nickname: 'æµ‹è¯•ç”¨æˆ·'
      }
      
      mockDb.findOne.resolves(null) // ç”¨æˆ·ä¸å­˜åœ¨
      mockDb.create.resolves({ user_id: 1, ...userData })
      
      // Act
      const result = await userService.createUser(userData)
      
      // Assert
      expect(result.user_id).to.equal(1)
      expect(result.mobile).to.equal(userData.mobile)
      expect(mockDb.create.calledOnce).to.be.true
    })
    
    it('åº”è¯¥æ‹’ç»åˆ›å»ºé‡å¤ç”¨æˆ·', async () => {
      // Arrange
      const userData = { mobile: '13800138000' }
      mockDb.findOne.resolves({ user_id: 1 }) // ç”¨æˆ·å·²å­˜åœ¨
      
      // Act & Assert
      try {
        await userService.createUser(userData)
        expect.fail('åº”è¯¥æŠ›å‡ºé”™è¯¯')
      } catch (error) {
        expect(error.message).to.equal('ç”¨æˆ·å·²å­˜åœ¨')
      }
    })
  })
})
```

### 8.2 é›†æˆæµ‹è¯•æ ‡å‡†
```javascript
// ğŸ”´ APIé›†æˆæµ‹è¯•
const request = require('supertest')
const app = require('../src/app')

describe('API Integration Tests', () => {
  let authToken
  
  before(async () => {
    // è·å–æµ‹è¯•ç”¨æˆ·çš„è®¤è¯ä»¤ç‰Œ
    const loginResponse = await request(app)
      .post('/api/auth/login')
      .send({
        mobile: '13800138000',
        code: '123456'
      })
    
    authToken = loginResponse.body.data.access_token
  })
  
  describe('GET /api/lottery/config', () => {
    it('åº”è¯¥è¿”å›æŠ½å¥–é…ç½®', async () => {
      const response = await request(app)
        .get('/api/lottery/config')
        .set('Authorization', `Bearer ${authToken}`)
        .expect(200)
      
      expect(response.body.code).to.equal(0)
      expect(response.body.data).to.have.property('prizes')
      expect(response.body.data.prizes).to.be.an('array')
    })
  })
  
  describe('POST /api/lottery/draw', () => {
    it('åº”è¯¥æˆåŠŸæ‰§è¡ŒæŠ½å¥–', async () => {
      const response = await request(app)
        .post('/api/lottery/draw')
        .set('Authorization', `Bearer ${authToken}`)
        .send({
          userId: 1,
          costPoints: 100
        })
        .expect(200)
      
      expect(response.body.code).to.equal(0)
      expect(response.body.data).to.have.property('prizeId')
    })
  })
})
```

## ğŸš€ ä¹ã€éƒ¨ç½²è¿ç»´è§„èŒƒ

### 9.1 Dockerå®¹å™¨åŒ–é…ç½®
```dockerfile
# ğŸ”´ å¤šé˜¶æ®µæ„å»ºDockerfile
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production && npm cache clean --force

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ğŸ”´ ç”Ÿäº§ç¯å¢ƒé•œåƒ
FROM node:18-alpine AS production

# å®‰è£…dumb-initç”¨äºä¿¡å·å¤„ç†
RUN apk add --no-cache dumb-init

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001

WORKDIR /app

# å¤åˆ¶æ„å»ºç»“æœ
COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --from=builder --chown=nodejs:nodejs /app/package*.json ./

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER nodejs

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node healthcheck.js

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["dumb-init", "--"]
CMD ["node", "dist/app.js"]
```

### 9.2 ç¯å¢ƒé…ç½®ç®¡ç†
```javascript
// ğŸ”´ ç¯å¢ƒé…ç½®éªŒè¯
const Joi = require('joi')

const envSchema = Joi.object({
  NODE_ENV: Joi.string()
    .valid('development', 'testing', 'production')
    .default('development'),
  
  PORT: Joi.number()
    .port()
    .default(3000),
  
  DB_HOST: Joi.string().required(),
  DB_PORT: Joi.number().port().default(3306),
  DB_NAME: Joi.string().required(),
  DB_USER: Joi.string().required(),
  DB_PASSWORD: Joi.string().required(),
  
  REDIS_HOST: Joi.string().required(),
  REDIS_PORT: Joi.number().port().default(6379),
  REDIS_PASSWORD: Joi.string().allow(''),
  
  JWT_SECRET: Joi.string().min(32).required(),
  JWT_EXPIRES: Joi.string().default('7d'),
  
  SMS_ACCESS_KEY: Joi.string().required(),
  SMS_SECRET_KEY: Joi.string().required(),
  
  SEALOS_ENDPOINT: Joi.string().uri().required(),
  SEALOS_ACCESS_KEY: Joi.string().required(),
  SEALOS_SECRET_KEY: Joi.string().required()
})

// ğŸ”´ é…ç½®éªŒè¯å’ŒåŠ è½½
const { error, value: envVars } = envSchema.validate(process.env)

if (error) {
  throw new Error(`ç¯å¢ƒé…ç½®éªŒè¯å¤±è´¥: ${error.message}`)
}

module.exports = envVars
```

## ğŸ“Š åã€ç›‘æ§å‘Šè­¦è§„èŒƒ

### 10.1 å¥åº·æ£€æŸ¥ç«¯ç‚¹
```javascript
// ğŸ”´ å¥åº·æ£€æŸ¥å®ç°
const healthCheck = {
  // åº”ç”¨çŠ¶æ€æ£€æŸ¥
  async checkApplication() {
    return {
      status: 'healthy',
      timestamp: new Date().toISOString(),
      uptime: process.uptime(),
      memory: process.memoryUsage(),
      version: process.env.npm_package_version
    }
  },
  
  // æ•°æ®åº“è¿æ¥æ£€æŸ¥
  async checkDatabase() {
    try {
      await sequelize.authenticate()
      return { status: 'healthy', responseTime: Date.now() }
    } catch (error) {
      return { status: 'unhealthy', error: error.message }
    }
  },
  
  // Redisè¿æ¥æ£€æŸ¥
  async checkRedis() {
    try {
      const start = Date.now()
      await redis.ping()
      return { 
        status: 'healthy', 
        responseTime: Date.now() - start 
      }
    } catch (error) {
      return { status: 'unhealthy', error: error.message }
    }
  }
}

// å¥åº·æ£€æŸ¥è·¯ç”±
app.get('/health', async (req, res) => {
  const checks = await Promise.all([
    healthCheck.checkApplication(),
    healthCheck.checkDatabase(),
    healthCheck.checkRedis()
  ])
  
  const [app, db, redis] = checks
  const allHealthy = checks.every(check => check.status === 'healthy')
  
  res.status(allHealthy ? 200 : 503).json({
    status: allHealthy ? 'healthy' : 'unhealthy',
    checks: { app, db, redis },
    timestamp: new Date().toISOString()
  })
})
```

### 10.2 å‘Šè­¦è§„åˆ™é…ç½®
```javascript
// ğŸ”´ å‘Šè­¦è§„åˆ™å®šä¹‰
const ALERT_RULES = {
  // å“åº”æ—¶é—´å‘Šè­¦
  responseTime: {
    threshold: 1000, // 1ç§’
    action: 'warn',
    message: 'APIå“åº”æ—¶é—´è¿‡é•¿'
  },
  
  // é”™è¯¯ç‡å‘Šè­¦
  errorRate: {
    threshold: 0.05, // 5%
    window: 300, // 5åˆ†é’Ÿçª—å£
    action: 'critical',
    message: 'é”™è¯¯ç‡è¿‡é«˜'
  },
  
  // å†…å­˜ä½¿ç”¨å‘Šè­¦
  memoryUsage: {
    threshold: 0.8, // 80%
    action: 'warn',
    message: 'å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜'
  },
  
  // æ•°æ®åº“è¿æ¥å‘Šè­¦
  dbConnection: {
    threshold: 0, // è¿æ¥å¤±è´¥
    action: 'critical',
    message: 'æ•°æ®åº“è¿æ¥å¤±è´¥'
  }
}
```

---

## ğŸ¯ æ€»ç»“ï¼šåç«¯æŠ€æœ¯è§„èŒƒæ–‡æ¡£ä»·å€¼

### âœ… æ ¸å¿ƒä»·å€¼
1. **æœåŠ¡ç¨³å®šæ€§**ï¼šé€šè¿‡è§„èŒƒåŒ–çš„æ¶æ„è®¾è®¡ç¡®ä¿æœåŠ¡é«˜å¯ç”¨
2. **å¼€å‘æ•ˆç‡**ï¼šæ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹æå‡å›¢é˜Ÿåä½œæ•ˆç‡
3. **å®‰å…¨ä¿éšœ**ï¼šå®Œå–„çš„å®‰å…¨é˜²æŠ¤æœºåˆ¶ä¿æŠ¤ç³»ç»Ÿå®‰å…¨
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºæœ€ä½³å®è·µçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ğŸ¯ å®æ–½è·¯å¾„
1. **åŸºç¡€è®¾æ–½**ï¼šé¦–å…ˆå»ºç«‹æ•°æ®åº“ã€ç¼“å­˜ã€æ—¥å¿—ç­‰åŸºç¡€è®¾æ–½
2. **æ ¸å¿ƒåŠŸèƒ½**ï¼šå®ç°ç”¨æˆ·è®¤è¯ã€æƒé™ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½
3. **ä¸šåŠ¡é€»è¾‘**ï¼šåŸºäºè§„èŒƒå®ç°å…·ä½“ä¸šåŠ¡åŠŸèƒ½
4. **ç›‘æ§è¿ç»´**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å‘Šè­¦ä½“ç³»

**æ–‡æ¡£å®šä½**ï¼šåç«¯å¼€å‘å·¥ç¨‹å¸ˆä¸“ç”¨æŠ€æœ¯è§„èŒƒ  
**è¦†ç›–èŒƒå›´**ï¼šNode.jsåç«¯æœåŠ¡å¼€å‘å…¨æµç¨‹  
**æ›´æ–°ç­–ç•¥**ï¼šéšæŠ€æœ¯å‘å±•å’Œä¸šåŠ¡éœ€æ±‚æŒç»­ä¼˜åŒ– 