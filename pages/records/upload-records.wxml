<!--pages/records/upload-records.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="back-btn" bindtap="onBack">
        <text class="back-icon">â—€</text>
      </view>
      <view class="header-title">
        <text class="title-text">ä¸Šä¼ è®°å½•</text>
        <text class="title-desc">æˆ‘çš„å°ç¥¨ä¸Šä¼ å†å²</text>
      </view>
      <view class="header-actions">
        <text class="total-count">å…±{{total}}æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="statistics-card" wx:if="{{!loading}}">
    <view class="stat-item">
      <text class="stat-number">{{statistics.totalCount}}</text>
      <text class="stat-label">ä¸Šä¼ æ¬¡æ•°</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.totalPoints}}</text>
      <text class="stat-label">è·å¾—ç§¯åˆ†</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.approvedCount}}</text>
      <text class="stat-label">å·²é€šè¿‡</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.pendingCount}}</text>
      <text class="stat-label">å¾…å®¡æ ¸</text>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="all"
    >
      <text>å…¨éƒ¨</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'pending' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="pending"
    >
      <text>å¾…å®¡æ ¸</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'approved' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="approved"
    >
      <text>å·²é€šè¿‡</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'rejected' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="rejected"
    >
      <text>å·²æ‹’ç»</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{!loading}}">
    <view 
      class="record-item"
      wx:for="{{records}}" 
      wx:key="id"
    >
      <view class="record-header">
        <view class="upload-info">
          <text class="upload-time">{{item.created_at}}</text>
          <text class="amount-info">é‡‘é¢ï¼šï¿¥{{item.amount}}</text>
        </view>
        <view class="upload-status">
          <text class="status-text {{item.status}}">
            {{item.status_text}}
          </text>
        </view>
      </view>
      
      <view class="record-content">
        <image 
          class="receipt-image" 
          src="{{item.image_url}}" 
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-image="{{item.image_url}}"
        />
        <view class="upload-details">
          <view class="points-info" wx:if="{{item.points_earned > 0}}">
            <text class="points-label">è·å¾—ç§¯åˆ†ï¼š</text>
            <text class="points-value">+{{item.points_earned}}</text>
          </view>
          <view class="review-info" wx:if="{{item.review_time}}">
            <text class="review-time">å®¡æ ¸æ—¶é—´ï¼š{{item.review_time}}</text>
          </view>
          <view class="review-reason" wx:if="{{item.review_reason}}">
            <text class="reason-text">{{item.review_reason}}</text>
          </view>
        </view>
      </view>
      
      <view class="record-actions">
        <button 
          class="action-btn detail-btn"
          bindtap="onViewDetail"
          data-record="{{item}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <text class="empty-icon">ğŸ“¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰ä¸Šä¼ è®°å½•</text>
      <text class="empty-desc">å¿«å»æ‹å°ç¥¨èµšç§¯åˆ†å§ï¼</text>
      <button class="goto-upload-btn" bindtap="onGoToUpload">
        å»ä¸Šä¼ 
      </button>
    </view>

    <!-- ğŸ”§ ä¸´æ—¶ï¼šè°ƒè¯•å·¥å…·é¢æ¿ -->
    <view class="debug-panel" style="margin: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
      <text style="font-size: 14px; color: #666; display: block; margin-bottom: 10px;">ğŸ”§ ä¸´æ—¶è°ƒè¯•å·¥å…·ï¼ˆä¿®å¤å®Œæˆåä¼šç§»é™¤ï¼‰</text>
      <view style="display: flex; flex-wrap: wrap; gap: 10px;">
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px;" bindtap="onDebugDiagnose">è¯Šæ–­é—®é¢˜</button>
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px;" bindtap="onDebugForceRefresh">å¼ºåˆ¶åˆ·æ–°</button>
        <button class="mini-btn" style="font-size: 12px;" bindtap="onDebugShowToken">æŸ¥çœ‹Token</button>
      </view>
    </view>

    <!-- ğŸ”§ æ–°å¢ï¼šçŠ¶æ€ç­›é€‰æµ‹è¯•é¢æ¿ -->
    <view class="debug-panel" style="margin: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffeaa7;">
      <text style="font-size: 14px; color: #856404; display: block; margin-bottom: 10px;">ğŸ§ª çŠ¶æ€ç­›é€‰åŠŸèƒ½æµ‹è¯•</text>
      <view style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px; background: #28a745; color: white;" bindtap="onTestSpecificStatus" data-status="approved">æµ‹è¯•å·²é€šè¿‡</button>
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px; background: #dc3545; color: white;" bindtap="onTestSpecificStatus" data-status="rejected">æµ‹è¯•å·²æ‹’ç»</button>
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px; background: #ffc107; color: #212529;" bindtap="onTestSpecificStatus" data-status="pending">æµ‹è¯•å¾…å®¡æ ¸</button>
        <button class="mini-btn" style="font-size: 12px; background: #6c757d; color: white;" bindtap="onTestSpecificStatus" data-status="all">æµ‹è¯•å…¨éƒ¨</button>
      </view>
      <view style="display: flex; flex-wrap: wrap; gap: 10px;">
        <button class="mini-btn" style="margin-right: 10px; font-size: 12px; background: #007bff; color: white;" bindtap="onTestStatusFilter">å®Œæ•´è¯Šæ–­</button>
        <button class="mini-btn" style="font-size: 12px; background: #17a2b8; color: white;" bindtap="onQuickFix">ä¸€é”®ä¿®å¤</button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && records.length > 0}}" bindtap="loadMoreRecords">
      <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>