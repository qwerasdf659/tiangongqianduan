<!--pages/records/upload-records.wxml - ä¸Šä¼ è®°å½•é¡µé¢-->
<view class="upload-records-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="title-section">
      <text class="page-title">ğŸ“· ä¸Šä¼ è®°å½•</text>
    </view>
    
    <!-- ğŸ” è°ƒè¯•ï¼š13612227930é—®é¢˜æ’æŸ¥ä¿¡æ¯ -->
    <view class="debug-info" wx:if="{{debugInfo}}">
      <text class="debug-title">ğŸ” è°ƒè¯•ä¿¡æ¯ï¼ˆ13612227930é—®é¢˜æ’æŸ¥ï¼‰</text>
      <view class="debug-detail">
        <text>å½“å‰ç”¨æˆ·ï¼š{{debugInfo.currentUser ? debugInfo.currentUser.mobile : 'æœªç™»å½•'}}</text>
      </view>
      <view class="debug-detail">
        <text>TokençŠ¶æ€ï¼š{{debugInfo.hasToken ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ'}}</text>
      </view>
      <view class="debug-detail">
        <text>æ˜¯å¦ç™»å½•ï¼š{{debugInfo.isLoggedIn ? 'æ˜¯' : 'å¦'}}</text>
      </view>
      <button class="debug-refresh-btn" bindtap="onManualRefresh">ğŸ”„ å¼ºåˆ¶åˆ·æ–°æ•°æ®</button>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics" wx:if="{{!loading}}">
    <view class="stat-item">
      <text class="stat-number">{{statistics.totalCount}}</text>
      <text class="stat-label">æ€»è®°å½•</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.pendingCount}}</text>
      <text class="stat-label">å¾…å®¡æ ¸</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.approvedCount}}</text>
      <text class="stat-label">å·²é€šè¿‡</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.rejectedCount}}</text>
      <text class="stat-label">å·²æ‹’ç»</text>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-status="all"
      >
        å…¨éƒ¨
      </view>
      <view 
        class="filter-tab {{filterStatus === 'pending' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-status="pending"
      >
        å¾…å®¡æ ¸
      </view>
      <view 
        class="filter-tab {{filterStatus === 'approved' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-status="approved"
      >
        å·²é€šè¿‡
      </view>
      <view 
        class="filter-tab {{filterStatus === 'rejected' ? 'active' : ''}}"
        bindtap="onFilterChange"
        data-status="rejected"
      >
        å·²æ‹’ç»
      </view>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{!loading}}">
    <view 
      class="record-item"
      wx:for="{{records}}" 
      wx:key="id"
    >
      <view class="record-header">
        <view class="upload-info">
          <text class="upload-time">{{item.created_at}}</text>
          <text class="amount-info">é‡‘é¢ï¼šï¿¥{{item.amount}}</text>
        </view>
        <view class="upload-status">
          <text class="status-text {{item.status}}">
            {{item.status_text}}
          </text>
        </view>
      </view>
      
      <view class="record-content">
        <image 
          class="receipt-image" 
          src="{{item.image_url}}" 
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-image="{{item.image_url}}"
        />
        <view class="upload-details">
          <view class="points-info" wx:if="{{item.points_earned > 0}}">
            <text class="points-label">è·å¾—ç§¯åˆ†ï¼š</text>
            <text class="points-value">+{{item.points_earned}}</text>
          </view>
          <view class="review-info" wx:if="{{item.review_time}}">
            <text class="review-time">å®¡æ ¸æ—¶é—´ï¼š{{item.review_time}}</text>
          </view>
          <view class="review-reason" wx:if="{{item.review_reason}}">
            <text class="reason-text">{{item.review_reason}}</text>
          </view>
        </view>
      </view>
      
      <view class="record-actions">
        <button 
          class="action-btn detail-btn"
          bindtap="onViewDetail"
          data-record="{{item}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <text class="empty-icon">ğŸ“¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰ä¸Šä¼ è®°å½•</text>
      <text class="empty-desc">å¿«å»æ‹å°ç¥¨èµšç§¯åˆ†å§ï¼</text>
      <button class="goto-upload-btn" bindtap="onGoToUpload">
        å»ä¸Šä¼ 
      </button>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && records.length > 0}}" bindtap="loadMoreRecords">
      <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>