<!--pages/records/exchange-records.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="back-btn" bindtap="onBack">
        <text class="back-icon">â—€</text>
      </view>
      <view class="header-title">
        <text class="title-text">å…‘æ¢è®°å½•</text>
        <text class="title-desc">æˆ‘çš„å…‘æ¢å†å²</text>
      </view>
      <view class="header-actions">
        <text class="total-count">å…±{{total}}æ¬¡</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="statistics-card" wx:if="{{!loading}}">
    <view class="stat-item">
      <text class="stat-number">{{statistics.totalCount}}</text>
      <text class="stat-label">å…‘æ¢æ¬¡æ•°</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.totalPoints}}</text>
      <text class="stat-label">æ¶ˆè´¹ç§¯åˆ†</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.pendingCount}}</text>
      <text class="stat-label">å¾…å‘è´§</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{statistics.completedCount}}</text>
      <text class="stat-label">å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="all"
    >
      <text>å…¨éƒ¨</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'pending' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="pending"
    >
      <text>å¾…å‘è´§</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'shipped' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="shipped"
    >
      <text>å·²å‘è´§</text>
    </view>
    <view 
      class="filter-tab {{filterStatus === 'completed' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="completed"
    >
      <text>å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{!loading}}">
    <view 
      class="record-item"
      wx:for="{{records}}" 
      wx:key="id"
    >
      <view class="record-header">
        <view class="order-info">
          <text class="order-no">è®¢å•å·ï¼š{{item.order_no}}</text>
          <text class="order-time">{{item.created_at}}</text>
        </view>
        <view class="order-status">
          <text class="status-text {{item.status}}">
            {{item.status === 'pending' ? 'å¾…å‘è´§' : (item.status === 'shipped' ? 'å·²å‘è´§' : 'å·²å®Œæˆ')}}
          </text>
        </view>
      </view>
      
      <view class="record-content">
        <image class="product-image" src="{{item.product_image}}" mode="aspectFill" />
        <view class="product-info">
          <text class="product-name">{{item.product_name}}</text>
          <text class="product-quantity">æ•°é‡ï¼š{{item.quantity}}</text>
          <text class="points-cost">{{item.points_cost}}ç§¯åˆ†</text>
        </view>
      </view>
      
      <view class="record-actions">
        <button 
          class="action-btn detail-btn"
          bindtap="onViewDetail"
          data-record="{{item}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        <button 
          class="action-btn service-btn"
          bindtap="onContactService"
          data-record="{{item}}"
        >
          è”ç³»å®¢æœ
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <text class="empty-icon">ğŸ›ï¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å…‘æ¢è®°å½•</text>
      <text class="empty-desc">å¿«å»ç§¯åˆ†å•†åŸå…‘æ¢å–œæ¬¢çš„å•†å“å§ï¼</text>
      <button class="goto-exchange-btn" bindtap="onGoToExchange">
        å»å…‘æ¢
      </button>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && records.length > 0}}" bindtap="loadMoreRecords">
      <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šè®°å½•äº†</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view> 