<!--pages/points-detail/points-detail.wxml-->
<view class="points-detail-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="user-points">
      <text class="points-label">å½“å‰ç§¯åˆ†</text>
      <text class="points-value">{{totalPoints || 0}}</text>
      <text class="points-unit">åˆ†</text>
    </view>
    <view class="last-update" wx:if="{{lastUpdateTime}}">
      <text>æœ€åæ›´æ–°ï¼š{{lastUpdateTime}}</text>
    </view>
  </view>

  <!-- ç­›é€‰é€‰é¡¹ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <button 
        class="filter-tab {{pointsFilter === 'all' ? 'active' : ''}}"
        bindtap="onPointsFilterChange"
        data-filter="all"
      >
        å…¨éƒ¨è®°å½•
      </button>
      <button 
        class="filter-tab {{pointsFilter === 'earn' ? 'active' : ''}}"
        bindtap="onPointsFilterChange"
        data-filter="earn"
      >
        ç§¯åˆ†è·å¾—
      </button>
      <button 
        class="filter-tab {{pointsFilter === 'consume' ? 'active' : ''}}"
        bindtap="onPointsFilterChange"
        data-filter="consume"
      >
        ç§¯åˆ†æ¶ˆè´¹
      </button>
    </view>
  </view>

  <!-- ç§¯åˆ†è®°å½•åˆ—è¡¨ -->
  <view class="records-section">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading && filteredPointsRecords.length === 0}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:elif="{{!loading && (!filteredPointsRecords || filteredPointsRecords.length === 0)}}">
      <view class="empty-icon">ğŸ“</view>
      <text class="empty-title">æš‚æ— ç§¯åˆ†è®°å½•</text>
      <text class="empty-desc">å¿«å»å‚ä¸æ´»åŠ¨è·å–ç§¯åˆ†å§ï¼</text>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="records-list" wx:else>
      <view 
        class="record-item"
        wx:for="{{filteredPointsRecords}}" 
        wx:key="id"
      >
        <view class="record-info">
          <view class="record-desc">{{item.description || 'ç§¯åˆ†å˜åŠ¨'}}</view>
          <view class="record-time">{{item.created_at || 'æœªçŸ¥æ—¶é—´'}}</view>
        </view>
        <view class="record-points {{item.points > 0 ? 'earn' : 'consume'}}">
          <view class="points-change">
            {{item.points > 0 ? '+' : ''}}{{item.points || 0}}
          </view>
          <view class="points-balance">ä½™é¢: {{item.balance_after || 0}}</view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more-section" wx:if="{{hasMoreRecords}}">
        <view class="load-more-btn" wx:if="{{!loading}}" bindtap="loadMoreRecords">
          <text>ç‚¹å‡»åŠ è½½æ›´å¤š</text>
        </view>
        <view class="loading-more" wx:else>
          <view class="loading-spinner small"></view>
          <text>åŠ è½½ä¸­...</text>
        </view>
      </view>

      <!-- æ²¡æœ‰æ›´å¤šäº† -->
      <view class="no-more-section" wx:elif="{{filteredPointsRecords.length > 0}}">
        <text class="no-more-text">â€” æ²¡æœ‰æ›´å¤šè®°å½•äº† â€”</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <button class="action-btn refresh-btn" bindtap="onPullDownRefresh">
      ğŸ”„ åˆ·æ–°è®°å½•
    </button>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section" wx:if="{{filteredPointsRecords.length > 0}}">
    <view class="stats-item">
      <text class="stats-label">è®°å½•æ€»æ•°</text>
      <text class="stats-value">{{filteredPointsRecords.length}}</text>
    </view>
    <view class="stats-item">
      <text class="stats-label">å½“å‰ç­›é€‰</text>
      <text class="stats-value">
        {{pointsFilter === 'all' ? 'å…¨éƒ¨' : (pointsFilter === 'earn' ? 'è·å¾—' : 'æ¶ˆè´¹')}}
      </text>
    </view>
  </view>
</view> 