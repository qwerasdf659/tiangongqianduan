<!--pages/user/user.wxml-->
<view class="user-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-avatar" bindtap="onAvatarTap">
      <image class="avatar-image" src="{{userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"/>
      <view class="avatar-edit">
        <text class="edit-icon">ğŸ“·</text>
      </view>
    </view>
    
    <view class="user-info">
      <view class="user-name" bindtap="onPhoneTap">
        <text class="name-text">{{userInfo.phone || 'ç‚¹å‡»ç™»å½•'}}</text>
        <text class="edit-phone">âœï¸</text>
      </view>
      <view class="user-id">ID: {{userInfo.user_id || 'æœªç™»å½•'}}</view>
      <view class="user-level">
        <text class="level-icon">ğŸ‘‘</text>
        <text class="level-text">{{userInfo.level || 'VIP1'}} ä¼šå‘˜</text>
      </view>
    </view>
  </view>

  <!-- ç§¯åˆ†ä½™é¢å¡ç‰‡ -->
  <view class="points-card" bindtap="onPointsTap">
    <view class="points-header">
      <text class="points-title">æˆ‘çš„ç§¯åˆ†</text>
      <view class="header-tips">
        <text class="points-tips">ç‚¹å‡»æŸ¥çœ‹æ˜ç»† ğŸ‘‡</text>
        <button class="test-points-card-btn" bindtap="testPointsDetail" size="mini" catchtap="true">ğŸ§ª</button>
      </view>
    </view>
    <view class="points-amount">
      <text class="points-number">{{totalPoints}}</text>
      <text class="points-unit">åˆ†</text>
    </view>
    
    <!-- ç§¯åˆ†è¶‹åŠ¿ -->
    <view class="points-trend">
      <view class="trend-item">
        <text class="trend-label">ä»Šæ—¥è·å¾—</text>
        <text class="trend-value earned">+{{todayEarned || 0}}</text>
      </view>
      <view class="trend-item">
        <text class="trend-label">ä»Šæ—¥æ¶ˆè´¹</text>
        <text class="trend-value consumed">{{todayConsumed > 0 ? '-' : ''}}{{todayConsumed || 0}}</text>
      </view>
    </view>
  </view>

  

  <!-- æˆå°±ç³»ç»Ÿ -->
  <view class="achievements-section" wx:if="{{!loading}}">
    <view class="section-title">
      <text>ğŸ† æˆ‘çš„æˆå°±</text>
      <text class="achievement-count">({{unlockedAchievements}}/{{totalAchievements}})</text>
    </view>
    <view class="achievements-grid">
      <view 
        class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
        wx:for="{{achievements}}" 
        wx:key="id"
      >
        <text class="achievement-icon">{{item.icon}}</text>
        <text class="achievement-name">{{item.name}}</text>
        <text class="achievement-progress">{{item.progress}}/{{item.target}}</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ® -->
  <view class="statistics-section" wx:if="{{!loading}}">
    <view class="section-title">
      <text>ğŸ“Š æˆ‘çš„ç»Ÿè®¡</text>
      <button class="refresh-stats" bindtap="onRefreshStats">ğŸ”„</button>
    </view>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalLottery}}</text>
        <text class="stat-label">æŠ½å¥–æ¬¡æ•°</text>
        <text class="stat-trend {{statistics.lotteryTrend === 'â†‘' ? 'up' : (statistics.lotteryTrend === 'â†“' ? 'down' : 'stable')}}">{{statistics.lotteryTrend}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalExchange}}</text>
        <text class="stat-label">å…‘æ¢æ¬¡æ•°</text>
        <text class="stat-trend {{statistics.exchangeTrend === 'â†‘' ? 'up' : (statistics.exchangeTrend === 'â†“' ? 'down' : 'stable')}}">{{statistics.exchangeTrend}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalUpload}}</text>
        <text class="stat-label">ä¸Šä¼ æ¬¡æ•°</text>
        <text class="stat-trend {{statistics.uploadTrend === 'â†‘' ? 'up' : (statistics.uploadTrend === 'â†“' ? 'down' : 'stable')}}">{{statistics.uploadTrend}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.thisMonthPoints}}</text>
        <text class="stat-label">æœ¬æœˆç§¯åˆ†</text>
        <text class="stat-trend {{statistics.pointsTrend === 'â†‘' ? 'up' : (statistics.pointsTrend === 'â†“' ? 'down' : 'stable')}}">{{statistics.pointsTrend}}</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="section-title">
      <text>ğŸ”§ åŠŸèƒ½èœå•</text>
    </view>
    <view class="menu-grid">
      <view 
        class="menu-item"
        wx:for="{{menuItems}}" 
        wx:key="id"
        bindtap="onMenuItemTap"
        data-item="{{item}}"
        style="border-left: 4rpx solid {{item.color}}"
      >
        <view class="menu-icon" style="color: {{item.color}}">{{item.icon}}</view>
        <view class="menu-content">
          <text class="menu-name">{{item.name}}</text>
          <text class="menu-desc">{{item.description}}</text>
        </view>
        <text class="menu-arrow">â–¶</text>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <button class="quick-btn service-btn" bindtap="onContactService">
      ğŸ“ è”ç³»å®¢æœ
    </button>
    <button class="quick-btn feedback-btn" bindtap="onFeedback">
      ğŸ’¬ æ„è§åé¦ˆ
    </button>
    <button class="quick-btn logout-btn" bindtap="onLogout">
      ğŸšª é€€å‡ºç™»å½•
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
      
      <!-- ğŸ”§ ç´§æ€¥ä¿®å¤æŒ‰é’®ï¼šç«‹å³è§£é™¤loadingçŠ¶æ€ -->
      <button class="emergency-fix-btn" bindtap="emergencyFixLoading">
        ğŸš¨ ç«‹å³ä½¿ç”¨èœå•
      </button>
      <text class="emergency-tips">å¦‚æœåŠ è½½æ—¶é—´è¿‡é•¿ï¼Œç‚¹å‡»æ­¤æŒ‰é’®ç«‹å³ä½¿ç”¨åŠŸèƒ½èœå•</text>
      
      <!-- ğŸ”§ æµ‹è¯•æŒ‰é’®ï¼šç”¨äºéªŒè¯é¡µé¢ä¿®å¤æ•ˆæœ -->
      <button class="test-display-btn" bindtap="testPageDisplay">
        ğŸ§ª æµ‹è¯•é¡µé¢æ˜¾ç¤º
      </button>
      <text class="test-tips">å¼€å‘æµ‹è¯•ç”¨ï¼ŒéªŒè¯é¡µé¢ä¿®å¤æ•ˆæœ</text>
    </view>
  </view>

  <!-- å•†å®¶å…¥å£ -->
  <view class="merchant-entrance">
    <button class="merchant-btn" bindtap="onMerchantEntrance">
      ğŸª å•†å®¶ç®¡ç†
    </button>
    <text class="merchant-desc">å•†å®¶æƒé™ç”³è¯·ä¸ç®¡ç†</text>
  </view>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-info">
    <text class="version-text">é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ v1.2.0</text>
    <text class="copyright">Â© 2024 All Rights Reserved</text>
    <text class="update-time">æœ€åæ›´æ–°ï¼š{{lastUpdateTime}}</text>
  </view>
</view>