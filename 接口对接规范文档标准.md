# ğŸ”— æ¥å£å¯¹æ¥è§„èŒƒæ–‡æ¡£ - é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ

> **å‰åç«¯æ¥å£å¯¹æ¥å®Œæ•´è§„èŒƒ** - åŸºäºå®é™…é¡¹ç›®ä»£ç çš„ä¸‰ç«¯åä½œæ ‡å‡†åŒ–æ¥å£æ–‡æ¡£

## ğŸ“‹ ä¸€ã€æ–‡æ¡£å®šä½ä¸æ ‡å‡†

### 1.1 æ–‡æ¡£å®šä½
- **å¤šé‡å—ä¼—**ï¼šå‰ç«¯å¼€å‘ã€åç«¯å¼€å‘ã€æµ‹è¯•å·¥ç¨‹å¸ˆ
- **æ ¸å¿ƒèŒè´£**ï¼šå®šä¹‰å‰åç«¯æ•°æ®äº¤äº’æ ‡å‡†å’Œåè®®
- **æŠ€æœ¯è¾¹ç•Œ**ï¼šä¸“æ³¨æ¥å£å±‚é¢ï¼Œè¿æ¥å‰ç«¯ã€åç«¯ã€æ•°æ®åº“ä¸‰ç«¯
- **å†…å®¹æ·±åº¦**ï¼šæä¾›å¯ç›´æ¥ä½¿ç”¨çš„æ¥å£è§„èŒƒå’Œç¤ºä¾‹
- **é¡¹ç›®çŠ¶æ€**ï¼šâœ… **100%åŸºäºå®é™…ä»£ç åˆ†æ**
- **æ›´æ–°æ—¶é—´**ï¼š2025å¹´01æœˆ03æ—¥ - åŸºäºå®é™…ä»£ç æ·±åº¦åˆ†ææ›´æ–°
- **ä½¿ç”¨æ¨¡å‹**ï¼šClaude Sonnet 4
- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.1.4 - ä¸äº§å“åŠŸèƒ½ç»“æ„æ–‡æ¡£åŒæ­¥æ›´æ–°

### 1.2 ğŸ¯ å®é™…é¡¹ç›®APIæ¶æ„ï¼ˆåŸºäºroutes/ç›®å½•åˆ†æï¼‰

**ğŸ“‹ æ ¸å¿ƒAPIæ¨¡å—ï¼ˆåŸºäºå®é™…è·¯ç”±æ–‡ä»¶ï¼‰**

#### 1.2.1 ğŸ” è®¤è¯æˆæƒæ¨¡å— (routes/auth.js - 377è¡Œ)
```javascript
// å®é™…å®ç°çš„è®¤è¯æ¥å£
const AUTH_APIS = {
  login: {
    method: 'POST',
    path: '/api/auth/login', 
    description: 'ç”¨æˆ·ç™»å½•ï¼ˆæ‰‹æœºå· + éªŒè¯ç ï¼‰',
    implementation: 'authenticateUser() - æ”¯æŒfindOrCreateByMobileè‡ªåŠ¨åˆ›å»ºç”¨æˆ·',
    frontendIntegration: 'æ”¯æŒ2001é”™è¯¯ç ä¸“é¡¹å¤„ç†æœºåˆ¶',
    requestFields: {
      phone: 'string - æ‰‹æœºå·ç ',
      code: 'string - éªŒè¯ç ï¼ˆå¼€å‘é˜¶æ®µä»»æ„6ä½æ•°å­—ï¼‰'
    },
    responseFields: {
      access_token: 'string - JWTè®¿é—®ä»¤ç‰Œ',
      refresh_token: 'string - åˆ·æ–°ä»¤ç‰Œ',
      user_info: 'object - ç”¨æˆ·ä¿¡æ¯',
      expires_in: 'number - è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰'
    }
  },
  adminLogin: {
    method: 'POST',
    path: '/api/auth/admin-login',
    description: 'ç®¡ç†å‘˜ç™»å½•ï¼ˆè´¦å· + å¯†ç ï¼‰',
    implementation: 'authenticateAdmin() - éšè—ç™»å½•å…¥å£',
    frontendIntegration: 'éšè—å¼è§¦å‘æœºåˆ¶ï¼ˆè¿ç»­ç‚¹å‡»5æ¬¡ï¼‰',
    requestFields: {
      username: 'string - ç®¡ç†å‘˜è´¦å·',
      password: 'string - ç®¡ç†å‘˜å¯†ç ',
      skip_sms: 'boolean - å¼€å‘é˜¶æ®µè·³è¿‡çŸ­ä¿¡éªŒè¯'
    },
    responseFields: {
      access_token: 'string - JWTè®¿é—®ä»¤ç‰Œ',
      user_info: 'object - ç®¡ç†å‘˜ä¿¡æ¯',
      permissions: 'array - æƒé™åˆ—è¡¨'
    }
  },
  refreshToken: {
    method: 'POST',
    path: '/api/auth/refresh',
    description: 'JWT Tokenåˆ·æ–°',
    implementation: 'refreshTokens() - è‡ªåŠ¨å»¶é•¿æœ‰æ•ˆæœŸ',
    frontendIntegration: 'è‡ªåŠ¨é‡è¯•æœºåˆ¶é›†æˆ',
    requestFields: {
      refresh_token: 'string - åˆ·æ–°ä»¤ç‰Œ'
    },
    responseFields: {
      access_token: 'string - æ–°çš„è®¿é—®ä»¤ç‰Œ',
      expires_in: 'number - è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰'
    }
  },
  verifyToken: {
    method: 'GET',
    path: '/api/auth/verify-token',
    description: 'TokenéªŒè¯',
    implementation: 'verifyToken() - ä¸­é—´ä»¶éªŒè¯',
    frontendIntegration: 'é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨éªŒè¯',
    requestHeaders: {
      'Authorization': 'Bearer {access_token}'
    },
    responseFields: {
      valid: 'boolean - ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ',
      user_info: 'object - ç”¨æˆ·ä¿¡æ¯',
      expires_at: 'timestamp - è¿‡æœŸæ—¶é—´'
    }
  },
  logout: {
    method: 'POST',
    path: '/api/auth/logout',
    description: 'é€€å‡ºç™»å½•',
    implementation: 'logout() - æ¸…é™¤Token',
    frontendIntegration: 'å…¨å±€é€€å‡ºç™»å½•å¤„ç†',
    requestHeaders: {
      'Authorization': 'Bearer {access_token}'
    },
    responseFields: {
      success: 'boolean - æ˜¯å¦æˆåŠŸé€€å‡º'
    }
  },
  sendCode: {
    method: 'POST',
    path: '/api/auth/send-code',
    description: 'å‘é€éªŒè¯ç ',
    implementation: 'sendVerificationCode() - å¼€å‘é˜¶æ®µæš‚åœ',
    frontendIntegration: 'å¼€å‘é˜¶æ®µMockæ¨¡å¼æ”¯æŒ',
    requestFields: {
      phone: 'string - æ‰‹æœºå·ç ',
      type: 'string - éªŒè¯ç ç±»å‹ï¼ˆlogin/registerï¼‰'
    },
    responseFields: {
      message: 'string - å‘é€ç»“æœæ¶ˆæ¯',
      expire_time: 'timestamp - éªŒè¯ç è¿‡æœŸæ—¶é—´'
    }
  }
};
```

#### 1.2.2 ğŸ° æŠ½å¥–ç³»ç»Ÿæ¨¡å— (routes/lottery.js - 277è¡Œ)
```javascript
// å®é™…å®ç°çš„æŠ½å¥–æ¥å£
const LOTTERY_APIS = {
  getConfig: {
    method: 'GET',
    path: '/api/lottery/config',
    description: 'è·å–æŠ½å¥–é…ç½®ï¼ˆè½¬ç›˜æ¸²æŸ“å¿…éœ€ï¼‰',
    implementation: 'LotteryService.getFrontendConfig() - è¿”å›8åŒºåŸŸè½¬ç›˜é…ç½®',
    frontendIntegration: 'é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œæ”¯æŒå­—æ®µæ˜ å°„å…¼å®¹æ€§',
    requestHeaders: {
      'Authorization': 'Bearer {access_token}'
    },
    responseFields: {
      prizes: 'array - 8ä¸ªå¥–å“é…ç½®',
      cost_points: 'number - æŠ½å¥–æ¶ˆè€—ç§¯åˆ†',
      user_points: 'number - ç”¨æˆ·å½“å‰ç§¯åˆ†',
      today_draw_count: 'number - ä»Šæ—¥æŠ½å¥–æ¬¡æ•°',
      rules: 'object - æŠ½å¥–è§„åˆ™è¯´æ˜'
    },
    prizeFieldMapping: {
      'name/prize_name/title': 'å¥–å“åç§°',
      'probability/chance/rate': 'ä¸­å¥–æ¦‚ç‡',
      'type/prize_type/category': 'å¥–å“ç±»å‹',
      'value/points/worth': 'å¥–å“ä»·å€¼'
    }
  },
  performDraw: {
    method: 'POST',
    path: '/api/lottery/draw',
    description: 'æ‰§è¡ŒæŠ½å¥–ï¼ˆæ”¯æŒå•æŠ½ã€è¿æŠ½ï¼‰',
    implementation: 'LotteryService.performDraw() - å«10æ¬¡ä¿åº•æœºåˆ¶',
    frontendIntegration: 'æ”¯æŒå¤šç§æŠ½å¥–æ¨¡å¼ï¼Œè‡ªåŠ¨æ‰£é™¤ç§¯åˆ†',
    requestFields: {
      draw_type: 'string - æŠ½å¥–ç±»å‹ï¼ˆsingle/multiï¼‰',
      count: 'number - æŠ½å¥–æ¬¡æ•°ï¼ˆ1,3,5,10ï¼‰'
    },
    responseFields: {
      results: 'array - æŠ½å¥–ç»“æœåˆ—è¡¨',
      user_points: 'number - å‰©ä½™ç§¯åˆ†',
      total_cost: 'number - æ€»æ¶ˆè€—ç§¯åˆ†',
      pity_count: 'number - ä¿åº•è®¡æ•°'
    },
    resultFieldMapping: {
      'prize_id/id': 'å¥–å“ID',
      'prize_name/name': 'å¥–å“åç§°',
      'prize_type/type': 'å¥–å“ç±»å‹',
      'win_time/timestamp': 'ä¸­å¥–æ—¶é—´'
    }
  },
  getRecords: {
    method: 'GET',
    path: '/api/lottery/records',
    description: 'æŠ½å¥–è®°å½•æŸ¥è¯¢ï¼ˆåˆ†é¡µï¼‰',
    implementation: 'LotteryRecord.findAndCountAll() - åˆ†é¡µæŸ¥è¯¢',
    frontendIntegration: 'æ”¯æŒåˆ†é¡µåŠ è½½ï¼Œä¸Šæ‹‰åˆ·æ–°',
    requestParams: {
      page: 'number - é¡µç ï¼ˆé»˜è®¤1ï¼‰',
      limit: 'number - æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰',
      start_date: 'date - å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰',
      end_date: 'date - ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰'
    },
    responseFields: {
      records: 'array - æŠ½å¥–è®°å½•åˆ—è¡¨',
      total: 'number - æ€»è®°å½•æ•°',
      page: 'number - å½“å‰é¡µç ',
      has_more: 'boolean - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®'
    }
  },
  getStatistics: {
    method: 'GET',
    path: '/api/lottery/statistics',
    description: 'æŠ½å¥–ç»Ÿè®¡æ•°æ®',
    implementation: 'getLotteryStatistics() - ç”¨æˆ·æŠ½å¥–ç»Ÿè®¡',
    frontendIntegration: 'ç”¨æˆ·ä¸­å¿ƒç»Ÿè®¡å±•ç¤º',
    responseFields: {
      total_draws: 'number - æ€»æŠ½å¥–æ¬¡æ•°',
      total_wins: 'number - æ€»ä¸­å¥–æ¬¡æ•°',
      win_rate: 'number - ä¸­å¥–ç‡',
      favorite_prize: 'string - æœ€å¸¸ä¸­å¥–å“'
    }
  }
};
```

#### 1.2.3 ğŸ›ï¸ ç§¯åˆ†å…‘æ¢æ¨¡å— (routes/exchange.js - 353è¡Œ)
```javascript
// å®é™…å®ç°çš„å…‘æ¢æ¥å£
const EXCHANGE_APIS = {
  getProducts: {
    method: 'GET',
    path: '/api/exchange/products',
    description: 'å•†å“åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰',
    implementation: 'CommodityPool.findAndCountAll() - æ”¯æŒåˆ†ç±»ç­›é€‰',
    frontendIntegration: 'æ”¯æŒåˆ†é¡µåŠ è½½ã€åˆ†ç±»ç­›é€‰ã€åº“å­˜çŠ¶æ€æ˜¾ç¤º',
    requestParams: {
      page: 'number - é¡µç ',
      limit: 'number - æ¯é¡µæ•°é‡',
      category: 'string - å•†å“åˆ†ç±»ï¼ˆå¯é€‰ï¼‰',
      sort: 'string - æ’åºæ–¹å¼ï¼ˆpoints_asc/points_desc/stock_descï¼‰'
    },
    responseFields: {
      products: 'array - å•†å“åˆ—è¡¨',
      total: 'number - æ€»å•†å“æ•°',
      categories: 'array - åˆ†ç±»åˆ—è¡¨',
      has_more: 'boolean - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®'
    },
    productFieldMapping: {
      'name/product_name/title': 'å•†å“åç§°',
      'points_required/cost/price': 'æ‰€éœ€ç§¯åˆ†',
      'stock/inventory/quantity': 'åº“å­˜æ•°é‡',
      'image_url/image/picture': 'å•†å“å›¾ç‰‡'
    }
  },
  submitExchange: {
    method: 'POST',
    path: '/api/exchange/submit',
    description: 'æäº¤å…‘æ¢è®¢å•',
    implementation: 'processExchange() - åº“å­˜æ£€æŸ¥ã€ç§¯åˆ†æ‰£é™¤ã€WebSocketæ¨é€',
    frontendIntegration: 'æ”¯æŒåº“å­˜æ£€æŸ¥ã€ç§¯åˆ†æ‰£é™¤ã€å®æ—¶æ¨é€',
    requestFields: {
      product_id: 'number - å•†å“ID',
      quantity: 'number - å…‘æ¢æ•°é‡',
      delivery_info: 'object - é…é€ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰'
    },
    responseFields: {
      order_id: 'string - è®¢å•ID',
      exchange_code: 'string - å…‘æ¢ç ',
      user_points: 'number - å‰©ä½™ç§¯åˆ†',
      estimated_delivery: 'date - é¢„è®¡é…é€æ—¶é—´'
    }
  },
  getOrders: {
    method: 'GET',
    path: '/api/exchange/orders',
    description: 'å…‘æ¢è®¢å•åˆ—è¡¨',
    implementation: 'ExchangeOrder.findAndCountAll() - ç”¨æˆ·è®¢å•æŸ¥è¯¢',
    frontendIntegration: 'è®¢å•çŠ¶æ€è·Ÿè¸ªï¼Œæ”¯æŒåˆ†é¡µåŠ è½½',
    requestParams: {
      page: 'number - é¡µç ',
      limit: 'number - æ¯é¡µæ•°é‡',
      status: 'string - è®¢å•çŠ¶æ€ï¼ˆå¯é€‰ï¼‰'
    },
    responseFields: {
      orders: 'array - è®¢å•åˆ—è¡¨',
      total: 'number - æ€»è®¢å•æ•°',
      has_more: 'boolean - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®'
    },
    orderFieldMapping: {
      'order_id/id': 'è®¢å•ID',
      'product_name/name': 'å•†å“åç§°',
      'status/state': 'è®¢å•çŠ¶æ€',
      'created_at/create_time': 'åˆ›å»ºæ—¶é—´'
    }
  },
  getCategories: {
    method: 'GET',
    path: '/api/exchange/categories',
    description: 'å•†å“åˆ†ç±»',
    implementation: 'CommodityPool.getCategories() - åŠ¨æ€åˆ†ç±»',
    frontendIntegration: 'åˆ†ç±»ç­›é€‰åŠŸèƒ½',
    responseFields: {
      categories: 'array - åˆ†ç±»åˆ—è¡¨',
      category_counts: 'object - å„åˆ†ç±»å•†å“æ•°é‡'
    }
  }
};
```

#### 1.2.4 ğŸ“¸ æ‹ç…§ä¸Šä¼ æ¨¡å— (routes/photo.js - 331è¡Œ)
```javascript
// å®é™…å®ç°çš„æ‹ç…§æ¥å£
const PHOTO_APIS = {
  uploadPhoto: {
    method: 'POST',
    path: '/api/photo/upload',
    description: 'æ‹ç…§ä¸Šä¼ ï¼ˆæ¶ˆè´¹å°ç¥¨ï¼‰',
    implementation: 'sealosStorage.uploadImage() - Sealosäº‘å­˜å‚¨',
    frontendIntegration: 'æ”¯æŒå›¾ç‰‡å‹ç¼©ã€è¿›åº¦æ˜¾ç¤ºã€ä¸Šä¼ é‡è¯•',
    requestFields: {
      image: 'file - å›¾ç‰‡æ–‡ä»¶',
      amount: 'number - ç”¨æˆ·è¾“å…¥çš„æ¶ˆè´¹é‡‘é¢',
      user_id: 'number - ç”¨æˆ·ID'
    },
    responseFields: {
      upload_id: 'string - ä¸Šä¼ ID',
      image_url: 'string - å›¾ç‰‡URL',
      status: 'string - å®¡æ ¸çŠ¶æ€ï¼ˆpendingï¼‰',
      estimated_points: 'number - é¢„ä¼°ç§¯åˆ†'
    }
  },
  getHistory: {
    method: 'GET',
    path: '/api/photo/history',
    description: 'ä¸Šä¼ å†å²è®°å½•',
    implementation: 'PhotoReview.findAndCountAll() - ç”¨æˆ·ä¸Šä¼ å†å²',
    frontendIntegration: 'æ”¯æŒçŠ¶æ€ç­›é€‰ã€åˆ†é¡µåŠ è½½',
    requestParams: {
      page: 'number - é¡µç ',
      limit: 'number - æ¯é¡µæ•°é‡',
      status: 'string - å®¡æ ¸çŠ¶æ€ï¼ˆpending/approved/rejectedï¼‰'
    },
    responseFields: {
      records: 'array - ä¸Šä¼ è®°å½•åˆ—è¡¨',
      total: 'number - æ€»è®°å½•æ•°',
      has_more: 'boolean - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®'
    },
    recordFieldMapping: {
      'upload_id/id': 'ä¸Šä¼ ID',
      'image_url/url': 'å›¾ç‰‡URL',
      'status/state': 'å®¡æ ¸çŠ¶æ€',
      'points_awarded/points': 'è·å¾—ç§¯åˆ†',
      'created_at/upload_time': 'ä¸Šä¼ æ—¶é—´'
    }
  },
  getReviewDetail: {
    method: 'GET',
    path: '/api/photo/review/:id',
    description: 'å®¡æ ¸è¯¦æƒ…',
    implementation: 'PhotoReview.findByPk() - å®¡æ ¸çŠ¶æ€å’Œç†ç”±',
    frontendIntegration: 'å®¡æ ¸è¯¦æƒ…é¡µé¢å±•ç¤º',
    requestParams: {
      id: 'number - ä¸Šä¼ è®°å½•ID'
    },
    responseFields: {
      review_detail: 'object - å®¡æ ¸è¯¦æƒ…',
      reviewer_comment: 'string - å®¡æ ¸å¤‡æ³¨',
      review_time: 'timestamp - å®¡æ ¸æ—¶é—´',
      final_amount: 'number - æœ€ç»ˆç¡®è®¤é‡‘é¢'
    }
  },
  getStatistics: {
    method: 'GET',
    path: '/api/photo/statistics',
    description: 'æ‹ç…§ç»Ÿè®¡',
    implementation: 'getPhotoStatistics() - ç”¨æˆ·æ‹ç…§ç»Ÿè®¡',
    frontendIntegration: 'ç”¨æˆ·ä¸­å¿ƒç»Ÿè®¡å±•ç¤º',
    responseFields: {
      total_uploads: 'number - æ€»ä¸Šä¼ æ¬¡æ•°',
      approved_count: 'number - å®¡æ ¸é€šè¿‡æ¬¡æ•°',
      total_points_earned: 'number - æ€»è·å¾—ç§¯åˆ†',
      approval_rate: 'number - å®¡æ ¸é€šè¿‡ç‡'
    }
  }
};
```

#### 1.2.5 ğŸ‘¥ ç”¨æˆ·ç®¡ç†æ¨¡å— (routes/user.js - 237è¡Œ)
```javascript
// å®é™…å®ç°çš„ç”¨æˆ·æ¥å£
const USER_APIS = {
  getUserInfo: {
    method: 'GET',
    path: '/api/user/info',
    description: 'è·å–ç”¨æˆ·ä¿¡æ¯',
    implementation: 'User.getSafeUserInfo() - è„±æ•ç”¨æˆ·ä¿¡æ¯',
    frontendIntegration: 'æ”¯æŒå¤šç§å­—æ®µæ˜ å°„ï¼Œè‡ªåŠ¨è„±æ•å¤„ç†',
    responseFields: {
      user_id: 'number - ç”¨æˆ·ID',
      nickname: 'string - ç”¨æˆ·æ˜µç§°',
      avatar: 'string - å¤´åƒURL',
      phone: 'string - æ‰‹æœºå·ï¼ˆè„±æ•ï¼‰',
      points: 'number - ç§¯åˆ†ä½™é¢',
      level: 'string - ç”¨æˆ·ç­‰çº§',
      join_date: 'date - åŠ å…¥æ—¶é—´'
    },
    fieldMapping: {
      'points/user_points/totalPoints': 'ç§¯åˆ†å­—æ®µ',
      'nickname/name/username': 'æ˜µç§°å­—æ®µ',
      'avatar/avatar_url/headImg': 'å¤´åƒå­—æ®µ'
    }
  },
  updateUserInfo: {
    method: 'PUT',
    path: '/api/user/info',
    description: 'æ›´æ–°ç”¨æˆ·ä¿¡æ¯',
    implementation: 'User.update() - æ˜µç§°ã€å¤´åƒæ›´æ–°',
    frontendIntegration: 'æ”¯æŒè¡¨å•éªŒè¯ã€å®æ—¶æ›´æ–°',
    requestFields: {
      nickname: 'string - ç”¨æˆ·æ˜µç§°ï¼ˆå¯é€‰ï¼‰',
      avatar: 'string - å¤´åƒURLï¼ˆå¯é€‰ï¼‰'
    },
    responseFields: {
      updated_fields: 'array - æ›´æ–°çš„å­—æ®µåˆ—è¡¨',
      user_info: 'object - æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯'
    }
  },
  uploadAvatar: {
    method: 'POST',
    path: '/api/user/avatar',
    description: 'å¤´åƒä¸Šä¼ ',
    implementation: 'sealosStorage.uploadAvatar() - å¤´åƒäº‘å­˜å‚¨',
    frontendIntegration: 'æ”¯æŒå¤´åƒè£å‰ªã€å°ºå¯¸éªŒè¯',
    requestFields: {
      avatar: 'file - å¤´åƒæ–‡ä»¶'
    },
    responseFields: {
      avatar_url: 'string - å¤´åƒURL',
      thumbnail_url: 'string - ç¼©ç•¥å›¾URL'
    }
  },
  getPointsRecords: {
    method: 'GET',
    path: '/api/user/points-records',
    description: 'ç§¯åˆ†è®°å½•ï¼ˆåˆ†é¡µï¼‰',
    implementation: 'PointsRecord.findAndCountAll() - ç§¯åˆ†å˜åŠ¨æ˜ç»†',
    frontendIntegration: 'æ”¯æŒåˆ†é¡µåŠ è½½ã€ç±»å‹ç­›é€‰',
    requestParams: {
      page: 'number - é¡µç ',
      limit: 'number - æ¯é¡µæ•°é‡',
      type: 'string - è®°å½•ç±»å‹ï¼ˆearn/consume/allï¼‰'
    },
    responseFields: {
      records: 'array - ç§¯åˆ†è®°å½•åˆ—è¡¨',
      total: 'number - æ€»è®°å½•æ•°',
      has_more: 'boolean - æ˜¯å¦æœ‰æ›´å¤šæ•°æ®'
    },
    recordFieldMapping: {
      'points/amount': 'ç§¯åˆ†æ•°é‡',
      'type/operation': 'æ“ä½œç±»å‹',
      'description/reason': 'å˜åŠ¨åŸå› ',
      'created_at/timestamp': 'è®°å½•æ—¶é—´'
    }
  }
};
```

#### 1.2.6 ğŸª å•†å®¶ç®¡ç†æ¨¡å— (routes/merchant.js - 545è¡Œ)
```javascript
// å®é™…å®ç°çš„å•†å®¶æ¥å£
const MERCHANT_APIS = {
  applyMerchant: {
    method: 'POST',
    path: '/api/merchant/apply',
    description: 'ç”³è¯·å•†å®¶æƒé™',
    implementation: 'processMerchantApplication() - å•†å®¶æƒé™ç”³è¯·',
    frontendIntegration: 'ç”³è¯·è¡¨å•æäº¤ã€çŠ¶æ€è·Ÿè¸ª',
    requestFields: {
      business_name: 'string - å•†å®¶åç§°',
      business_license: 'string - è¥ä¸šæ‰§ç…§',
      contact_info: 'object - è”ç³»ä¿¡æ¯'
    },
    responseFields: {
      application_id: 'string - ç”³è¯·ID',
      status: 'string - ç”³è¯·çŠ¶æ€',
      review_time: 'timestamp - é¢„è®¡å®¡æ ¸æ—¶é—´'
    }
  },
  getReviewList: {
    method: 'GET',
    path: '/api/merchant/reviews',
    description: 'å¾…å®¡æ ¸åˆ—è¡¨',
    implementation: 'getReviewList() - åˆ†é¡µè·å–å¾…å®¡æ ¸é¡¹',
    frontendIntegration: 'å®¡æ ¸å·¥ä½œå°åˆ—è¡¨å±•ç¤º',
    requestParams: {
      page: 'number - é¡µç ',
      limit: 'number - æ¯é¡µæ•°é‡',
      status: 'string - å®¡æ ¸çŠ¶æ€ç­›é€‰'
    },
    responseFields: {
      reviews: 'array - å¾…å®¡æ ¸åˆ—è¡¨',
      total: 'number - æ€»æ•°é‡',
      pending_count: 'number - å¾…å®¡æ ¸æ•°é‡'
    }
  },
  submitReview: {
    method: 'POST',
    path: '/api/merchant/review',
    description: 'æäº¤å®¡æ ¸ç»“æœ',
    implementation: 'submitReview() - å®¡æ ¸ç»“æœæäº¤',
    frontendIntegration: 'å®¡æ ¸æ“ä½œã€WebSocketæ¨é€',
    requestFields: {
      review_id: 'number - å®¡æ ¸é¡¹ID',
      action: 'string - å®¡æ ¸åŠ¨ä½œï¼ˆapprove/rejectï¼‰',
      final_amount: 'number - æœ€ç»ˆç¡®è®¤é‡‘é¢',
      comment: 'string - å®¡æ ¸å¤‡æ³¨'
    },
    responseFields: {
      review_result: 'object - å®¡æ ¸ç»“æœ',
      points_awarded: 'number - å¥–åŠ±ç§¯åˆ†',
      notification_sent: 'boolean - æ˜¯å¦å·²å‘é€é€šçŸ¥'
    }
  },
  batchReview: {
    method: 'POST',
    path: '/api/merchant/batch-review',
    description: 'æ‰¹é‡å®¡æ ¸',
    implementation: 'processBatchReview() - æ‰¹é‡å®¡æ ¸å¤„ç†',
    frontendIntegration: 'æ‰¹é‡æ“ä½œã€è¿›åº¦æ˜¾ç¤º',
    requestFields: {
      review_ids: 'array - å®¡æ ¸é¡¹IDåˆ—è¡¨',
      action: 'string - æ‰¹é‡åŠ¨ä½œ',
      batch_comment: 'string - æ‰¹é‡å¤‡æ³¨'
    },
    responseFields: {
      processed_count: 'number - å¤„ç†æ•°é‡',
      success_count: 'number - æˆåŠŸæ•°é‡',
      failed_items: 'array - å¤±è´¥é¡¹åˆ—è¡¨'
    }
  },
  getLotteryConfig: {
    method: 'GET',
    path: '/api/merchant/lottery-config',
    description: 'è·å–æŠ½å¥–é…ç½®',
    implementation: 'getLotteryConfig() - å•†å®¶æŠ½å¥–é…ç½®ç®¡ç†',
    frontendIntegration: 'æ¦‚ç‡è®¾ç½®é¡µé¢å±•ç¤º',
    responseFields: {
      prizes: 'array - å¥–å“é…ç½®åˆ—è¡¨',
      total_probability: 'number - æ€»æ¦‚ç‡',
      is_active: 'boolean - æ˜¯å¦å¯ç”¨'
    }
  },
  updateLotteryConfig: {
    method: 'PUT',
    path: '/api/merchant/lottery-config',
    description: 'æ›´æ–°æŠ½å¥–é…ç½®',
    implementation: 'updateLotteryConfig() - æŠ½å¥–é…ç½®æ›´æ–°',
    frontendIntegration: 'æ¦‚ç‡è®¾ç½®ã€å®æ—¶éªŒè¯',
    requestFields: {
      prizes: 'array - å¥–å“é…ç½®åˆ—è¡¨',
      is_active: 'boolean - æ˜¯å¦å¯ç”¨'
    },
    responseFields: {
      updated_config: 'object - æ›´æ–°åçš„é…ç½®',
      validation_result: 'object - éªŒè¯ç»“æœ'
    }
  }
};
```

### 1.3 ğŸ”„ WebSocketå®æ—¶é€šä¿¡ï¼ˆåŸºäºservices/websocket.jsåˆ†æï¼‰

**å®é™…å®ç°çš„WebSocketæœåŠ¡**ï¼š
```javascript
// WebSocketæœåŠ¡é…ç½® (services/websocket.js - 312è¡Œ)
const WEBSOCKET_CONFIG = {
  // è¿æ¥é…ç½®
  connection: {
    path: '/ws',                    // WebSocketè·¯å¾„
    port: 'HTTPæœåŠ¡å™¨ç«¯å£',         // ä¸HTTPæœåŠ¡å…±äº«ç«¯å£
    authentication: 'JWT Token',   // JWTè®¤è¯æœºåˆ¶
    heartbeat: 30000,              // å¿ƒè·³é—´éš”30ç§’
    maxConnections: 1000,          // æœ€å¤§è¿æ¥æ•°
    frontendIntegration: 'å¼€å‘ç¯å¢ƒé™é»˜æ¨¡å¼ï¼Œç”Ÿäº§ç¯å¢ƒå®Œæ•´é‡è¿æœºåˆ¶'
  },
  
  // å®é™…æ¨é€äº‹ä»¶
  events: {
    'connected': 'è¿æ¥æˆåŠŸ',
    'points_update': 'ç§¯åˆ†å˜åŠ¨æ¨é€',
    'stock_update': 'åº“å­˜å˜åŠ¨æ¨é€',
    'review_result': 'å®¡æ ¸ç»“æœæ¨é€',
    'system_notification': 'ç³»ç»Ÿé€šçŸ¥æ¨é€',
    'lottery_result': 'æŠ½å¥–ç»“æœæ¨é€',
    'exchange_status': 'å…‘æ¢çŠ¶æ€æ¨é€'
  },
  
  // å®é™…å®ç°çš„æ–¹æ³•
  methods: {
    'authenticate()': 'JWT TokenéªŒè¯',
    'sendToUser()': 'å‘é€æ¶ˆæ¯ç»™ç‰¹å®šç”¨æˆ·',
    'broadcastToAll()': 'å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰ç”¨æˆ·',
    'getConnectionStats()': 'è·å–è¿æ¥ç»Ÿè®¡',
    'cleanupTimeoutConnections()': 'æ¸…ç†è¶…æ—¶è¿æ¥'
  }
};
```

### 1.4 ğŸš¨ ç»Ÿä¸€é”™è¯¯å¤„ç†è§„èŒƒ - ç¡®ä¿åç«¯å…¼å®¹æ€§

**âœ… æ ‡å‡†é”™è¯¯å“åº”æ ¼å¼**ï¼š
```javascript
// ç»Ÿä¸€é”™è¯¯å“åº”ç»“æ„
{
  "code": 2001,                    // é”™è¯¯ç 
  "message": "è®¿é—®ä»¤ç‰Œä¸èƒ½ä¸ºç©º",      // é”™è¯¯æ¶ˆæ¯
  "data": null,                    // æ•°æ®ï¼ˆé”™è¯¯æ—¶é€šå¸¸ä¸ºnullï¼‰
  "details": {                     // é”™è¯¯è¯¦æƒ…ï¼ˆå¯é€‰ï¼‰
    "field": "authorization",
    "requirement": "Bearer Token required"
  },
  "timestamp": "2025-01-03T10:30:00Z",  // æ—¶é—´æˆ³
  "request_id": "req_123456789"    // è¯·æ±‚IDï¼ˆç”¨äºè°ƒè¯•ï¼‰
}
```

**ğŸ”§ æ ¸å¿ƒé”™è¯¯ç å®šä¹‰**ï¼š
```javascript
const ERROR_CODES = {
  // ğŸ”´ è®¤è¯ç›¸å…³é”™è¯¯ç 
  2001: {
    message: 'è®¿é—®ä»¤ç‰Œä¸èƒ½ä¸ºç©º',
    frontendAction: 'æ¸…é™¤Tokenï¼Œå¼•å¯¼é‡æ–°ç™»å½•',
    httpStatus: 401
  },
  2002: {
    message: 'Tokenå·²è¿‡æœŸ',
    frontendAction: 'å°è¯•Tokenåˆ·æ–°ï¼Œå¤±è´¥åˆ™é‡æ–°ç™»å½•',
    httpStatus: 401
  },
  2003: {
    message: 'æ— æ•ˆçš„Token',
    frontendAction: 'æ¸…é™¤Tokenï¼Œå¼•å¯¼é‡æ–°ç™»å½•',
    httpStatus: 401
  },
  
  // ğŸ”´ ä¸šåŠ¡ç›¸å…³é”™è¯¯ç 
  1001: {
    message: 'ç§¯åˆ†ä¸è¶³',
    frontendAction: 'æ˜¾ç¤ºç§¯åˆ†ä¸è¶³æç¤ºï¼Œå¼•å¯¼è·å–ç§¯åˆ†',
    httpStatus: 400
  },
  1002: {
    message: 'åº“å­˜ä¸è¶³',
    frontendAction: 'æ˜¾ç¤ºåº“å­˜ä¸è¶³æç¤ºï¼Œåˆ·æ–°å•†å“åˆ—è¡¨',
    httpStatus: 400
  },
  1003: {
    message: 'æ´»åŠ¨å·²æš‚åœ',
    frontendAction: 'æ˜¾ç¤ºæ´»åŠ¨æš‚åœæç¤ºï¼Œéšè—ç›¸å…³åŠŸèƒ½',
    httpStatus: 400
  },
  1004: {
    message: 'å‚æ•°éªŒè¯å¤±è´¥',
    frontendAction: 'æ˜¾ç¤ºå‚æ•°é”™è¯¯æç¤ºï¼Œæ£€æŸ¥è¾“å…¥æ•°æ®',
    httpStatus: 400
  },
  
  // ğŸ”´ æƒé™ç›¸å…³é”™è¯¯ç 
  3001: {
    message: 'æƒé™ä¸è¶³',
    frontendAction: 'æ˜¾ç¤ºæƒé™ä¸è¶³æç¤ºï¼Œå¼•å¯¼ç”³è¯·æƒé™',
    httpStatus: 403
  },
  3002: {
    message: 'éå•†å®¶ç”¨æˆ·',
    frontendAction: 'æ˜¾ç¤ºå•†å®¶æƒé™ç”³è¯·é¡µé¢',
    httpStatus: 403
  },
  
  // ğŸ”´ ç³»ç»Ÿç›¸å…³é”™è¯¯ç 
  5001: {
    message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
    frontendAction: 'æ˜¾ç¤ºç³»ç»Ÿé”™è¯¯æç¤ºï¼Œç¨åé‡è¯•',
    httpStatus: 500
  },
  5002: {
    message: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
    frontendAction: 'æ˜¾ç¤ºæœåŠ¡æš‚ä¸å¯ç”¨æç¤º',
    httpStatus: 503
  }
};
```

**ğŸ”§ å‰ç«¯é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š
```javascript
// å‰ç«¯ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
const handleAPIError = (error, context) => {
  const { code, message, details } = error;
  
  // ğŸ”´ è®¤è¯é”™è¯¯ä¸“é¡¹å¤„ç†
  if (code === 2001 || code === 2002 || code === 2003) {
    // æ¸…é™¤æ— æ•ˆToken
    wx.removeStorageSync('access_token');
    wx.removeStorageSync('refresh_token');
    
    // å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•
    wx.showModal({
      title: 'ç™»å½•å·²è¿‡æœŸ',
      content: 'è¯·é‡æ–°ç™»å½•ä»¥ç»§ç»­ä½¿ç”¨',
      showCancel: false,
      success: () => {
        wx.redirectTo({
          url: '/pages/auth/auth'
        });
      }
    });
    return;
  }
  
  // ğŸ”´ ç§¯åˆ†ä¸è¶³é”™è¯¯å¤„ç†
  if (code === 1001) {
    wx.showModal({
      title: 'ç§¯åˆ†ä¸è¶³',
      content: 'æ‚¨çš„ç§¯åˆ†ä¸è¶³ï¼Œå»ä¸Šä¼ ç…§ç‰‡è·å–ç§¯åˆ†ï¼Ÿ',
      confirmText: 'å»ä¸Šä¼ ',
      success: (res) => {
        if (res.confirm) {
          wx.navigateTo({
            url: '/pages/camera/camera'
          });
        }
      }
    });
    return;
  }
  
  // ğŸ”´ åº“å­˜ä¸è¶³é”™è¯¯å¤„ç†
  if (code === 1002) {
    wx.showToast({
      title: 'å•†å“åº“å­˜ä¸è¶³',
      icon: 'none'
    });
    // åˆ·æ–°å•†å“åˆ—è¡¨
    if (context && context.refreshProductList) {
      context.refreshProductList();
    }
    return;
  }
  
  // ğŸ”´ æƒé™ä¸è¶³é”™è¯¯å¤„ç†
  if (code === 3001 || code === 3002) {
    wx.showModal({
      title: 'æƒé™ä¸è¶³',
      content: 'æ‚¨æš‚æ— æ­¤åŠŸèƒ½æƒé™ï¼Œéœ€è¦ç”³è¯·å•†å®¶æƒé™å—ï¼Ÿ',
      confirmText: 'ç”³è¯·æƒé™',
      success: (res) => {
        if (res.confirm) {
          wx.navigateTo({
            url: '/pages/merchant/apply'
          });
        }
      }
    });
    return;
  }
  
  // ğŸ”´ ç³»ç»Ÿé”™è¯¯é€šç”¨å¤„ç†
  if (code >= 5000) {
    wx.showToast({
      title: 'ç³»ç»Ÿæš‚æ—¶ä¸å¯ç”¨',
      icon: 'none'
    });
    return;
  }
  
  // ğŸ”´ å…¶ä»–é”™è¯¯é€šç”¨å¤„ç†
  wx.showToast({
    title: message || 'æ“ä½œå¤±è´¥',
    icon: 'none'
  });
};
```

---

## ğŸ”Œ äºŒã€æ ¸å¿ƒAPIæ¥å£è¯¦ç»†è§„èŒƒ

### 2.1 ğŸ” è®¤è¯æˆæƒæ¥å£ (routes/auth.js)

#### 2.1.1 ç”¨æˆ·ç™»å½•æ¥å£
```http
POST /api/auth/login
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "mobile": "13800000000",     // å¿…éœ€ï¼š11ä½æ‰‹æœºå·
  "verification_code": "123456" // å¿…éœ€ï¼š6ä½éªŒè¯ç ï¼ˆå¼€å‘é˜¶æ®µå¯è·³è¿‡ï¼‰
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200,
    "user_info": {
      "user_id": 11,
      "mobile": "138****0000",
      "nickname": "ç”¨æˆ·2136",
      "total_points": 1000,
      "is_merchant": false,
      "status": "active",
      "avatar": null,
      "last_login": "2025-07-03T16:15:00.000Z",
      "created_at": "2025-07-03T00:04:00.000Z"
    }
  }
}
```

#### 2.1.2 ç®¡ç†å‘˜ç™»å½•æ¥å£
```http
POST /api/auth/admin-login
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "username": "admin",         // å¿…éœ€ï¼šç®¡ç†å‘˜è´¦å·
  "password": "admin123456",   // å¿…éœ€ï¼šç®¡ç†å‘˜å¯†ç 
  "verification_code": "123456" // å¯é€‰ï¼šçŸ­ä¿¡äºŒæ¬¡éªŒè¯ï¼ˆå¼€å‘é˜¶æ®µè·³è¿‡ï¼‰
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "ç®¡ç†å‘˜ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200,
    "admin_info": {
      "admin_id": 1,
      "username": "admin",
      "role": "super_admin",
      "permissions": ["user_management", "lottery_config", "system_settings"]
    }
  }
}
```

#### 2.1.3 Tokenåˆ·æ–°æ¥å£
```http
POST /api/auth/refresh
Content-Type: application/json
Authorization: Bearer <refresh_token>
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "Tokenåˆ·æ–°æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 7200
  }
}
```

### 2.2 ğŸ° æŠ½å¥–ç³»ç»Ÿæ¥å£ (routes/lottery.js)

#### 2.2.1 è·å–æŠ½å¥–é…ç½®æ¥å£
```http
GET /api/lottery/config
Authorization: Bearer <access_token>
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "prizes": [
      {
        "id": 1,
        "name": "å…«å…«æŠ˜åˆ¸",
        "type": "coupon",
        "value": "88.00",
        "angle": 0,
        "color": "#E74C3C",
        "probability": "0.0000",
        "isActivity": true,
        "costPoints": 100
      },
      {
        "id": 2,
        "name": "ä¹å…«æŠ˜åˆ¸",
        "type": "coupon",
        "value": "98.00",
        "angle": 45,
        "color": "#27AE60",
        "probability": "0.1000",
        "isActivity": true,
        "costPoints": 100
      }
    ],
    "costPerDraw": 100,
    "totalPrizes": 8,
    "pitySystem": {
      "enabled": true,
      "pityLimit": 10,
      "pityPrizeName": "ä¹å…«æŠ˜åˆ¸"
    },
    "user_pity": {
      "current_count": 3,
      "remaining_draws": 7,
      "pity_limit": 10
    }
  }
}
```

#### 2.2.2 æ‰§è¡ŒæŠ½å¥–æ¥å£
```http
POST /api/lottery/draw
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "draw_type": "single"  // å¯é€‰ï¼šsingle(å•æŠ½), triple(3è¿æŠ½), quintuple(5è¿æŠ½), decade(10è¿æŠ½)
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "draw_type": "single",
    "results": [
      {
        "prize": "ä¹å…«æŠ˜åˆ¸",
        "pity": {
          "triggered": false,
          "remaining": 9
        },
        "reward": {
          "type": "coupon",
          "value": "98.00"
        },
        "draw_sequence": 1
      }
    ],
    "total_cost": 100,
    "user_points": 900,
    "remaining_points": 900,
    "balance": 900,
    "points": 900,
    "today_count": 5,
    "user_info": {
      "remaining_points": 900,
      "today_count": 5,
      "pity_info": {
        "current_count": 4,
        "remaining_draws": 6
      }
    }
  }
}
```

#### 2.2.3 æŠ½å¥–è®°å½•æŸ¥è¯¢æ¥å£
```http
GET /api/lottery/records?page=1&limit=20&draw_type=single&prize_type=coupon
Authorization: Bearer <access_token>
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰
- `draw_type`: æŠ½å¥–ç±»å‹ç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `prize_type`: å¥–å“ç±»å‹ç­›é€‰ï¼ˆå¯é€‰ï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "id": 123,
        "draw_id": "draw_20250703_001",
        "prize_name": "ä¹å…«æŠ˜åˆ¸",
        "prize_type": "coupon",
        "prize_value": "98.00",
        "draw_type": "single",
        "points_cost": 100,
        "is_near_miss": false,
        "created_at": "2025-07-03T16:15:00.000Z"
      }
    ],
    "pagination": {
      "total": 150,
      "page": 1,
      "limit": 20,
      "total_pages": 8
    }
  }
}
```

### 2.3 ğŸ›ï¸ ç§¯åˆ†å…‘æ¢æ¥å£ (routes/exchange.js)

#### 2.3.1 å•†å“åˆ—è¡¨æ¥å£
```http
GET /api/exchange/products?page=1&limit=20&category=food&sort=hot
Authorization: Bearer <access_token>
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `category`: å•†å“åˆ†ç±»ï¼ˆå¯é€‰ï¼‰
- `sort`: æ’åºæ–¹å¼ï¼ˆhot:çƒ­é—¨, price:ä»·æ ¼, stock:åº“å­˜ï¼‰
- `search`: æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "products": [
      {
        "id": 1,
        "name": "ç¾é£Ÿåˆ¸50å…ƒ",
        "description": "é€‚ç”¨äºåº—å†…æ‰€æœ‰èœå“",
        "category": "voucher",
        "points_required": 500,
        "stock": 100,
        "original_price": "50.00",
        "image_url": "https://sealos.storage/products/voucher50.jpg",
        "is_hot": true,
        "exchange_count": 156,
        "status": "active",
        "created_at": "2025-07-03T00:00:00.000Z"
      }
    ],
    "pagination": {
      "total": 25,
      "page": 1,
      "limit": 20,
      "total_pages": 2
    },
    "categories": ["voucher", "food", "drink", "gift"]
  }
}
```

#### 2.3.2 æäº¤å…‘æ¢è®¢å•æ¥å£
```http
POST /api/exchange/submit
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "product_id": 1,        // å¿…éœ€ï¼šå•†å“ID
  "quantity": 1,          // å¿…éœ€ï¼šå…‘æ¢æ•°é‡
  "user_address": {       // å¯é€‰ï¼šæ”¶è´§åœ°å€ï¼ˆå®ç‰©å•†å“éœ€è¦ï¼‰
    "name": "å¼ ä¸‰",
    "phone": "13800000000",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒºxxx"
  },
  "remark": "å¤‡æ³¨ä¿¡æ¯"    // å¯é€‰ï¼šå¤‡æ³¨
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "å…‘æ¢æˆåŠŸ",
  "data": {
    "order_id": "EX20250703001",
    "product_name": "ç¾é£Ÿåˆ¸50å…ƒ",
    "points_cost": 500,
    "quantity": 1,
    "total_points": 500,
    "remaining_points": 400,
    "exchange_code": "EX123456789",
    "order_status": "completed",
    "delivery_info": {
      "type": "virtual",  // virtual:è™šæ‹Ÿå•†å“, physical:å®ç‰©å•†å“
      "estimated_date": null
    },
    "created_at": "2025-07-03T16:20:00.000Z"
  }
}
```

### 2.4 ğŸ“¸ æ‹ç…§ä¸Šä¼ æ¥å£ (routes/photo.js)

#### 2.4.1 æ‹ç…§ä¸Šä¼ æ¥å£
```http
POST /api/photo/upload
Content-Type: multipart/form-data
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```javascript
// FormDataæ ¼å¼
const formData = new FormData();
formData.append('photo', imageFile);          // å¿…éœ€ï¼šå›¾ç‰‡æ–‡ä»¶
formData.append('amount', '58.50');           // å¿…éœ€ï¼šæ¶ˆè´¹é‡‘é¢
formData.append('description', 'æ™šé¤æ¶ˆè´¹');   // å¯é€‰ï¼šæ¶ˆè´¹æè¿°
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "ä¸Šä¼ æˆåŠŸ",
  "data": {
    "upload_id": "UP20250703001",
    "image_url": "https://sealos.storage/uploads/photo_123456.jpg",
    "amount": 58.50,
    "expected_points": 585,
    "status": "pending",
    "review_status": "å¾…å®¡æ ¸",
    "upload_time": "2025-07-03T16:25:00.000Z",
    "estimated_review_time": "2025-07-04T16:25:00.000Z"
  }
}
```

#### 2.4.2 ä¸Šä¼ å†å²æ¥å£
```http
GET /api/photo/history?limit=10&status=all
Authorization: Bearer <access_token>
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `limit`: è¿”å›æ•°é‡ï¼ˆé»˜è®¤10ï¼Œæœ€å¤§50ï¼‰
- `status`: çŠ¶æ€ç­›é€‰ï¼ˆall:å…¨éƒ¨, approved:å·²é€šè¿‡, pending:å¾…å®¡æ ¸, rejected:å·²æ‹’ç»ï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "image_url": "https://sealos.storage/uploads/photo_123456.jpg",
        "amount": 58.50,
        "points": 585,
        "status": "approved",
        "review_reason": "å®¡æ ¸é€šè¿‡",
        "upload_time": "2025-07-03T14:30:00.000Z",
        "review_time": "2025-07-03T15:30:00.000Z"
      }
    ],
    "total": 15,
    "summary": {
      "total_uploads": 15,
      "approved_count": 12,
      "pending_count": 2,
      "rejected_count": 1,
      "total_points_earned": 7250
    }
  }
}
```

### 2.5 ğŸ‘¥ ç”¨æˆ·ç®¡ç†æ¥å£ (routes/user.js)

#### 2.5.1 è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£
```http
GET /api/user/info
Authorization: Bearer <access_token>
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "user_id": 11,
    "mobile": "138****0000",
    "nickname": "ç”¨æˆ·2136",
    "total_points": 1000,
    "is_merchant": false,
    "status": "active",
    "avatar": "https://sealos.storage/avatars/user11.jpg",
    "last_login": "2025-07-03T16:15:00.000Z",
    "created_at": "2025-07-03T00:04:00.000Z",
    "statistics": {
      "total_lottery_count": 25,
      "total_exchange_count": 8,
      "total_upload_count": 12,
      "total_points_earned": 12500,
      "total_points_spent": 11500
    }
  }
}
```

#### 2.5.2 æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ¥å£
```http
PUT /api/user/info
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "nickname": "æ–°æ˜µç§°",     // å¯é€‰ï¼šç”¨æˆ·æ˜µç§°
  "avatar": "å¤´åƒURL"      // å¯é€‰ï¼šå¤´åƒåœ°å€
}
```

#### 2.5.3 å¤´åƒä¸Šä¼ æ¥å£
```http
POST /api/user/avatar
Content-Type: multipart/form-data
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```javascript
// FormDataæ ¼å¼
const formData = new FormData();
formData.append('avatar', imageFile);  // å¿…éœ€ï¼šå¤´åƒæ–‡ä»¶
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "å¤´åƒä¸Šä¼ æˆåŠŸ",
  "data": {
    "avatarUrl": "https://sealos.storage/avatars/user11_20250703.jpg"
  }
}
```

#### 2.5.4 ç§¯åˆ†è®°å½•æ¥å£
```http
GET /api/user/points-records?page=1&pageSize=20&type=all
Authorization: Bearer <access_token>
```

**æŸ¥è¯¢å‚æ•°**ï¼š
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `pageSize`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰
- `type`: ç±»å‹ç­›é€‰ï¼ˆall:å…¨éƒ¨, earn:æ”¶å…¥, consume:æ”¯å‡ºï¼‰

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "id": 1,
        "points": 100,
        "description": "æŠ½å¥–æ¶ˆè´¹ - ä¹å…«æŠ˜åˆ¸",
        "type": "spend",
        "source": "lottery",
        "balance_after": 900,
        "created_at": "2025-07-03T14:30:00.000Z"
      },
      {
        "id": 2,
        "points": 585,
        "description": "æ‹ç…§å®¡æ ¸é€šè¿‡",
        "type": "earn",
        "source": "photo_review",
        "balance_after": 1485,
        "created_at": "2025-07-03T13:30:00.000Z"
      }
    ],
    "total": 150,
    "page": 1,
    "pageSize": 20,
    "summary": {
      "total_earned": 7250,
      "total_spent": 2500,
      "current_balance": 4750
    }
  }
}
```

### 2.6 ğŸª å•†å®¶ç®¡ç†æ¥å£ (routes/merchant.js)

#### 2.6.1 å¾…å®¡æ ¸åˆ—è¡¨æ¥å£
```http
GET /api/merchant/reviews/pending?page=1&limit=20
Authorization: Bearer <access_token>
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "reviews": [
      {
        "id": 1,
        "user_id": 11,
        "user_nickname": "ç”¨æˆ·2136",
        "image_url": "https://sealos.storage/uploads/photo_123456.jpg",
        "amount": 58.50,
        "expected_points": 585,
        "description": "æ™šé¤æ¶ˆè´¹",
        "upload_time": "2025-07-03T14:30:00.000Z",
        "waiting_time": "2å°æ—¶30åˆ†é’Ÿ"
      }
    ],
    "pagination": {
      "total": 25,
      "page": 1,
      "limit": 20,
      "total_pages": 2
    },
    "statistics": {
      "pending_count": 25,
      "today_reviewed": 15,
      "average_review_time": "1.5å°æ—¶"
    }
  }
}
```

#### 2.6.2 å®¡æ ¸é€šè¿‡æ¥å£
```http
POST /api/merchant/reviews/:id/approve
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "actual_amount": 58.50,      // å¿…éœ€ï¼šå®é™…æ¶ˆè´¹é‡‘é¢
  "points_awarded": 585,       // å¿…éœ€ï¼šå¥–åŠ±ç§¯åˆ†
  "review_reason": "å®¡æ ¸é€šè¿‡"  // å¯é€‰ï¼šå®¡æ ¸ç†ç”±
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "code": 0,
  "msg": "å®¡æ ¸é€šè¿‡",
  "data": {
    "review_id": 1,
    "points_awarded": 585,
    "user_new_balance": 1585,
    "review_time": "2025-07-03T16:30:00.000Z"
  }
}
```

#### 2.6.3 å®¡æ ¸æ‹’ç»æ¥å£
```http
POST /api/merchant/reviews/:id/reject
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "reject_reason": "å°ç¥¨ä¸æ¸…æ™°ï¼Œæ— æ³•ç¡®è®¤æ¶ˆè´¹é‡‘é¢"  // å¿…éœ€ï¼šæ‹’ç»ç†ç”±
}
```

#### 2.6.4 æ‰¹é‡å®¡æ ¸æ¥å£
```http
POST /api/merchant/reviews/batch
Content-Type: application/json
Authorization: Bearer <access_token>
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "reviews": [
    {
      "id": 1,
      "action": "approve",
      "actual_amount": 58.50,
      "points_awarded": 585,
      "review_reason": "å®¡æ ¸é€šè¿‡"
    },
    {
      "id": 2,
      "action": "reject",
      "reject_reason": "å°ç¥¨æ¨¡ç³Š"
    }
  ]
}
```

---

## ğŸ”„ ä¸‰ã€WebSocketå®æ—¶é€šä¿¡è§„èŒƒ

### 3.1 è¿æ¥å»ºç«‹
```javascript
// WebSocketè¿æ¥
const ws = new WebSocket('ws://localhost:3000/ws');

// è¿æ¥æ—¶éœ€è¦JWTè®¤è¯
ws.onopen = function() {
  ws.send(JSON.stringify({
    type: 'authenticate',
    token: 'Bearer ' + accessToken
  }));
};
```

### 3.2 å®æ—¶äº‹ä»¶ç±»å‹

#### 3.2.1 ç§¯åˆ†å˜åŠ¨æ¨é€
```json
{
  "type": "points_update",
  "data": {
    "user_id": 11,
    "points_change": 585,
    "new_balance": 1585,
    "reason": "æ‹ç…§å®¡æ ¸é€šè¿‡",
    "timestamp": "2025-07-03T16:30:00.000Z"
  }
}
```

#### 3.2.2 åº“å­˜å˜åŠ¨æ¨é€
```json
{
  "type": "stock_update",
  "data": {
    "product_id": 1,
    "product_name": "ç¾é£Ÿåˆ¸50å…ƒ",
    "new_stock": 99,
    "stock_change": -1,
    "timestamp": "2025-07-03T16:30:00.000Z"
  }
}
```

#### 3.2.3 å®¡æ ¸ç»“æœæ¨é€
```json
{
  "type": "review_result",
  "data": {
    "review_id": 1,
    "status": "approved",
    "points_awarded": 585,
    "review_reason": "å®¡æ ¸é€šè¿‡",
    "timestamp": "2025-07-03T16:30:00.000Z"
  }
}
```

#### 3.2.4 å¿ƒè·³ä¿æ´»
```json
{
  "type": "heartbeat",
  "timestamp": "2025-07-03T16:30:00.000Z"
}
```

---

## ğŸ“‹ å››ã€é”™è¯¯ä»£ç è§„èŒƒ

### 4.1 é€šç”¨é”™è¯¯ä»£ç 
- `0`: æˆåŠŸ
- `1001-1999`: å‚æ•°é”™è¯¯
- `2001-2999`: è®¤è¯é”™è¯¯
- `3001-3999`: ä¸šåŠ¡é€»è¾‘é”™è¯¯
- `4001-4999`: èµ„æºé”™è¯¯
- `5001-5999`: ç³»ç»Ÿé”™è¯¯

### 4.2 å…·ä½“é”™è¯¯ä»£ç 
```javascript
const ERROR_CODES = {
  // è®¤è¯ç›¸å…³
  2001: 'ç”¨æˆ·æœªç™»å½•',
  2002: 'Tokenå·²è¿‡æœŸ',
  2003: 'ç”¨æˆ·æƒé™ä¸è¶³',
  2004: 'éªŒè¯ç é”™è¯¯',
  
  // ä¸šåŠ¡é€»è¾‘ç›¸å…³
  3001: 'ç§¯åˆ†ä½™é¢ä¸è¶³',
  3002: 'å•†å“åº“å­˜ä¸è¶³',
  3003: 'ä»Šæ—¥æŠ½å¥–æ¬¡æ•°å·²è¾¾ä¸Šé™',
  3004: 'ä¸Šä¼ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ',
  
  // èµ„æºç›¸å…³
  4001: 'ç”¨æˆ·ä¸å­˜åœ¨',
  4002: 'å•†å“ä¸å­˜åœ¨',
  4003: 'è®¢å•ä¸å­˜åœ¨',
  4004: 'å®¡æ ¸è®°å½•ä¸å­˜åœ¨',
  
  // ç³»ç»Ÿç›¸å…³
  5001: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
  5002: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
  5003: 'ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸'
};
```

---

**æ›´æ–°å®Œæˆæ—¶é—´**ï¼š2025å¹´07æœˆ03æ—¥ 16:30  
**åŸºäºå®é™…ä»£ç ç‰ˆæœ¬**ï¼šå®Œå…¨åŸºäºroutes/ç›®å½•ä¸‹6ä¸ªè·¯ç”±æ–‡ä»¶çš„çœŸå®å®ç°