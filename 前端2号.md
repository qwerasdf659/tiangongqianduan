# é¤å…ç§¯åˆ†æŠ½å¥–ç³»ç»Ÿ - å‰ç«¯2å·å¼€å‘æ–‡æ¡£

> **ğŸš€ ä¸“ä¸šçº§å‰åç«¯å¯¹æ¥å®Œæ•´æŒ‡å—** - åŸºäºé¡¹ç›®ä»£ç æ·±åº¦åˆ†æçš„å®æˆ˜å¼€å‘æ–‡æ¡£

## ğŸ“– æ–‡æ¡£è¯´æ˜

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**åˆ›å»ºæ—¶é—´**ï¼š2024å¹´12æœˆ19æ—¥  
**é€‚ç”¨åœºæ™¯**ï¼šå‰åç«¯å¯¹æ¥å¼€å‘ã€æ•°æ®åº“è®¾è®¡ã€APIæ¥å£å®ç°  
**æŠ€æœ¯æ ˆ**ï¼šå¾®ä¿¡å°ç¨‹åº + Node.js + MySQL + WebSocket + Sealosäº‘å­˜å‚¨  
**æ¨¡å‹ç‰ˆæœ¬**ï¼šClaude Sonnet 4 âš¡

### ğŸ¯ æ–‡æ¡£ç‰¹è‰²
- âœ… **åŸºäºçœŸå®ä»£ç åˆ†æ**ï¼šæ‰€æœ‰ç¤ºä¾‹æ¥è‡ªé¡¹ç›®å®é™…ä»£ç 
- âœ… **å®Œæ•´å¯¹æ¥æ–¹æ¡ˆ**ï¼šæ¶µç›–8å¤§æ ¸å¿ƒæ¨¡å—å…¨é“¾è·¯å¯¹æ¥
- âœ… **æ•°æ®åº“å­—æ®µæ˜ å°„**ï¼šç²¾ç¡®çš„å‰åç«¯æ•°æ®ç»“æ„å¯¹åº”
- âœ… **å®æˆ˜æ€§å¼º**ï¼šæä¾›å¯ç›´æ¥ä½¿ç”¨çš„ä»£ç å’Œé…ç½®

---

## ğŸ›ï¸ ä¸€ã€é¡¹ç›®æ¶æ„ä¸æ ¸å¿ƒå¯¹æ¥ç‚¹

### 1.1 æ•´ä½“æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[å¾®ä¿¡å°ç¨‹åºå‰ç«¯] --> B[APIç½‘å…³]
    B --> C[ä¸šåŠ¡é€»è¾‘å±‚]
    C --> D[æ•°æ®è®¿é—®å±‚]
    D --> E[MySQLæ•°æ®åº“]
    
    A --> F[WebSocketæœåŠ¡]
    F --> C
    
    C --> G[Sealoså¯¹è±¡å­˜å‚¨]
    C --> H[Redisç¼“å­˜]
    
    subgraph "å‰ç«¯æ ¸å¿ƒæ¨¡å—"
        A1[æŠ½å¥–ç³»ç»Ÿ lottery.js]
        A2[å•†å“å…‘æ¢ exchange.js]
        A3[ç”¨æˆ·ä¸­å¿ƒ user.js]
        A4[å•†å®¶ç®¡ç† merchant.js]
        A5[å›¾ç‰‡ä¸Šä¼  camera.js]
    end
```

### 1.2 ğŸ”´ æ ¸å¿ƒæ–‡ä»¶å¯¹æ¥æ¶æ„

```javascript
// é¡¹ç›®æ ¸å¿ƒå¯¹æ¥æ–‡ä»¶ç»“æ„
tiangongqianduan/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ env.js                    // ğŸ”´ ç¯å¢ƒé…ç½®ä¸­å¿ƒ - åç«¯æœåŠ¡åœ°å€é…ç½®
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ api.js                    // ğŸ”´ APIæ¥å£å°è£… - æ‰€æœ‰åç«¯æ¥å£è°ƒç”¨
â”‚   â”œâ”€â”€ ws.js                     // ğŸ”´ WebSocketç®¡ç† - å®æ—¶é€šä¿¡
â”‚   â””â”€â”€ validate.js               // æ•°æ®éªŒè¯å·¥å…·
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ lottery/lottery.js        // ğŸ”´ æŠ½å¥–ä¸šåŠ¡é€»è¾‘ - æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ exchange/exchange.js      // ğŸ”´ å•†å“å…‘æ¢é€»è¾‘ - åº“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ user/user.js             // ğŸ”´ ç”¨æˆ·ä¸­å¿ƒé€»è¾‘ - ç§¯åˆ†ç®¡ç†
â”‚   â”œâ”€â”€ merchant/merchant.js     // ğŸ”´ å•†å®¶ç®¡ç†é€»è¾‘ - å®¡æ ¸æµç¨‹
â”‚   â””â”€â”€ camera/camera.js         // ğŸ”´ å›¾ç‰‡ä¸Šä¼ é€»è¾‘ - æ–‡ä»¶å¤„ç†
â””â”€â”€ app.js                       // ğŸ”´ å…¨å±€é…ç½® - è®¤è¯ä¸WebSocket
```

---

## âš™ï¸ äºŒã€ç¯å¢ƒé…ç½®ä¸éƒ¨ç½²å¯¹æ¥

### 2.1 ğŸ”´ å¤šç¯å¢ƒé…ç½®ç³»ç»Ÿ (config/env.js)

```javascript
// config/env.js - å…³é”®å¯¹æ¥é…ç½®
const ENV = {
  // ğŸŸ¢ å¼€å‘ç¯å¢ƒé…ç½®
  development: {
    baseUrl: 'http://localhost:3000/api',    // ğŸ”´ åç«¯APIåœ°å€
    wsUrl: 'ws://localhost:8080',            // ğŸ”´ WebSocketæœåŠ¡åœ°å€
    sealosConfig: {                          // ğŸ”´ å¯¹è±¡å­˜å‚¨é…ç½®
      endpoint: 'https://objectstorageapi.bja.sealos.run',
      bucket: 'tiangong',
      accessKeyId: 'br0za7uc',              // ğŸš¨ ç”Ÿäº§ç¯å¢ƒéœ€æ›¿æ¢
      secretAccessKey: 'skxg8mk5gqfhf9xz',  // ğŸš¨ ç”Ÿäº§ç¯å¢ƒéœ€æ›¿æ¢
      region: 'bja'
    },
    wechat: {                               // ğŸ”´ å¾®ä¿¡å°ç¨‹åºé…ç½®
      appId: 'wx0db69ddd264f9b81',
      appSecret: '414c5f5dc5404b4f7a1662dd26b532f9'
    },
    isDev: true,                            // ğŸ”´ å¼€å‘æ¨¡å¼æ ‡è®°
    needAuth: false                         // ğŸ”´ å¼€å‘ç¯å¢ƒè·³è¿‡è®¤è¯
  },
  
  // ğŸŸ¡ æµ‹è¯•ç¯å¢ƒé…ç½®
  testing: {
    baseUrl: 'https://rqchrlqndora.sealosbja.site/api',
    wsUrl: 'wss://rqchrlqndora.sealosbja.site/ws',
    isDev: false,
    needAuth: true                          // ğŸ”´ æµ‹è¯•ç¯å¢ƒéœ€è¦è®¤è¯
  },
  
  // ğŸ”´ ç”Ÿäº§ç¯å¢ƒé…ç½®
  production: {
    baseUrl: 'https://rqchrlqndora.sealosbja.site/api',
    wsUrl: 'wss://rqchrlqndora.sealosbja.site/ws',
    isDev: false,
    needAuth: true                          // ğŸ”´ ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶è®¤è¯
  }
}

// ğŸš¨ éƒ¨ç½²æ—¶å¿…é¡»ä¿®æ”¹æ­¤å¤„
let CURRENT_ENV = 'development'             // ğŸ”´ éƒ¨ç½²å…³é”®ç‚¹

module.exports = {
  getConfig: () => ENV[CURRENT_ENV],
  setEnv: (env) => CURRENT_ENV = env,
  getCurrentEnv: () => CURRENT_ENV
}
```

### 2.2 ğŸ”´ å…¨å±€é…ç½®åˆå§‹åŒ– (app.js)

```javascript
// app.js - æ ¸å¿ƒå¯¹æ¥é€»è¾‘
App({
  onLaunch() {
    this.initSystem()  // ğŸ”´ ç³»ç»Ÿåˆå§‹åŒ–å…¥å£
  },

  initSystem() {
    this.initGlobalData()      // åˆå§‹åŒ–å…¨å±€æ•°æ®
    this.initEnvironmentConfig() // ğŸ”´ ç¯å¢ƒé…ç½®åŠ è½½
    this.initWebSocket()       // ğŸ”´ WebSocketç®¡ç†å™¨åˆå§‹åŒ–
    this.checkLoginStatus()    // ğŸ”´ ç™»å½•çŠ¶æ€æ£€æŸ¥
  },

  // ğŸ”´ æ•°æ®åº“å­—æ®µæ˜ å°„é…ç½® - å…³é”®å¯¹æ¥ä¿¡æ¯
  globalData: {
    // ğŸ”´ åç«¯æ•°æ®åº“å­—æ®µæ˜ å°„è¡¨
    dbFieldMapping: {
      user: {                               // ğŸ”´ usersè¡¨å­—æ®µæ˜ å°„
        id: 'user_id',                     // å‰ç«¯ï¼šid -> åç«¯ï¼šuser_id
        mobile: 'mobile',                   // å‰ç«¯ï¼šmobile -> åç«¯ï¼šmobile
        points: 'total_points',            // ğŸ”´ ç§¯åˆ†å­—æ®µæ˜ å°„
        isMerchant: 'is_merchant',         // ğŸ”´ å•†å®¶æƒé™å­—æ®µ
        nickname: 'nickname',
        avatar: 'avatar',
        wxOpenid: 'wx_openid',
        status: 'status',
        createdAt: 'created_at'
      },
      lottery: {                            // ğŸ”´ lottery_prizesè¡¨å­—æ®µæ˜ å°„
        prizeId: 'prize_id',
        prizeName: 'prize_name',
        angle: 'angle',                     // ğŸ”´ Canvasè½¬ç›˜è§’åº¦å­—æ®µ
        color: 'color',                     // ğŸ”´ è½¬ç›˜æ‰‡å½¢é¢œè‰²å­—æ®µ
        probability: 'probability',         // ğŸ”´ ä¸­å¥–æ¦‚ç‡å­—æ®µ
        costPoints: 'cost_points'           // ğŸ”´ æŠ½å¥–æ¶ˆè€—ç§¯åˆ†
      },
      product: {                            // ğŸ”´ productsè¡¨å­—æ®µæ˜ å°„
        id: 'commodity_id',
        exchangePoints: 'exchange_points',  // ğŸ”´ å…‘æ¢ç§¯åˆ†å­—æ®µ
        stock: 'stock',                     // ğŸ”´ åº“å­˜å­—æ®µ - WebSocketåŒæ­¥
        category: 'category',               // ğŸ”´ å•†å“åˆ†ç±»å­—æ®µ
        isHot: 'is_hot'                    // ğŸ”´ çƒ­é—¨å•†å“æ ‡è®°
      },
      uploadReview: {                       // ğŸ”´ upload_reviewsè¡¨å­—æ®µæ˜ å°„
        uploadId: 'upload_id',              // ğŸ”´ ä¸Šä¼ è®°å½•å”¯ä¸€æ ‡è¯†
        reviewStatus: 'review_status',      // ğŸ”´ å®¡æ ¸çŠ¶æ€å­—æ®µ
        pointsAwarded: 'points_awarded'     // ğŸ”´ å¥–åŠ±ç§¯åˆ†å­—æ®µ
      }
    }
  },

  // ğŸ”´ WebSocketè¿æ¥å»ºç«‹
  connectWebSocket() {
    if (this.globalData.wsManager && this.globalData.accessToken) {
      // æ„å»ºç¬¦åˆåç«¯è§„èŒƒçš„WebSocket URL
      const wsUrl = `${this.globalData.wsUrl}?token=${this.globalData.accessToken}&client_type=miniprogram`
      this.globalData.wsManager.connect(wsUrl)
    }
  }
})
```

### 2.3 ğŸ”´ éƒ¨ç½²é…ç½®æ£€æŸ¥æ¸…å•

#### ğŸš¨ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¿…æ£€é¡¹
```bash
# 1. ç¯å¢ƒé…ç½®æ£€æŸ¥
âœ… config/env.js ä¸­ CURRENT_ENV = 'production'
âœ… baseUrl æŒ‡å‘ç”Ÿäº§æœåŠ¡å™¨åœ°å€
âœ… wsUrl ä½¿ç”¨ wss:// åè®®
âœ… Sealoså­˜å‚¨å¯†é’¥å·²æ›´æ–°
âœ… å¾®ä¿¡å°ç¨‹åº appId/appSecret å·²é…ç½®

# 2. åç«¯æœåŠ¡åœ°å€éªŒè¯
curl -X GET https://rqchrlqndora.sealosbja.site/api/health
# æœŸæœ›è¿”å›: {"status": "ok", "timestamp": "..."}

# 3. WebSocketæœåŠ¡éªŒè¯
wscat -c wss://rqchrlqndora.sealosbja.site/ws?token=test
# æœŸæœ›å»ºç«‹è¿æ¥æˆåŠŸ
```

---

## ğŸ”Œ ä¸‰ã€APIæ¥å£å®Œæ•´å¯¹æ¥æ–¹æ¡ˆ

### 3.1 ğŸ”´ æ™ºèƒ½APIè°ƒç”¨ç³»ç»Ÿ (utils/api.js)

```javascript
// utils/api.js - æ ¸å¿ƒå¯¹æ¥é€»è¾‘
const app = getApp()

/**
 * ğŸ”´ æ™ºèƒ½APIè°ƒç”¨æœºåˆ¶ - å¼€å‘/ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
 */
const shouldUseMock = () => {
  return app.globalData.isDev && !app.globalData.needAuth
}

/**
 * ğŸ”´ ç»Ÿä¸€ç½‘ç»œè¯·æ±‚å°è£… - æ”¯æŒè‡ªåŠ¨é‡è¯•å’ŒTokenåˆ·æ–°
 */
const request = (options) => {
  return new Promise((resolve, reject) => {
    const {
      url,
      method = 'GET',
      data = {},
      needAuth = true,          // ğŸ”´ æ˜¯å¦éœ€è¦è®¤è¯
      showLoading = true,       // ğŸ”´ æ˜¯å¦æ˜¾ç¤ºåŠ è½½æ¡†
      retryCount = 0,          // ğŸ”´ é‡è¯•è®¡æ•°
      maxRetry = 2             // ğŸ”´ æœ€å¤§é‡è¯•æ¬¡æ•°
    } = options

    // ğŸ”´ æ„å»ºè¯·æ±‚å¤´
    const header = {
      'Content-Type': 'application/json'
    }

    // ğŸ”´ è‡ªåŠ¨æ·»åŠ è®¤è¯å¤´
    if (needAuth && app.globalData.accessToken) {
      header['Authorization'] = `Bearer ${app.globalData.accessToken}`
    }

    const fullUrl = app.globalData.baseUrl + url

    wx.request({
      url: fullUrl,
      method,
      data,
      header,
      success(res) {
        console.log(`ğŸ“¡ APIè¯·æ±‚ ${method} ${url}:`, {
          request: data,
          response: res.data,
          status: res.statusCode
        })

        // ğŸ”´ ç»Ÿä¸€çŠ¶æ€ç å¤„ç†
        if (res.statusCode === 200) {
          if (res.data.code === 0) {
            resolve(res.data)
          } else if (res.data.code === 401) {
            // ğŸ”´ Tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°é€»è¾‘
            if (retryCount < maxRetry) {
              app.refreshToken().then(() => {
                const newOptions = { ...options, retryCount: retryCount + 1 }
                request(newOptions).then(resolve).catch(reject)
              }).catch(() => {
                app.logout()
                reject(res.data)
              })
            }
          } else {
            // ğŸ”´ ä¸šåŠ¡é”™è¯¯ç»Ÿä¸€å¤„ç†
            const errorMessage = res.data.msg || res.data.message || 'æ“ä½œå¤±è´¥'
            if (showLoading) {
              wx.showToast({
                title: errorMessage,
                icon: 'none',
                duration: 2000
              })
            }
            reject(res.data)
          }
        }
      },
      fail(err) {
        // ğŸ”´ ç½‘ç»œé”™è¯¯å¤„ç†
        console.error(`âŒ APIè¯·æ±‚å¤±è´¥ ${method} ${url}:`, err)
        if (showLoading) {
          wx.showToast({
            title: 'ç½‘ç»œè¯·æ±‚å¤±è´¥',
            icon: 'none'
          })
        }
        reject(err)
      }
    })
  })
}
```

### 3.2 ğŸ”´ æ ¸å¿ƒä¸šåŠ¡APIæ¥å£å®šä¹‰

#### è®¤è¯æ¨¡å—API (authAPI)
```javascript
const authAPI = {
  /**
   * ğŸ”´ å‘é€çŸ­ä¿¡éªŒè¯ç 
   * æ¥å£ï¼šPOST /api/auth/send-code
   * å‚æ•°ï¼š{ mobile: "13800138000" }
   * è¿”å›ï¼š{ code: 0, message: "éªŒè¯ç å‘é€æˆåŠŸ" }
   */
  sendCode(mobile) {
    return request({
      url: '/auth/send-code',
      method: 'POST',
      data: { mobile },
      needAuth: false
    })
  },

  /**
   * ğŸ”´ æ‰‹æœºç™»å½•æ³¨å†Œ
   * æ¥å£ï¼šPOST /api/auth/login
   * å‚æ•°ï¼š{ mobile: "13800138000", code: "123456" }
   * è¿”å›ï¼š{
   *   code: 0,
   *   data: {
   *     access_token: "eyJ...",     // ğŸ”´ è®¿é—®ä»¤ç‰Œ
   *     refresh_token: "eyJ...",    // ğŸ”´ åˆ·æ–°ä»¤ç‰Œ
   *     expires_in: 7200,           // ğŸ”´ ä»¤ç‰Œæœ‰æ•ˆæœŸ(ç§’)
   *     user_info: {                // ğŸ”´ ç”¨æˆ·ä¿¡æ¯
   *       user_id: 123,
   *       mobile: "13800138000",
   *       total_points: 1500,       // ğŸ”´ ç”¨æˆ·ç§¯åˆ†
   *       is_merchant: false        // ğŸ”´ å•†å®¶æƒé™
   *     }
   *   }
   * }
   */
  login(mobile, code) {
    return request({
      url: '/auth/login',
      method: 'POST',
      data: { mobile, code },
      needAuth: false
    })
  },

  /**
   * ğŸ”´ åˆ·æ–°è®¿é—®ä»¤ç‰Œ
   * æ¥å£ï¼šPOST /api/auth/refresh
   * è¯·æ±‚å¤´ï¼šAuthorization: Bearer {refresh_token}
   */
  refresh(refreshToken) {
    return request({
      url: '/auth/refresh',
      method: 'POST',
      data: { refresh_token: refreshToken },
      needAuth: false
    })
  }
}
```

#### æŠ½å¥–æ¨¡å—API (lotteryAPI)
```javascript
const lotteryAPI = {
  /**
   * ğŸ”´ è·å–æŠ½å¥–é…ç½®
   * æ¥å£ï¼šGET /api/lottery/config
   * è¿”å›ï¼š{
   *   code: 0,
   *   data: {
   *     prizes: [
   *       {
   *         prize_id: 1,
   *         prize_name: "å…«å…«æŠ˜åˆ¸",
   *         angle: 0,              // ğŸ”´ Canvasè½¬ç›˜è§’åº¦(0-315,æ­¥é•¿45)
   *         color: "#FF6B35",      // ğŸ”´ æ‰‡å½¢é¢œè‰²(åå…­è¿›åˆ¶)
   *         probability: 0.05,     // ğŸ”´ ä¸­å¥–æ¦‚ç‡(0-1)
   *         prize_type: "coupon",
   *         prize_value: 0.88
   *       }
   *     ],
   *     cost_points: 100,          // ğŸ”´ å•æ¬¡æŠ½å¥–æ¶ˆè€—ç§¯åˆ†
   *     daily_limit: 10            // ğŸ”´ æ¯æ—¥æŠ½å¥–æ¬¡æ•°é™åˆ¶
   *   }
   * }
   */
  getConfig() {
    return request({
      url: '/lottery/config',
      method: 'GET'
    })
  },

  /**
   * ğŸ”´ æ‰§è¡ŒæŠ½å¥–
   * æ¥å£ï¼šPOST /api/lottery/draw
   * å‚æ•°ï¼š{ draw_type: "single", count: 1 }
   * è¿”å›ï¼š{
   *   code: 0,
   *   data: {
   *     results: [
   *       {
   *         prize_id: 1,
   *         prize_name: "å…«å…«æŠ˜åˆ¸",
   *         angle: 42.5,           // ğŸ”´ æœ€ç»ˆåœæ­¢è§’åº¦
   *         is_near_miss: false    // ğŸ”´ æ˜¯å¦å·®ç‚¹ä¸­å¥–
   *       }
   *     ],
   *     remaining_points: 1400,    // ğŸ”´ å‰©ä½™ç§¯åˆ†
   *     today_draw_count: 3        // ğŸ”´ ä»Šæ—¥æŠ½å¥–æ¬¡æ•°
   *   }
   * }
   */
  draw(drawType = 'single', count = 1) {
    return request({
      url: '/lottery/draw',
      method: 'POST',
      data: { draw_type: drawType, count }
    })
  }
}
```

---

## ğŸ“Š å››ã€æ•°æ®åº“å­—æ®µç²¾ç¡®æ˜ å°„

### 4.1 ğŸ”´ ç”¨æˆ·è¡¨ (users) å­—æ®µæ˜ å°„

```sql
-- ğŸ”´ usersè¡¨ç»“æ„è®¾è®¡
CREATE TABLE users (
  user_id INT PRIMARY KEY AUTO_INCREMENT,      -- ğŸ”´ å‰ç«¯: userInfo.user_id
  mobile VARCHAR(11) UNIQUE NOT NULL,          -- ğŸ”´ å‰ç«¯: userInfo.mobile (è„±æ•æ˜¾ç¤º)
  total_points INT DEFAULT 0,                  -- ğŸ”´ å‰ç«¯: totalPoints (å®æ—¶åŒæ­¥)
  is_merchant BOOLEAN DEFAULT FALSE,           -- ğŸ”´ å‰ç«¯: userInfo.is_merchant
  nickname VARCHAR(50),                        -- ğŸ”´ å‰ç«¯: userInfo.nickname
  avatar VARCHAR(255),                         -- ğŸ”´ å‰ç«¯: userInfo.avatar
  wx_openid VARCHAR(100),                      -- å¾®ä¿¡OpenID
  last_login TIMESTAMP,                        -- æœ€åç™»å½•æ—¶é—´
  status ENUM('active', 'banned') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  INDEX idx_mobile (mobile),
  INDEX idx_openid (wx_openid),
  INDEX idx_points (total_points)
);
```

**ğŸ”´ å‰ç«¯å¯¹æ¥è¦ç‚¹ï¼š**
```javascript
// ç”¨æˆ·ä¿¡æ¯æ•°æ®ç»“æ„æ˜ å°„
const userMapping = {
  // å‰ç«¯å­—æ®µ -> æ•°æ®åº“å­—æ®µ
  'userInfo.user_id': 'users.user_id',
  'userInfo.mobile': 'users.mobile',           // æ˜¾ç¤ºæ—¶éœ€è„±æ•: 138****8000
  'totalPoints': 'users.total_points',         // WebSocketå®æ—¶åŒæ­¥
  'userInfo.is_merchant': 'users.is_merchant', // æ§åˆ¶é¡µé¢åŠŸèƒ½æ˜¾ç¤º
  'userInfo.nickname': 'users.nickname',
  'userInfo.avatar': 'users.avatar'
}
```

### 4.2 ğŸ”´ æŠ½å¥–å¥–å“è¡¨ (lottery_prizes) å­—æ®µæ˜ å°„

```sql
-- ğŸ”´ lottery_prizesè¡¨ç»“æ„è®¾è®¡
CREATE TABLE lottery_prizes (
  prize_id INT PRIMARY KEY AUTO_INCREMENT,
  prize_name VARCHAR(100) NOT NULL,            -- ğŸ”´ å‰ç«¯: prizes[].name
  prize_type ENUM('points', 'coupon', 'physical', 'empty'),
  prize_value DECIMAL(10,2),                   -- å¥–å“ä»·å€¼
  angle INT NOT NULL,                          -- ğŸ”´ å‰ç«¯: prizes[].angle (Canvasè§’åº¦)
  color VARCHAR(7) NOT NULL,                   -- ğŸ”´ å‰ç«¯: prizes[].color (åå…­è¿›åˆ¶è‰²å€¼)
  probability DECIMAL(6,4) NOT NULL,           -- ğŸ”´ å‰ç«¯: prizes[].probability (ä¸­å¥–æ¦‚ç‡)
  is_activity BOOLEAN DEFAULT FALSE,           -- ğŸ”´ å‰ç«¯: prizes[].is_activity (ç‰¹æ®Šæ•ˆæœ)
  cost_points INT DEFAULT 100,                 -- ğŸ”´ å‰ç«¯: costPoints (å•æ¬¡æ¶ˆè€—ç§¯åˆ†)
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  INDEX idx_status_probability (status, probability),
  INDEX idx_angle (angle)
);
```

**ğŸ”´ å‰ç«¯Canvasç»˜åˆ¶å…³é”®æ˜ å°„ï¼š**
```javascript
// æŠ½å¥–è½¬ç›˜æ•°æ®æ˜ å°„ - å…³é”®å¯¹æ¥ä¿¡æ¯
const lotteryMapping = {
  'prizes[].id': 'lottery_prizes.prize_id',
  'prizes[].name': 'lottery_prizes.prize_name',
  'prizes[].angle': 'lottery_prizes.angle',         // ğŸ”´ Canvasç»˜åˆ¶å¿…éœ€(0-315,æ­¥é•¿45)
  'prizes[].color': 'lottery_prizes.color',         // ğŸ”´ æ‰‡å½¢é¢œè‰²(#FF6B35æ ¼å¼)
  'prizes[].probability': 'lottery_prizes.probability', // ğŸ”´ æŠ½å¥–ç®—æ³•æ¦‚ç‡
  'costPoints': 'lottery_prizes.cost_points'        // ğŸ”´ ç§¯åˆ†æ‰£é™¤é‡‘é¢
}

// ğŸ”´ Canvasè½¬ç›˜è§’åº¦æ ‡å‡†é…ç½®
const ANGLE_CONFIG = {
  totalSlices: 8,           // è½¬ç›˜åˆ†å‰²æ•°é‡
  anglePerSlice: 45,        // æ¯ä¸ªæ‰‡å½¢è§’åº¦ (360/8)
  validAngles: [0, 45, 90, 135, 180, 225, 270, 315] // æœ‰æ•ˆè§’åº¦å€¼
}
```

---

## ğŸ“ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£ä¸º**å‰ç«¯2å·**ç¬¬ä¸€éƒ¨åˆ†ï¼Œåç»­å°†ç»§ç»­åˆ›å»ºï¼š
- ç¬¬äºŒéƒ¨åˆ†ï¼šWebSocketå®æ—¶é€šä¿¡ä¸æ ¸å¿ƒä¸šåŠ¡æ¨¡å—
- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå•†å“å…‘æ¢ä¸å›¾ç‰‡ä¸Šä¼ å¯¹æ¥
- ç¬¬å››éƒ¨åˆ†ï¼šå•†å®¶ç®¡ç†ä¸æƒé™ç³»ç»Ÿ
- ç¬¬äº”éƒ¨åˆ†ï¼šéƒ¨ç½²ä¸ç›‘æ§æ–¹æ¡ˆ

**ğŸ’¡ ä½¿ç”¨è¯´æ˜**ï¼š
1. ğŸ”´ æ ‡è®°ä¸ºå…³é”®å¯¹æ¥ç‚¹ï¼Œå¿…é¡»é‡ç‚¹å…³æ³¨
2. ğŸš¨ æ ‡è®°ä¸ºéƒ¨ç½²å…³é”®é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
3. ğŸ“¡ æ ‡è®°ä¸ºAPIæ¥å£è°ƒç”¨ç‚¹
4. ğŸ”Œ æ ‡è®°ä¸ºWebSocketé€šä¿¡ç‚¹

---

## ğŸŒ äº”ã€WebSocketå®æ—¶é€šä¿¡ç³»ç»Ÿå®Œæ•´å¯¹æ¥

### 5.1 ğŸ”´ WebSocketç®¡ç†å™¨æ ¸å¿ƒå®ç° (utils/ws.js)

```javascript
// utils/ws.js - WebSocketç®¡ç†å™¨å®Œæ•´å®ç°
class WSManager {
  constructor() {
    this.ws = null
    this.isConnected = false
    this.reconnectCount = 0
    this.maxReconnectCount = 5
    this.reconnectInterval = 3000
    this.eventHandlers = new Map()       // ğŸ”´ äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
    this.heartbeatTimer = null
    this.heartbeatInterval = 30000       // ğŸ”´ 30ç§’å¿ƒè·³é—´éš”
    this.messageQueue = []               // ğŸ”´ ç¦»çº¿æ¶ˆæ¯é˜Ÿåˆ—
    this.connectionUrl = null
  }

  /**
   * ğŸ”´ æ¶ˆæ¯å¤„ç†ä¸­å¿ƒ - æ ¹æ®åç«¯æ¨é€æ ¼å¼å®ç°
   */
  handleMessage(data) {
    const { type, data: payload, timestamp } = data
    
    console.log(`ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ [${type}]:`, payload)
    
    switch (type) {
      case 'points_update':
        this.handlePointsUpdate(payload)
        break
      case 'stock_update':
        this.handleStockUpdate(payload)
        break
      case 'review_result':
        this.handleReviewResult(payload)
        break
      case 'pong':
        console.log('ğŸ’“ å¿ƒè·³å“åº”')
        break
      default:
        console.warn('âš ï¸ æœªçŸ¥æ¶ˆæ¯ç±»å‹:', type)
    }
    
    // è§¦å‘é€šç”¨äº‹ä»¶ç›‘å¬å™¨
    this.emit(type, { data: payload, timestamp })
  }

  /**
   * ğŸ”´ ç§¯åˆ†æ›´æ–°æ¨é€å¤„ç†
   * åç«¯æ¨é€æ ¼å¼ï¼š{
   *   type: "points_update",
   *   data: {
   *     user_id: 123,
   *     total_points: 1400,
   *     change_points: -100,
   *     reason: "lottery_draw"
   *   }
   * }
   */
  handlePointsUpdate(payload) {
    const { user_id, total_points, change_points, reason } = payload
    
    // ğŸ”´ æ›´æ–°å…¨å±€ç”¨æˆ·ç§¯åˆ†
    const app = getApp()
    if (app.globalData.userInfo && app.globalData.userInfo.user_id === user_id) {
      app.globalData.userInfo.total_points = total_points
      
      // æ˜¾ç¤ºç§¯åˆ†å˜åŠ¨æç¤º
      const changeText = change_points > 0 ? `+${change_points}` : `${change_points}`
      const reasonText = this.getReasonText(reason)
      
      wx.showToast({
        title: `${changeText}ç§¯åˆ† (${reasonText})`,
        icon: 'none',
        duration: 3000
      })
    }
  }

  /**
   * ğŸ”´ åº“å­˜æ›´æ–°æ¨é€å¤„ç†
   * åç«¯æ¨é€æ ¼å¼ï¼š{
   *   type: "stock_update", 
   *   data: {
   *     product_id: 1,
   *     stock: 99,
   *     product_name: "å•†å“åç§°"
   *   }
   * }
   */
  handleStockUpdate(payload) {
    const { product_id, stock, product_name } = payload
    
    // ğŸ”´ åº“å­˜é¢„è­¦æç¤º
    if (stock <= 5 && stock > 0) {
      wx.showToast({
        title: `${product_name} åº“å­˜ä¸è¶³`,
        icon: 'none'
      })
    } else if (stock === 0) {
      wx.showToast({
        title: `${product_name} å·²å”®ç½„`,
        icon: 'none'
      })
    }
    
    // è§¦å‘åº“å­˜æ›´æ–°äº‹ä»¶
    this.emit('stock_update', { data: payload })
  }

  /**
   * ğŸ”´ å®¡æ ¸ç»“æœæ¨é€å¤„ç†
   * åç«¯æ¨é€æ ¼å¼ï¼š{
   *   type: "review_result",
   *   data: {
   *     upload_id: "UP123456789",
   *     status: "approved",
   *     points_awarded: 585,
   *     review_reason: "å®¡æ ¸é€šè¿‡"
   *   }
   * }
   */
  handleReviewResult(payload) {
    const { upload_id, status, points_awarded, review_reason } = payload
    
    // æ˜¾ç¤ºå®¡æ ¸ç»“æœé€šçŸ¥
    const statusText = status === 'approved' ? 'å®¡æ ¸é€šè¿‡' : 'å®¡æ ¸æœªé€šè¿‡'
    const pointsText = points_awarded > 0 ? `ï¼Œè·å¾—${points_awarded}ç§¯åˆ†` : ''
    
    wx.showModal({
      title: 'å®¡æ ¸ç»“æœé€šçŸ¥',
      content: `æ‚¨çš„ä¸Šä¼ ${statusText}${pointsText}ã€‚\nåŸå› ï¼š${review_reason}`,
      showCancel: false,
      confirmText: 'çŸ¥é“äº†'
    })
  }
}
```

---

## ğŸ›ï¸ å…­ã€å•†å“å…‘æ¢ç³»ç»Ÿå®Œæ•´å¯¹æ¥

### 6.1 ğŸ”´ æ ¸å¿ƒå¯¹æ¥æ¥å£

```javascript
// å•†å“åˆ—è¡¨æ¥å£ï¼šGET /api/exchange/products
// è¿”å›æ ¼å¼ï¼š
{
  code: 0,
  data: {
    products: [
      {
        commodity_id: 1,           // ğŸ”´ å•†å“ID
        name: "æ˜Ÿå·´å…‹åˆ¸",          // ğŸ”´ å•†å“åç§°
        exchange_points: 300,      // ğŸ”´ å…‘æ¢ç§¯åˆ†
        stock: 99,                 // ğŸ”´ åº“å­˜ - WebSocketåŒæ­¥
        category: "ä¼˜æƒ åˆ¸",        // ğŸ”´ åˆ†ç±»
        is_hot: true              // ğŸ”´ çƒ­é—¨æ ‡è®°
      }
    ]
  }
}

// å•†å“å…‘æ¢æ¥å£ï¼šPOST /api/exchange/redeem
// è¯·æ±‚å‚æ•°ï¼š{ product_id: 1, quantity: 1 }
// è¿”å›æ ¼å¼ï¼š
{
  code: 0,
  data: {
    exchange_id: "EX123456789",  // ğŸ”´ å…‘æ¢è®°å½•ID
    remaining_points: 1200,      // ğŸ”´ å‰©ä½™ç§¯åˆ†
    exchange_code: "GIFT2024"    // ğŸ”´ å…‘æ¢ç 
  }
}
```

### 6.2 ğŸ”´ WebSocketåº“å­˜åŒæ­¥

```javascript
// pages/exchange/exchange.js
Page({
  connectWebSocket() {
    const wsManager = app.globalData.wsManager
    
    // ğŸ”´ ç›‘å¬åº“å­˜æ›´æ–°
    wsManager.on('stock_update', (data) => {
      const { product_id, stock } = data.data
      this.updateProductStock(product_id, stock)
    })
  },

  updateProductStock(productId, newStock) {
    const products = this.data.products
    const index = products.findIndex(p => p.commodity_id === productId)
    
    if (index !== -1) {
      products[index].stock = newStock
      this.setData({ products })
    }
  }
})
```

---

## ğŸ“¸ ä¸ƒã€å›¾ç‰‡ä¸Šä¼ ç³»ç»Ÿå¯¹æ¥

### 7.1 ğŸ”´ æ ¸å¿ƒå¯¹æ¥æ¥å£

```javascript
// å›¾ç‰‡ä¸Šä¼ æ¥å£ï¼šPOST /api/photo/upload (multipart/form-data)
// è¿”å›æ ¼å¼ï¼š
{
  code: 0,
  data: {
    upload_id: "UP123456789",      // ğŸ”´ ä¸Šä¼ ID
    image_url: "Sealoså­˜å‚¨URL",    // ğŸ”´ å›¾ç‰‡åœ°å€
    estimated_amount: 58.50,       // ğŸ”´ AIè¯†åˆ«é‡‘é¢
    review_status: "pending"       // ğŸ”´ å®¡æ ¸çŠ¶æ€
  }
}

// ä¸Šä¼ è®°å½•æ¥å£ï¼šGET /api/photo/records
// è¿”å›æ ¼å¼ï¼š
{
  code: 0,
  data: {
    records: [
      {
        upload_id: "UP123456789",
        amount: 58.50,             // ğŸ”´ æ¶ˆè´¹é‡‘é¢
        points_awarded: 585,       // ğŸ”´ è·å¾—ç§¯åˆ†
        review_status: "approved", // ğŸ”´ å®¡æ ¸çŠ¶æ€
        review_reason: "å®¡æ ¸é€šè¿‡"  // ğŸ”´ å®¡æ ¸åŸå› 
      }
    ]
  }
}
```

### 7.2 ğŸ”´ ä¸Šä¼ æ ¸å¿ƒé€»è¾‘

```javascript
// pages/camera/camera.js
Page({
  onSubmitUpload() {
    if (!this.data.selectedImage) return
    
    this.setData({ uploading: true })
    
    photoAPI.upload(this.data.selectedImage.tempPath).then((result) => {
      if (result.code === 0) {
        const { upload_id, estimated_amount } = result.data
        
        wx.showModal({
          title: 'ä¸Šä¼ æˆåŠŸ',
          content: `ä¸Šä¼ IDï¼š${upload_id}\né¢„è®¡ç§¯åˆ†ï¼š${Math.floor(estimated_amount * 10)}`,
          showCancel: false
        })
        
        this.setData({ selectedImage: null })
      }
    }).catch((error) => {
      wx.showModal({
        title: 'ä¸Šä¼ å¤±è´¥', 
        content: error.message,
        showCancel: false
      })
    }).finally(() => {
      this.setData({ uploading: false })
    })
  }
})
```

---

## ğŸ‘¨â€ğŸ’¼ å…«ã€å•†å®¶ç®¡ç†ç³»ç»Ÿå¯¹æ¥

### 8.1 ğŸ”´ æ ¸å¿ƒå¯¹æ¥æ¥å£

```javascript
// å¾…å®¡æ ¸åˆ—è¡¨ï¼šGET /api/merchant/pending-reviews
// è¿”å›æ ¼å¼ï¼š
{
  code: 0,
  data: {
    reviews: [
      {
        upload_id: "UP123456789",      // ğŸ”´ ä¸Šä¼ ID
        user_phone: "138****8000",     // ğŸ”´ ç”¨æˆ·æ‰‹æœºå·(è„±æ•)
        image_url: "å›¾ç‰‡URL",          // ğŸ”´ å›¾ç‰‡åœ°å€
        amount: 58.50,                 // ğŸ”´ æ¶ˆè´¹é‡‘é¢
        expected_points: 585,          // ğŸ”´ å»ºè®®ç§¯åˆ†
        upload_time: "2024-12-19T14:30:00Z",
        status: "pending"              // ğŸ”´ å®¡æ ¸çŠ¶æ€
      }
    ],
    total: 50,
    has_more: true
  }
}

// æ‰§è¡Œå®¡æ ¸ï¼šPOST /api/merchant/review
// è¯·æ±‚å‚æ•°ï¼š
{
  upload_id: "UP123456789",
  action: "approve",               // ğŸ”´ approve|reject
  points: 585,                     // ğŸ”´ å¥–åŠ±ç§¯åˆ†
  reason: "å®¡æ ¸é€šè¿‡"               // ğŸ”´ å®¡æ ¸åŸå› 
}
```

### 8.2 ğŸ” æƒé™ç®¡ç†ç³»ç»Ÿ

```javascript
// app.js - å…¨å±€æƒé™æ£€æŸ¥
App({
  checkMerchantPermission(callback) {
    const userInfo = this.globalData.userInfo
    
    if (!userInfo) {
      wx.showModal({
        title: 'è¯·å…ˆç™»å½•',
        content: 'éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®å•†å®¶åŠŸèƒ½',
        showCancel: false,
        success: () => {
          wx.reLaunch({ url: '/pages/auth/auth' })
        }
      })
      return false
    }
    
    if (!userInfo.is_merchant) {
      wx.showModal({
        title: 'æƒé™ä¸è¶³',
        content: 'æ‚¨è¿˜ä¸æ˜¯å•†å®¶ï¼Œæ˜¯å¦ç”³è¯·å•†å®¶æƒé™ï¼Ÿ',
        success: (res) => {
          if (res.confirm) {
            wx.navigateTo({ url: '/pages/merchant/apply' })
          }
        }
      })
      return false
    }
    
    if (callback) callback()
    return true
  }
})
```

---

## ğŸ—„ï¸ ä¹ã€å®Œæ•´æ•°æ®åº“è¡¨è®¾è®¡

### 9.1 ğŸ”´ å•†å“è¡¨ (products)
```sql
CREATE TABLE products (
  commodity_id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,                  -- ğŸ”´ å‰ç«¯: product.name
  exchange_points INT NOT NULL,                -- ğŸ”´ å‰ç«¯: product.exchange_points
  stock INT NOT NULL,                          -- ğŸ”´ å‰ç«¯: product.stock (WebSocketåŒæ­¥)
  category VARCHAR(50),                        -- ğŸ”´ å‰ç«¯: product.category
  is_hot BOOLEAN DEFAULT FALSE,                -- ğŸ”´ å‰ç«¯: product.is_hot
  status ENUM('active', 'inactive') DEFAULT 'active',
  
  INDEX idx_category_status (category, status),
  INDEX idx_stock (stock)
);
```

### 9.2 ğŸ”´ ä¸Šä¼ å®¡æ ¸è¡¨ (upload_reviews)
```sql
CREATE TABLE upload_reviews (
  upload_id VARCHAR(50) PRIMARY KEY,           -- ğŸ”´ å‰ç«¯: upload.upload_id
  user_id INT NOT NULL,
  image_url VARCHAR(500) NOT NULL,             -- ğŸ”´ å‰ç«¯: upload.image_url
  amount DECIMAL(10,2),                        -- ğŸ”´ å‰ç«¯: upload.amount
  points_awarded INT DEFAULT 0,                -- ğŸ”´ å‰ç«¯: upload.points_awarded
  review_status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
  review_reason TEXT,                          -- ğŸ”´ å‰ç«¯: upload.review_reason
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  INDEX idx_status_time (review_status, created_at)
);
```

---

## ğŸ“Š åã€å®Œæ•´APIæ¥å£æ¸…å•

### ğŸ”´ è®¤è¯æ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å‘é€éªŒè¯ç  | POST | `/api/auth/send-code` | æ‰‹æœºéªŒè¯ç  |
| ç™»å½•æ³¨å†Œ | POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| åˆ·æ–°Token | POST | `/api/auth/refresh` | Tokenç»­æœŸ |

### ğŸ”´ æŠ½å¥–æ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| æŠ½å¥–é…ç½® | GET | `/api/lottery/config` | å¥–å“é…ç½® |
| æ‰§è¡ŒæŠ½å¥– | POST | `/api/lottery/draw` | æŠ½å¥–æ“ä½œ |
| æŠ½å¥–è®°å½• | GET | `/api/lottery/records` | å†å²è®°å½• |

### ğŸ”´ å•†å“å…‘æ¢æ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å•†å“åˆ—è¡¨ | GET | `/api/exchange/products` | å•†å“åˆ—è¡¨ |
| å•†å“å…‘æ¢ | POST | `/api/exchange/redeem` | å…‘æ¢æ“ä½œ |
| å…‘æ¢è®°å½• | GET | `/api/exchange/records` | å…‘æ¢å†å² |

### ğŸ”´ å›¾ç‰‡ä¸Šä¼ æ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å›¾ç‰‡ä¸Šä¼  | POST | `/api/photo/upload` | ä¸Šä¼ å›¾ç‰‡ |
| ä¸Šä¼ è®°å½• | GET | `/api/photo/records` | ä¸Šä¼ å†å² |

### ğŸ”´ å•†å®¶ç®¡ç†æ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å¾…å®¡æ ¸åˆ—è¡¨ | GET | `/api/merchant/pending-reviews` | å®¡æ ¸åˆ—è¡¨ |
| æ‰§è¡Œå®¡æ ¸ | POST | `/api/merchant/review` | å®¡æ ¸æ“ä½œ |
| å®¡æ ¸ç»Ÿè®¡ | GET | `/api/merchant/statistics` | å®¡æ ¸ç»Ÿè®¡ |

### ğŸ”´ ç”¨æˆ·ä¸­å¿ƒæ¨¡å—
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”¨æˆ·ä¿¡æ¯ | GET | `/api/user/profile` | ç”¨æˆ·èµ„æ–™ |
| ç§¯åˆ†è®°å½• | GET | `/api/user/points-history` | ç§¯åˆ†å˜åŠ¨ |
| æ›´æ–°èµ„æ–™ | PUT | `/api/user/profile` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |

---

## ğŸš€ åä¸€ã€éƒ¨ç½²é…ç½®æ£€æŸ¥æ¸…å•

### ğŸ”´ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¿…æ£€é¡¹
```bash
# 1. ç¯å¢ƒé…ç½®æ£€æŸ¥
âœ… config/env.js ä¸­ CURRENT_ENV = 'production'
âœ… baseUrl æŒ‡å‘ç”Ÿäº§æœåŠ¡å™¨åœ°å€
âœ… wsUrl ä½¿ç”¨ wss:// åè®®
âœ… Sealoså­˜å‚¨å¯†é’¥å·²æ›´æ–°
âœ… å¾®ä¿¡å°ç¨‹åº appId/appSecret å·²é…ç½®

# 2. åç«¯æœåŠ¡åœ°å€éªŒè¯
curl -X GET https://rqchrlqndora.sealosbja.site/api/health
# æœŸæœ›è¿”å›: {"status": "ok", "timestamp": "..."}

# 3. WebSocketæœåŠ¡éªŒè¯
wscat -c wss://rqchrlqndora.sealosbja.site/ws?token=test
# æœŸæœ›å»ºç«‹è¿æ¥æˆåŠŸ

# 4. APIæ¥å£éªŒè¯
curl -X POST https://rqchrlqndora.sealosbja.site/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"mobile": "13800138000"}'
# æœŸæœ›è¿”å›: {"code": 0, "message": "éªŒè¯ç å‘é€æˆåŠŸ"}
```

### ğŸ”´ å¼€å‘å®æ–½ä¼˜å…ˆçº§
1. **Phase 1 (æ ¸å¿ƒåŠŸèƒ½)**ï¼šç”¨æˆ·è®¤è¯ã€æŠ½å¥–ç³»ç»Ÿã€ç§¯åˆ†ç®¡ç†
2. **Phase 2 (æ‰©å±•åŠŸèƒ½)**ï¼šå•†å“å…‘æ¢ã€å›¾ç‰‡ä¸Šä¼ ã€WebSocketé€šä¿¡
3. **Phase 3 (ç®¡ç†åŠŸèƒ½)**ï¼šå•†å®¶ç®¡ç†ã€å®¡æ ¸ç³»ç»Ÿã€ç»Ÿè®¡æŠ¥è¡¨
4. **Phase 4 (ä¼˜åŒ–åŠŸèƒ½)**ï¼šæ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦ã€æ•°æ®åˆ†æ

### ğŸ”´ æˆåŠŸéªŒæ”¶æ ‡å‡†
- âœ… æ‰€æœ‰APIæ¥å£æ­£å¸¸å“åº”
- âœ… WebSocketå®æ—¶é€šä¿¡ç¨³å®š
- âœ… å‰åç«¯æ•°æ®å®Œå…¨åŒæ­¥
- âœ… æƒé™æ§åˆ¶æ­£ç¡®å®æ–½
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

---

**æ–‡æ¡£åˆ›å»ºè€…**ï¼šClaude Sonnet 4  
**åˆ›å»ºæ—¶é—´**ï¼š2024å¹´12æœˆ19æ—¥  
**å½“å‰ç‰ˆæœ¬**ï¼šv2.0-å®Œæ•´ç‰ˆï¼ˆåˆå¹¶ç‰ˆï¼‰ 